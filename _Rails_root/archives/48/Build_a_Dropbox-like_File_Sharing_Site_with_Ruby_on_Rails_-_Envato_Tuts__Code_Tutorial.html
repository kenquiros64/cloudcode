<!DOCTYPE html>
<!-- saved from url=(0103)http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940 -->
<html data-ad-targeting="{&quot;code&quot;:[&quot;ruby&quot;]}" data-ads="[{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;inarticle&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1392179526912-0&quot;,&quot;mappings&quot;:[]},{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;post_top&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1379650391729-0&quot;,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:640,&quot;height&quot;:480},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:480,&quot;height&quot;:640},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]}]},{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;post_mid&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1382314910331-0&quot;,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:640,&quot;height&quot;:480},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:480,&quot;height&quot;:640},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]}]},{&quot;doubleclick_id&quot;:&quot;11757429&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;location&quot;:&quot;post_comments&quot;,&quot;width&quot;:300,&quot;height&quot;:250,&quot;slot_id&quot;:&quot;1379650407131-0&quot;,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:640,&quot;height&quot;:480},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]},{&quot;viewport&quot;:{&quot;width&quot;:480,&quot;height&quot;:640},&quot;units&quot;:[{&quot;width&quot;:300,&quot;height&quot;:250}]}]},{&quot;location&quot;:&quot;leader&quot;,&quot;unit_name&quot;:&quot;hub_development&quot;,&quot;slot_id&quot;:&quot;1391730982123-0&quot;,&quot;width&quot;:728,&quot;height&quot;:90,&quot;mappings&quot;:[{&quot;viewport&quot;:{&quot;width&quot;:1024,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:728,&quot;height&quot;:90}]},{&quot;viewport&quot;:{&quot;width&quot;:980,&quot;height&quot;:768},&quot;units&quot;:[{&quot;width&quot;:728,&quot;height&quot;:90}]},{&quot;viewport&quot;:{&quot;width&quot;:768,&quot;height&quot;:980},&quot;units&quot;:[{&quot;width&quot;:728,&quot;height&quot;:90}]}],&quot;doubleclick_id&quot;:&quot;11757429&quot;}]" data-app-version="d8cc7621c69fbadf5ae6413b6b5961675b674575-production" class=" js no-touch history"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<script type="text/javascript" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/27851e2035"></script><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/nr-768.min.js"></script><script type="text/javascript" async="" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/linkid.js"></script><script type="text/javascript" async="" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/ec.js"></script><script async="" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/analytics.js"></script><script async="" type="text/javascript" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/gpt.js"></script><script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"27851e2035","applicationID":"3094824","transactionName":"JQpZTURXXlRcRBYWRBIKRVBXVEEXSl5WFQ==","queueTime":0,"applicationTime":74,"agent":"js-agent.newrelic.com/nr-768.min.js"}</script>
<script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VgUFWFRbGwAAXVVaBQU="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({QJf3ax:[function(t,e){function n(t){function e(e,n,a){t&&t(e,n,a),a||(a={});for(var c=s(e),f=c.length,u=i(a,o,r),d=0;f>d;d++)c[d].apply(u,n);return u}function a(t,e){f[t]=s(t).concat(e)}function s(t){return f[t]||[]}function c(){return n(e)}var f={};return{on:a,emit:e,create:c,listeners:s,_events:f}}function r(){return{}}var o="nr@context",i=t("gos");e.exports=n()},{gos:"7eSDFh"}],ee:[function(t,e){e.exports=t("QJf3ax")},{}],3:[function(t){function e(t){try{i.console&&console.log(t)}catch(e){}}var n,r=t("ee"),o=t(1),i={};try{n=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(i.console=!0,-1!==n.indexOf("dev")&&(i.dev=!0),-1!==n.indexOf("nr_dev")&&(i.nrDev=!0))}catch(a){}i.nrDev&&r.on("internal-error",function(t){e(t.stack)}),i.dev&&r.on("fn-err",function(t,n,r){e(r.stack)}),i.dev&&(e("NR AGENT IN DEVELOPMENT MODE"),e("flags: "+o(i,function(t){return t}).join(", ")))},{1:20,ee:"QJf3ax"}],4:[function(t){function e(t,e,n,i,s){try{c?c-=1:r("err",[s||new UncaughtException(t,e,n)])}catch(f){try{r("ierr",[f,(new Date).getTime(),!0])}catch(u){}}return"function"==typeof a?a.apply(this,o(arguments)):!1}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function n(t){r("err",[t,(new Date).getTime()])}var r=t("handle"),o=t(6),i=t("ee"),a=window.onerror,s=!1,c=0;t("loader").features.err=!0,t(3),window.onerror=e;try{throw new Error}catch(f){"stack"in f&&(t(4),t(5),"addEventListener"in window&&t(1),window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent)&&t(2),s=!0)}i.on("fn-start",function(){s&&(c+=1)}),i.on("fn-err",function(t,e,r){s&&(this.thrown=!0,n(r))}),i.on("fn-end",function(){s&&!this.thrown&&c>0&&(c-=1)}),i.on("internal-error",function(t){r("ierr",[t,(new Date).getTime(),!0])})},{1:5,2:8,3:3,4:7,5:6,6:21,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],5:[function(t,e){function n(t){i.inPlace(t,["addEventListener","removeEventListener"],"-",r)}function r(t){return t[1]}var o=t("ee").create(),i=t(1)(o),a=t("gos");if(e.exports=o,n(window),"getPrototypeOf"in Object){for(var s=document;s&&!s.hasOwnProperty("addEventListener");)s=Object.getPrototypeOf(s);s&&n(s);for(var c=XMLHttpRequest.prototype;c&&!c.hasOwnProperty("addEventListener");)c=Object.getPrototypeOf(c);c&&n(c)}else XMLHttpRequest.prototype.hasOwnProperty("addEventListener")&&n(XMLHttpRequest.prototype);o.on("addEventListener-start",function(t,e){function n(){return s}if(t[1]){var r=t[1];if("function"==typeof r){var s=a(r,"nr@wrapped",function(){return i(r,"fn-",n,r.name||"anonymous")});this.wrapped=t[1]=s,o.emit("initEventContext",[t,e],this.wrapped)}else"function"==typeof r.handleEvent&&i.inPlace(r,["handleEvent"],"fn-")}}),o.on("removeEventListener-start",function(t){var e=this.wrapped;e&&(t[1]=e)})},{1:22,ee:"QJf3ax",gos:"7eSDFh"}],6:[function(t,e){var n=t("ee").create(),r=t(1)(n);e.exports=n,r.inPlace(window,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame"],"raf-"),n.on("raf-start",function(t){t[0]=r(t[0],"fn-")})},{1:22,ee:"QJf3ax"}],7:[function(t,e){function n(t,e,n){t[0]=i(t[0],"fn-",null,n)}function r(t,e,n){function r(){return a}this.ctx={};var a={"nr@context":this.ctx};o.emit("initTimerContext",[t,n],a),t[0]=i(t[0],"fn-",r,n)}var o=t("ee").create(),i=t(1)(o);e.exports=o,i.inPlace(window,["setTimeout","setImmediate"],"setTimer-"),i.inPlace(window,["setInterval"],"setInterval-"),i.inPlace(window,["clearTimeout","clearImmediate"],"clearTimeout-"),o.on("setInterval-start",n),o.on("setTimer-start",r)},{1:22,ee:"QJf3ax"}],8:[function(t,e){function n(){f.inPlace(this,p,"fn-",o)}function r(t,e){f.inPlace(e,["onreadystatechange"],"fn-")}function o(t,e){return e}function i(t,e){for(var n in t)e[n]=t[n];return e}var a=t("ee").create(),s=t(1),c=t(2),f=c(a),u=c(s),d=window.XMLHttpRequest,p=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"];e.exports=a,window.XMLHttpRequest=function(t){var e=new d(t);try{a.emit("new-xhr",[],e),e.hasOwnProperty("addEventListener")&&u.inPlace(e,["addEventListener","removeEventListener"],"-",o),e.addEventListener("readystatechange",n,!1)}catch(r){try{a.emit("internal-error",[r])}catch(i){}}return e},i(d,XMLHttpRequest),XMLHttpRequest.prototype=d.prototype,f.inPlace(XMLHttpRequest.prototype,["open","send"],"-xhr-",o),a.on("send-xhr-start",r),a.on("open-xhr-start",r)},{1:5,2:22,ee:"QJf3ax"}],9:[function(t){function e(t){var e=this.params,r=this.metrics;if(!this.ended){this.ended=!0;for(var i=0;c>i;i++)t.removeEventListener(s[i],this.listener,!1);if(!e.aborted){if(r.duration=(new Date).getTime()-this.startTime,4===t.readyState){e.status=t.status;var a=t.responseType,f="arraybuffer"===a||"blob"===a||"json"===a?t.response:t.responseText,u=n(f);if(u&&(r.rxSize=u),this.sameOrigin){var d=t.getResponseHeader("X-NewRelic-App-Data");d&&(e.cat=d.split(", ").pop())}}else e.status=0;r.cbTime=this.cbTime,o("xhr",[e,r,this.startTime])}}}function n(t){if("string"==typeof t&&t.length)return t.length;if("object"!=typeof t)return void 0;if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if("undefined"!=typeof FormData&&t instanceof FormData)return void 0;try{return JSON.stringify(t).length}catch(e){return void 0}}function r(t,e){var n=i(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}if(window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent)){t("loader").features.xhr=!0;var o=t("handle"),i=t(2),a=t("ee"),s=["load","error","abort","timeout"],c=s.length,f=t(1),u=window.XMLHttpRequest;t(4),t(3),a.on("new-xhr",function(){this.totalCbs=0,this.called=0,this.cbTime=0,this.end=e,this.ended=!1,this.xhrGuids={}}),a.on("open-xhr-start",function(t){this.params={method:t[0]},r(this,t[1]),this.metrics={}}),a.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),a.on("send-xhr-start",function(t,e){var r=this.metrics,o=t[0],i=this;if(r&&o){var f=n(o);f&&(r.txSize=f)}this.startTime=(new Date).getTime(),this.listener=function(t){try{"abort"===t.type&&(i.params.aborted=!0),("load"!==t.type||i.called===i.totalCbs&&(i.onloadCalled||"function"!=typeof e.onload))&&i.end(e)}catch(n){try{a.emit("internal-error",[n])}catch(r){}}};for(var u=0;c>u;u++)e.addEventListener(s[u],this.listener,!1)}),a.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),a.on("xhr-load-added",function(t,e){var n=""+f(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),a.on("xhr-load-removed",function(t,e){var n=""+f(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),a.on("addEventListener-end",function(t,e){e instanceof u&&"load"===t[0]&&a.emit("xhr-load-added",[t[1],t[2]],e)}),a.on("removeEventListener-end",function(t,e){e instanceof u&&"load"===t[0]&&a.emit("xhr-load-removed",[t[1],t[2]],e)}),a.on("fn-start",function(t,e,n){e instanceof u&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=(new Date).getTime()))}),a.on("fn-end",function(t,e){this.xhrCbStart&&a.emit("xhr-cb-time",[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{1:"XL7HBI",2:10,3:8,4:5,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],10:[function(t,e){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");return!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname),r.sameOrigin=!e.hostname||e.hostname===document.domain&&e.port===n.port&&e.protocol===n.protocol,r}},{}],11:[function(t,e){function n(t){return function(){r(t,[(new Date).getTime()].concat(i(arguments)))}}var r=t("handle"),o=t(1),i=t(2);"undefined"==typeof window.newrelic&&(newrelic=window.NREUM);var a=["setPageViewName","addPageAction","setCustomAttribute","finished","addToTrace","inlineHit","noticeError"];o(a,function(t,e){window.NREUM[e]=n("api-"+e)}),e.exports=window.NREUM},{1:20,2:21,handle:"D5DuLP"}],gos:[function(t,e){e.exports=t("7eSDFh")},{}],"7eSDFh":[function(t,e){function n(t,e,n){if(r.call(t,e))return t[e];var o=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:o,writable:!0,enumerable:!1}),o}catch(i){}return t[e]=o,o}var r=Object.prototype.hasOwnProperty;e.exports=n},{}],D5DuLP:[function(t,e){function n(t,e,n){return r.listeners(t).length?r.emit(t,e,n):void(r.q&&(r.q[t]||(r.q[t]=[]),r.q[t].push(e)))}var r=t("ee").create();e.exports=n,n.ee=r,r.q={}},{ee:"QJf3ax"}],handle:[function(t,e){e.exports=t("D5DuLP")},{}],XL7HBI:[function(t,e){function n(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:i(t,o,function(){return r++})}var r=1,o="nr@id",i=t("gos");e.exports=n},{gos:"7eSDFh"}],id:[function(t,e){e.exports=t("XL7HBI")},{}],G9z0Bl:[function(t,e){function n(){var t=p.info=NREUM.info,e=f.getElementsByTagName("script")[0];if(t&&t.licenseKey&&t.applicationID&&e){s(d,function(e,n){e in t||(t[e]=n)});var n="https"===u.split(":")[0]||t.sslForHttp;p.proto=n?"https://":"http://",a("mark",["onload",i()]);var r=f.createElement("script");r.src=p.proto+t.agent,e.parentNode.insertBefore(r,e)}}function r(){"complete"===f.readyState&&o()}function o(){a("mark",["domContent",i()])}function i(){return(new Date).getTime()}var a=t("handle"),s=t(1),c=window,f=c.document;t(2);var u=(""+location).split("?")[0],d={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-768.min.js"},p=e.exports={offset:i(),origin:u,features:{}};f.addEventListener?(f.addEventListener("DOMContentLoaded",o,!1),c.addEventListener("load",n,!1)):(f.attachEvent("onreadystatechange",r),c.attachEvent("onload",n)),a("mark",["firstbyte",i()])},{1:20,2:11,handle:"D5DuLP"}],loader:[function(t,e){e.exports=t("G9z0Bl")},{}],20:[function(t,e){function n(t,e){var n=[],o="",i=0;for(o in t)r.call(t,o)&&(n[i]=e(o,t[o]),i+=1);return n}var r=Object.prototype.hasOwnProperty;e.exports=n},{}],21:[function(t,e){function n(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=n},{}],22:[function(t,e){function n(t){return!(t&&"function"==typeof t&&t.apply&&!t[i])}var r=t("ee"),o=t(1),i="nr@original",a=Object.prototype.hasOwnProperty;e.exports=function(t){function e(t,e,r,a){function nrWrapper(){var n,i,s,f;try{i=this,n=o(arguments),s=r&&r(n,i)||{}}catch(d){u([d,"",[n,i,a],s])}c(e+"start",[n,i,a],s);try{return f=t.apply(i,n)}catch(p){throw c(e+"err",[n,i,p],s),p}finally{c(e+"end",[n,i,f],s)}}return n(t)?t:(e||(e=""),nrWrapper[i]=t,f(t,nrWrapper),nrWrapper)}function s(t,r,o,i){o||(o="");var a,s,c,f="-"===o.charAt(0);for(c=0;c<r.length;c++)s=r[c],a=t[s],n(a)||(t[s]=e(a,f?s+o:o,i,s))}function c(e,n,r){try{t.emit(e,n,r)}catch(o){u([o,e,n,r])}}function f(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){u([r])}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return e}function u(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=r),e.inPlace=s,e.flag=i,e}},{1:21,ee:"QJf3ax"}]},{},["G9z0Bl",4,9]);</script><title>Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial</title><link rel="canonical" href="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial.html"><link rel="shortcut icon" type="image/png" href="http://static.tutsplus.com/assets/favicon-8b86ba48e7f31535461f183680fe2ac9.png"><link rel="apple-touch-icon" type="image/png" href="http://static.tutsplus.com/assets/apple-touch-icon-8b86ba48e7f31535461f183680fe2ac9.png"><link rel="stylesheet" media="all" href="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/application-65a6c540326f8cd4855a04eb725e5dc5.css"><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/collect.js" async="async"></script><!--[if lte IE 8]><link rel="stylesheet" media="screen" href="http://static.tutsplus.com/assets/ie8-c38f02ec8bb258c2ffad66305bbebfc9.css" /><script src="http://static.tutsplus.com/assets/modernizr.custom-4191fa85b5ca7ff4a6e827bd9820bcec.js"></script><![endif]--><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/application-ae696151566ef19549808e3986613f7a.js"></script><link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="http://tutsplus.com/posts.atom"><meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="LYGG8dx0wQsksSXqVXjaTUs7p/ab8SO3xnk4o2RRwuK0xwDiBTGIys74VcuvxAMxjweDBpwoK3Z2NFg7Rw3TbA=="><meta content="initial-scale=1" name="viewport"><meta content="index, follow" name="robots"><meta content="Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial" property="og:title"><meta content="Code Envato Tuts+" property="og:site_name"><meta content="1494084460809023" property="fb:app_id"><meta content="Ruby" name="ET.category"><meta content="In this Tuts+ Premium tutorial, we&#39;ll learn how to build a file-sharing web application, like Dropbox, using Ruby on Rails. | Difficulty: Advanced; Length: Long; Tags: Ruby" property="og:description"><meta content="article" property="og:type"><meta content="http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940" property="og:url"><meta content="In this Tuts+ Premium tutorial, we&#39;ll learn how to build a file-sharing web application, like Dropbox, using Ruby on Rails. | Difficulty: Advanced; Length: Long; Tags: Ruby" name="description"><meta content="https://cms-assets.tutsplus.com/legacy-premium-tutorials/default-preview-images/code.png" property="og:image"><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/pubads_impl_75.js" async=""></script><script type="text/javascript" async="" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/embed.js"></script><script async="" type="text/javascript" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/count.js"></script><script type="text/javascript" async="" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/saved_resource"></script><script type="text/javascript" async="" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/saved_resource(1)"></script><style type="text/css"></style><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/count-data.js"></script><script type="application/ld+json">{"@context":"http://schema.org/","@id":"https://fast.wistia.net/embed/iframe/f7zrmethqh","@type":"VideoObject","duration":"PT2M39S","name":"Introduction","thumbnailUrl":"https://embed-ssl.wistia.com/deliveries/f7010871bb0704426caaae674e9bae747daf70ed.jpg?image_crop_resized=492x277","embedUrl":"https://fast.wistia.net/embed/iframe/f7zrmethqh","uploadDate":"2015-07-14","transcript":"Ruby on Rails is one of\nthe greatest phenomenon\n\nin the software development industry.\n\nIt is an open source web framework\nthat allows you to quickly build\n\napplications for the web.\n\nIf you want to get up to speed in\ndeveloping your own web application,\n\nyou should definitely study this tool.\n\nHi, my name is Shozamata.\n\nI'm your instructor for this course.\n\nYou'll learn about developing web\napplications using Ruby on Rails.\n\nThe latest version,\nup to date as you can see, is 4.2.1.\n\nIt was released a couple of months ago,\nbut\n\nit proves to be a stable in\ntoday's software industry.\n\nIn this course you will\nlearn many different things.\n\nWe will build an application that will\nsupport each different concept or\n\nat least most of them available\nin the Rails' framework.\n\nRails is more than just a tool.\n\nIt is an environment, a community,\n\nan effort by thousands of\npeople around the world.\n\nAs I've mentioned, we're going to\nlearn Ruby on Rails by example.\n\nWe're going to actually\nbuild a project of our own.\n\nIt's going to be a project manager, as it\nhas a simple yet solid business model.\n\nWhich we can rely on and\ntranslate to a Ruby application.\n\nWe will cover many different aspects.\n\nWe're going to begin with a small\nboot strap of the applications, and\n\nthen we're going to build our way forward.\n\nWe'll learn about models, controllers,\ntemplates or views, as they're called.\n\nAnd these will be the very\nfoundation of working with Rails.\n\nBut after that, we'll take a look at some\nother aspects, such as the validations,\n\nhow to write forms that mirror\nour objects in the application,\n\nhow to use CSS and\nJavaScript through the asset pipeline.\n\nHow do we run migrations that\nchange the schema of the database?\n\nHow do we send email?\n\nAnd how do we use internationalization\nto support multiple languages?\n\nYou will learn all of this in this course.\n\nSo I hope you're excited.\n\nI assume you have a basic\nknowledge on the Ruby language.\n\nIf you don't, be sure to check out\nthe Learn to Code With Ruby course.\n\nAll of the basics and\n\nfundamental techniques on how\nto work with Ruby are there.\n\nGo ahead and\ncheck it out before jumping into this one.\n\nIf you're already comfortable with Ruby,\nthen jump right ahead.\n\nLet's go to the next lesson.\n\nWe will learn how to bootstrap\na Rails application.","description":"<p>Welcome to Get Started With Ruby on Rails! In this lesson I’ll introduce the course: I’ll tell you all about the power of Ruby on Rails and I’ll tell you about the sample application that we’ll build together.</p>\n\n<strong>Related Links</strong>\n\n<ul>\n<li>\n<a href=\"http://code.tutsplus.com/courses/learn-to-code-with-ruby\">Learn to Code With Ruby Course</a>\n</li>\n</ul>"}</script><script type="text/javascript" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/osd.js"></script></head><body class="page-body topic-code" data-ga-account="UA-11792865-37" data-ga-domain="tutsplus.com" data-wt-dcsid="dcs222cpd4g6lg7wb3cum8l5g_6w6m"><!--[if lt IE 10]><div class="legacy-ie-banner"><h2 class="legacy-ie-banner__title">Unsupported browser</h2><p class="legacy-ie-banner__text">This site was designed for modern browsers and tested with Internet Explorer version 10 and later. </p><p class="legacy-ie-banner__text">It may not look or work correctly on your browser. </p></div><![endif]--><nav class="global-nav view view--loaded"><div class="global-nav__mobile"><section class="global-nav__mobile-search"><form action="http://tutsplus.com/tutorials/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="✓"><input type="text" name="search[terms]" id="search_terms" placeholder="Search Envato Tuts+" class="global-nav__mobile-search-terms"><button name="button" type="submit" class="global-nav__mobile-search-button"><i class="fa fa-search"></i></button></form></section><ul class="global-nav__mobile-top-level"><li class="global-nav__mobile-top-level-item global-nav__mobile-top-level-item--expanded"><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-link-expandable" href="http://tutsplus.com/tutorials"><span class="global-nav__mobile-top-level-link-title">Free Tutorials</span></a><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-expansion-link" href="http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940#"><span class="global-nav__mobile-top-level-expand-text"><i class="fa fa-plus global-nav__mobile-top-level-link-icon"></i></span><span class="global-nav__mobile-top-level-collapse-text"><i class="fa fa-minus global-nav__mobile-top-level-link-icon"></i></span></a><ul class="global-nav__mobile-second-level"><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-design" href="http://design.tutsplus.com/">Design &amp; Illustration</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-code" href="http://code.tutsplus.com/">Code</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-webdesign" href="http://webdesign.tutsplus.com/">Web Design</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-photography" href="http://photography.tutsplus.com/">Photo &amp; Video</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-music" href="http://music.tutsplus.com/">Music &amp; Audio</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-cgi" href="http://cgi.tutsplus.com/">3D &amp; Motion Graphics</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/">Game Development</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-computers" href="http://computers.tutsplus.com/">Computer Skills</a></li><li class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-business" href="http://business.tutsplus.com/">Business</a></li></ul></li><li class="global-nav__mobile-top-level-item"><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-link-expandable" href="http://tutsplus.com/courses"><span class="global-nav__mobile-top-level-link-title">Courses</span></a><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-expansion-link" href="http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940#"><span class="global-nav__mobile-top-level-expand-text"><i class="fa fa-plus global-nav__mobile-top-level-link-icon"></i></span><span class="global-nav__mobile-top-level-collapse-text"><i class="fa fa-minus global-nav__mobile-top-level-link-icon"></i></span></a><div class="global-nav__mobile-second-level"><div class="global-nav__mobile-second-level-item"></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-design" href="http://design.tutsplus.com/courses">Design &amp; Illustration</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-code" href="http://code.tutsplus.com/courses">Code</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-webdesign" href="http://webdesign.tutsplus.com/courses">Web Design</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-photography" href="http://photography.tutsplus.com/courses">Photo &amp; Video</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-music" href="http://music.tutsplus.com/courses">Music &amp; Audio</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-cgi" href="http://cgi.tutsplus.com/courses">3D &amp; Motion Graphics</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-business" href="http://business.tutsplus.com/courses">Business</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-bundles-link" href="http://tutsplus.com/bundles"><span class="translation_missing" title="translation missing: en.views.courses.courses_menu.bundles">Bundles</span></a></div></div></li><li class="global-nav__mobile-top-level-item"><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-link-expandable" href="http://tutsplus.com/ebooks"><span class="global-nav__mobile-top-level-link-title">eBooks</span></a><a class="global-nav__mobile-top-level-link global-nav__mobile-top-level-expansion-link" href="http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940#"><span class="global-nav__mobile-top-level-expand-text"><i class="fa fa-plus global-nav__mobile-top-level-link-icon"></i></span><span class="global-nav__mobile-top-level-collapse-text"><i class="fa fa-minus global-nav__mobile-top-level-link-icon"></i></span></a><div class="global-nav__mobile-second-level"><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-design" href="http://design.tutsplus.com/ebooks">Design &amp; Illustration</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-code" href="http://code.tutsplus.com/ebooks">Code</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-webdesign" href="http://webdesign.tutsplus.com/ebooks">Web Design</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-photography" href="http://photography.tutsplus.com/ebooks">Photo &amp; Video</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-music" href="http://music.tutsplus.com/ebooks">Music &amp; Audio</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-cgi" href="http://cgi.tutsplus.com/ebooks">3D &amp; Motion Graphics</a></div><div class="global-nav__mobile-second-level-item"><a class="global-nav__mobile-second-level-topic-link topic-business" href="http://business.tutsplus.com/ebooks">Business</a></div></div></li></ul><div class="global-nav__mobile-pricing-button-container"><a class="global-nav__mobile-pricing-button" href="http://tutsplus.com/sign_up">Free Account</a></div><div class="global-nav__mobile-user-links"><a class="global-nav__mobile-user-link" href="https://tutsplus.com/sign_up?redirect_to=https%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940">Sign Up</a><a class="global-nav__mobile-user-link" href="https://tutsplus.com/sign_in?redirect_to=https%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940">Sign In</a></div></div><div class="global-nav__header"><div class="global-nav__header-content"><div class="global-nav__header-left"><a class="global-nav__header-tuts-logo-link" href="http://tutsplus.com/"><img alt="envato-tuts+" class="global-nav__header-envato-logo-image" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/envato_leaf-838199982ec672b34b0f8e093761e858.svg"><img alt="envato-tuts+" class="global-nav__header-tuts-logo-image" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/tuts_logo-b4f5f5fad9a5f4b3f91e3b770689a808.svg"></a><form class="global-nav__search" action="http://tutsplus.com/tutorials/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="✓"><div class="global-nav__search-topic-container"><select name="search[topic]" id="search_topic" class="global-nav__search-topic"><option value="">All Topics</option>
<option value="Design &amp; Illustration">Design &amp; Illustration</option>
<option value="Code">Code</option>
<option value="Web Design">Web Design</option>
<option value="Photo &amp; Video">Photo &amp; Video</option>
<option value="Music &amp; Audio">Music &amp; Audio</option>
<option value="3D &amp; Motion Graphics">3D &amp; Motion Graphics</option>
<option value="Game Development">Game Development</option>
<option value="Computer Skills">Computer Skills</option>
<option value="Crafts &amp; DIY">Crafts &amp; DIY</option>
<option value="Business">Business</option></select></div><div class="global-nav__search-terms-container"><span class="twitter-typeahead" style="position: relative; display: inline-block; direction: ltr;"><input type="text" class="global-nav__search-terms tt-hint" readonly="" autocomplete="off" spellcheck="false" tabindex="-1" style="position: absolute; top: 0px; left: 0px; border-color: transparent; box-shadow: none; opacity: 1; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);"><input type="text" name="search[terms]" id="search_terms" placeholder="Find tutorials, courses, and more..." class="global-nav__search-terms tt-input" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Arial; font-size: 12px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: 0px; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="tt-dropdown-menu" style="position: absolute; top: 100%; left: 0px; z-index: 100; display: none; right: auto;"><div class="tt-dataset-search"></div></span></span></div><button name="button" type="submit" class="global-nav__search-button"><div class="icon fa fa-search global-nav__search-icon"></div></button></form><ul class="global-nav__header-list"><li class="global-nav__header-item"><nav class="topics-menu view view--loaded" data-toggle=".topics-menu__dropdown-toggle"><a class="topics-menu__dropdown-toggle global-nav__header-link global-nav__header-link--primary global-nav__header-link--active" href="http://tutsplus.com/tutorials">Tutorials<i class="fa fa-chevron-down"></i></a><ul class="topics-menu__topics"><li class="topics-menu__topic topic-design" data-slug="design"><a class="topics-menu__topic-link topic-design" href="http://design.tutsplus.com/">Design &amp; Illustration<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-design"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-design" href="http://design.tutsplus.com/">Design &amp; Illustration</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/vector">Vector</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/adobe-photoshop">Adobe Photoshop</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/adobe-illustrator">Adobe Illustrator</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/illustration">Illustration</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/tools-tips">Tools &amp; Tips</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/inspiration">Inspiration</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/designing">Designing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/drawing">Drawing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-design hello" href="http://design.tutsplus.com/categories/text-effects">Text Effects</a></li></ul><a class="topics-menu__more-categories-link topic-design" href="http://design.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-design"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-design" href="http://design.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-code" data-slug="code"><a class="topics-menu__topic-link topic-code" href="http://code.tutsplus.com/">Code<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-code"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-code" href="http://code.tutsplus.com/">Code</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/web-development">Web Development</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/wordpress">WordPress</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/mobile-development">Mobile Development</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/php">PHP</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/flash">Flash</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/javascript">JavaScript</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/ios-sdk">iOS SDK</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/cms">CMS</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-code hello" href="http://code.tutsplus.com/categories/android-sdk">Android SDK</a></li></ul><a class="topics-menu__more-categories-link topic-code" href="http://code.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-code"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-code" href="http://code.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-webdesign" data-slug="webdesign"><a class="topics-menu__topic-link topic-webdesign" href="http://webdesign.tutsplus.com/">Web Design<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-webdesign"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-webdesign" href="http://webdesign.tutsplus.com/">Web Design</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/css">CSS</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/html-css">HTML &amp; CSS</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/adobe-photoshop">Adobe Photoshop</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/html">HTML</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/complete-websites">Complete Websites</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/workflow">Workflow</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/ui-design">UI Design</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/design-theory">Design Theory</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/general">General</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-webdesign hello" href="http://webdesign.tutsplus.com/categories/blog">Blog</a></li></ul><a class="topics-menu__more-categories-link topic-webdesign" href="http://webdesign.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-webdesign"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-webdesign" href="http://webdesign.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-photography" data-slug="photography"><a class="topics-menu__topic-link topic-photography" href="http://photography.tutsplus.com/">Photo &amp; Video<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-photography"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-photography" href="http://photography.tutsplus.com/">Photo &amp; Video</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/shooting">Shooting</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/post-processing">Post-Processing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/photo-critique">Photo Critique</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/adobe-photoshop">Adobe Photoshop</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/inspiration">Inspiration</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/lighting">Lighting</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/adobe-lightroom">Adobe Lightroom</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/lectures">Lectures</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-photography hello" href="http://photography.tutsplus.com/categories/speedlights">Speedlights</a></li></ul><a class="topics-menu__more-categories-link topic-photography" href="http://photography.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-photography"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-photography" href="http://photography.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-music" data-slug="music"><a class="topics-menu__topic-link topic-music" href="http://music.tutsplus.com/">Music &amp; Audio<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-music"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-music" href="http://music.tutsplus.com/">Music &amp; Audio</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/audio-production">Audio Production</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/general">General</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/logic-pro">Logic Pro</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/workshops">Workshops</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/mixing-mastering">Mixing &amp; Mastering</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/open-mic">Open Mic</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/sound-design">Sound Design</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/ableton-live">Ableton Live</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/reason">Reason</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-music hello" href="http://music.tutsplus.com/categories/recording">Recording</a></li></ul><a class="topics-menu__more-categories-link topic-music" href="http://music.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-music"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-music" href="http://music.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-cgi" data-slug="cgi"><a class="topics-menu__topic-link topic-cgi" href="http://cgi.tutsplus.com/">3D &amp; Motion Graphics<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-cgi"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-cgi" href="http://cgi.tutsplus.com/">3D &amp; Motion Graphics</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/adobe-after-effects">Adobe After Effects</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/3d">3D</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/motion-graphics">Motion Graphics</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/3d-studio-max">3D Studio Max</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/cinema-4d">Cinema 4D</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/maya">Maya</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/workflow">Workflow</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/visual-effects">Visual Effects</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-cgi hello" href="http://cgi.tutsplus.com/categories/roundup">Roundup</a></li></ul><a class="topics-menu__more-categories-link topic-cgi" href="http://cgi.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-cgi"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-cgi" href="http://cgi.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-gamedevelopment" data-slug="gamedevelopment"><a class="topics-menu__topic-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/">Game Development<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-gamedevelopment"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/">Game Development</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/game-design">Game Design</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/implementation">Implementation</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/platform-agnostic">Platform Agnostic</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/business">Business</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/programming">Programming</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/flash">Flash</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/from-scratch">From Scratch</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/html5">HTML5</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/news">News</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-gamedevelopment hello" href="http://gamedevelopment.tutsplus.com/categories/construct-2">Construct 2</a></li></ul><a class="topics-menu__more-categories-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-gamedevelopment"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-gamedevelopment" href="http://gamedevelopment.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-computers" data-slug="computers"><a class="topics-menu__topic-link topic-computers" href="http://computers.tutsplus.com/">Computer Skills<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-computers"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-computers" href="http://computers.tutsplus.com/">Computer Skills</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/os-x">OS X</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/app-training">App Training</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/productivity">Productivity</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/tips-shortcuts">Tips &amp; Shortcuts</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/electronics">Electronics</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/security">Security</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/automation">Automation</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/office">Office</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/hardware">Hardware</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-computers hello" href="http://computers.tutsplus.com/categories/terminal">Terminal</a></li></ul><a class="topics-menu__more-categories-link topic-computers" href="http://computers.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-computers"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-computers" href="http://computers.tutsplus.com/series">Learning Guides</a></li></ul></div></li><li class="topics-menu__topic topic-business" data-slug="business"><a class="topics-menu__topic-link topic-business" href="http://business.tutsplus.com/">Business<i class="fa fa-chevron-right topics-menu__topic-link-chevron"></i></a><div class="topics-menu__topic-submenu topic-business"><span class="topics-menu__submenu-title"><a class="topics-menu__submenu-title-link topic-link topic-business" href="http://business.tutsplus.com/">Business</a></span><ul class="topics-menu__featured-categories"><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/freelance">Freelance</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/marketing">Marketing</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/communication">Communication</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/planning">Planning</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/finance">Finance</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/sales">Sales</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/productivity">Productivity</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/entrepreneurship">Entrepreneurship</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/blogging">Blogging</a></li><li class="topics-menu__featured-category"><a class="topics-menu__featured-category-link topic-business hello" href="http://business.tutsplus.com/categories/career-development">Career Development</a></li></ul><a class="topics-menu__more-categories-link topic-business" href="http://business.tutsplus.com/categories">More Categories...</a><ul class="topics-menu__submenu-footer-links topic-business"><li class="topics-menu__submenu-footer-item"><a class="topics-menu__submenu-footer-link topic-business" href="http://business.tutsplus.com/series">Learning Guides</a></li></ul></div></li></ul></nav></li><li class="global-nav__header-item"><nav class="courses-menu view" data-toggle=".courses-menu__dropdown-toggle"><a class="courses-menu__dropdown-toggle global-nav__header-link global-nav__header-link--primary " href="http://tutsplus.com/courses">Courses<i class="fa fa-chevron-down"></i></a><ul class="courses-menu__topics"><li class="courses-menu__topic topic-design" data-slug="design"><a class="courses-menu__topic-link topic-design" href="http://design.tutsplus.com/courses">Design &amp; Illustration</a></li><li class="courses-menu__topic topic-code" data-slug="code"><a class="courses-menu__topic-link topic-code" href="http://code.tutsplus.com/courses">Code</a></li><li class="courses-menu__topic topic-webdesign" data-slug="webdesign"><a class="courses-menu__topic-link topic-webdesign" href="http://webdesign.tutsplus.com/courses">Web Design</a></li><li class="courses-menu__topic topic-photography" data-slug="photography"><a class="courses-menu__topic-link topic-photography" href="http://photography.tutsplus.com/courses">Photo &amp; Video</a></li><li class="courses-menu__topic topic-music" data-slug="music"><a class="courses-menu__topic-link topic-music" href="http://music.tutsplus.com/courses">Music &amp; Audio</a></li><li class="courses-menu__topic topic-cgi" data-slug="cgi"><a class="courses-menu__topic-link topic-cgi" href="http://cgi.tutsplus.com/courses">3D &amp; Motion Graphics</a></li><li class="courses-menu__topic topic-business" data-slug="business"><a class="courses-menu__topic-link topic-business" href="http://business.tutsplus.com/courses">Business</a></li><a class="courses-menu__topic-link courses-menu__bundles-link" href="http://tutsplus.com/bundles"><span class="translation_missing" title="translation missing: en.views.courses.courses_menu.bundles">Bundles</span></a></ul></nav></li><li class="global-nav__header-item"><nav class="ebooks-menu view" data-toggle=".ebooks-menu__dropdown-toggle"><a class="ebooks-menu__dropdown-toggle global-nav__header-link global-nav__header-link--primary " href="http://tutsplus.com/ebooks">eBooks<i class="fa fa-chevron-down"></i></a><ul class="ebooks-menu__topics"><li class="ebooks-menu__topic topic-design" data-slug="design"><a class="ebooks-menu__topic-link topic-design" href="http://design.tutsplus.com/ebooks">Design &amp; Illustration</a></li><li class="ebooks-menu__topic topic-code" data-slug="code"><a class="ebooks-menu__topic-link topic-code" href="http://code.tutsplus.com/ebooks">Code</a></li><li class="ebooks-menu__topic topic-webdesign" data-slug="webdesign"><a class="ebooks-menu__topic-link topic-webdesign" href="http://webdesign.tutsplus.com/ebooks">Web Design</a></li><li class="ebooks-menu__topic topic-photography" data-slug="photography"><a class="ebooks-menu__topic-link topic-photography" href="http://photography.tutsplus.com/ebooks">Photo &amp; Video</a></li><li class="ebooks-menu__topic topic-music" data-slug="music"><a class="ebooks-menu__topic-link topic-music" href="http://music.tutsplus.com/ebooks">Music &amp; Audio</a></li><li class="ebooks-menu__topic topic-cgi" data-slug="cgi"><a class="ebooks-menu__topic-link topic-cgi" href="http://cgi.tutsplus.com/ebooks">3D &amp; Motion Graphics</a></li><li class="ebooks-menu__topic topic-business" data-slug="business"><a class="ebooks-menu__topic-link topic-business" href="http://business.tutsplus.com/ebooks">Business</a></li></ul></nav></li><li class="global-nav__header-item"><a class="global-nav__header-link global-nav__header-link--primary global-nav__header-link--blog" href="http://tutsplus.com/blog">Blog</a></li></ul></div><div class="global-nav__header-right"><ul class="global-nav__header-list"><li class="global-nav__header-item"><a class="global-nav__header-link" href="http://tutsplus.com/pricing">Pricing</a></li><li class="global-nav__header-item"><a class="global-nav__header-link" href="https://tutsplus.com/sign_in?redirect_to=https%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940">Sign In</a></li></ul><a class="global-nav__pricing-button" href="http://tutsplus.com/sign_up">Free Account</a></div></div></div><div class="global-nav__mobile-toggle"><a class="global-nav__mobile-toggle-link" href="javascript:"><i class="fa fa-reorder"></i></a></div></nav><div class="ad view ad--leaderboard"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1391730982123-0"><div id="google_ads_iframe_/11757429/hub_development_leader_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_leader_0" name="google_ads_iframe_/11757429/hub_development_leader_0" width="728" height="90" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div><div class="page-content"><main class="content"><div class="section-header view view--loaded"><div class="section-header__navigation"><div class="section-header__topic"><a class="section-header__topic-link topic-link topic-code" href="http://code.tutsplus.com/"><div class="section-header__section-icon section-header__section-icon--tutorials"></div>Code</a></div><ul class="section-header__nav-links"><li class="section-header__nav-link section-header__nav-link--dropdown"><div class="section-header__categories-menu"><a class="section-header__categories-menu-toggle" href="javascript:"><span class="section-header__categories-menu-title">Categories</span> <i class="fa fa-chevron-down"></i></a><ul class="section-header__categories-menu-items"><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/web-development">Web Development</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/wordpress">WordPress</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/mobile-development">Mobile Development</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/php">PHP</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/flash">Flash</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/javascript">JavaScript</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/news">News</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/ios-sdk">iOS SDK</a></li><li class="section-header__categories-menu-item"><a class="section-header__categories-menu-link" href="http://code.tutsplus.com/categories/cms">CMS</a></li><li class="section-header__categories-menu-more"><a class="section-header__categories-menu-link section-header__categories-menu-more-link" href="http://code.tutsplus.com/categories">More...</a></li></ul></div></li><li class="section-header__nav-link section-header__nav-link--direct"><a href="http://code.tutsplus.com/categories">Categories</a></li><li class="section-header__nav-link section-header__nav-link--dropdown"><div class="section-header__learning-guides-menu"><a class="section-header__learning-guides-menu-toggle" href="javascript:"><span class="section-header__learning-guides-menu-title">Learning Guides</span> <i class="fa fa-chevron-down"></i></a><ul class="section-header__learning-guides-menu-items"><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/mobile-wordpress-theming--mobile-22898">Mobile WordPress Theming</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/swift-from-scratch--cms-709">Swift from Scratch</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/the-solid-principles--cms-634">The SOLID Principles</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/the-complete-guide-to-the-wordpress-settings-api--cms-624">The Complete Guide To The WordPress Settings API</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/use-jquery-mobile-to-build-a-native-android-news-reader-app--mobile-22910">Use jQuery Mobile to Build a Native Android News Reader App</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/getting-to-know-backbonejs--net-24408">Getting to Know Backbone.js</a></li><li class="section-header__learning-guides-menu-item"><a class="section-header__learning-guides-menu-link" href="http://code.tutsplus.com/series/introduction-to-craft-cms--cms-846">Introduction to Craft CMS</a></li><li class="section-header__learning-guides-menu-more"><a class="section-header__learning-guides-menu-link section-header__learning-guides-menu-more-link" href="http://code.tutsplus.com/series">More...</a></li></ul></div></li><li class="section-header__nav-link section-header__nav-link--direct"><a href="http://code.tutsplus.com/series">Learning Guides</a></li><li class="section-header__nav-link"><a href="https://community.tutsplus.com/">Forum</a></li></ul></div></div><article class="post tutorial"><div class="layout__offset-content-with-sidebar layout__offset-content-with-sidebar--post"><div class="post__header"><div class="content-header view content-header--post view--loaded"><div class="content-header__category"><a class="content-header__category-link" href="http://code.tutsplus.com/categories/ruby">Ruby</a></div><h1 class="content-header__title nolinks">Build a Dropbox-like File Sharing Site with Ruby on Rails</h1><div class="content-header__publication-meta"><span class="content-header__author-by"></span>by <span class="content-header__author"><a class="content-header__author-link" rel="author" href="http://tutsplus.com/authors/phyo-wai">Phyo Wai</a></span><time class="content-header__publication-date" datetime="2011-01-30T12:00:58Z" title="30 Jan 2011">30 Jan 2011</time><span class="content-header__comment-count"><i class="icon tutsicon-comment content-header__comment-icon"></i><a data-disqus-identifier="1122514980" class="content-header__comment-count-link" href="http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940#disqus_thread">8 Comments</a></span></div><div class="content-header__social-share-links sticky-block--floating"><ul class="social-share-links"><li class="social-share-links__item"><a title="Share on Facebook" class="social-share-links__link social-share-links__link--facebook" href="https://www.facebook.com/dialog/feed?app_id=1494084460809023&link=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940&display=page&name=Build%20a%20Dropbox-like%20File%20Sharing%20Site%20with%20Ruby%20on%20Rails&redirect_uri=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940"><i class="fa fa-facebook-square social-share-links__icon"></i><div class="social-share-links__count">4</div></a></li><li class="social-share-links__item"><a target="_blank" title="Share on Twitter" class="social-share-links__link social-share-links__link--twitter" href="https://twitter.com/intent/tweet?text=Build%20a%20Dropbox-like%20File%20Sharing%20Site%20with%20Ruby%20on%20Rails&url=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940&via=tutsplus"><i class="fa fa-twitter social-share-links__icon"></i><div class="social-share-links__count">3</div></a></li><li class="social-share-links__item"><a target="_blank" title="Share on Google+" class="social-share-links__link social-share-links__link--google-plus" href="https://plus.google.com/share?url=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940"><i class="fa fa-google-plus social-share-links__icon"></i><div class="social-share-links__count">5</div></a></li><li class="social-share-links__item"><a target="_blank" title="Pin on Pinterest" class="social-share-links__link social-share-links__link--pinterest" href="https://www.pinterest.com/pin/create/button/?url=http%3A%2F%2Fcode.tutsplus.com%2Ftutorials%2Fbuild-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940&description=Build%20a%20Dropbox-like%20File%20Sharing%20Site%20with%20Ruby%20on%20Rails&media=https%3A%2F%2Fcms-assets.tutsplus.com%2Flegacy-premium-tutorials%2Fdefault-preview-images%2Fcode.png"><i class="fa fa-pinterest social-share-links__icon"></i><div class="social-share-links__count--blank">Share</div></a></li></ul></div></div></div><div class="post-body view view--loaded"><div class="post-body__body"><script async="" charset="utf-8" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/widgets.js"></script><div class="post-body__content"><p>In this Tuts+ Premium tutorial, we'll learn how to build a file-sharing web application, like <a href="http://dropbox.com/">Dropbox</a>, using Ruby on Rails.<!--more--><br>
</p><hr>
<h2 class="nolinks">Introduction</h2>
<p>The enormous success of DropBox clearly shows that there's a huge need for simple and fast file sharing.</p>
<p>Our app will have the following features: </p>
<ul>
<li>simple user authentication</li>
<li>upload files and save them in Amazon S3</li>
<li>create folders and organize</li>
<li>share folders with other users</li>
</ul>
<p>Throughout the tutorial, I will point out different ways that we can improve our app. Along the way, we'll review a variety of concepts, including Rails scaffolding and AJAX.</p>
<hr>
<h2 class="nolinks"> <span>Step 0</span> Getting Ready</h2>
<blockquote class="pullquote pqRight">
<p>
"Make sure that you upgrade to Rails 3 to follow along with this tutorial."</p>
</blockquote>
<p>Before we begin, ensure that you have all of the followings installed on your machine:</p>
<ul>
<li>Ruby 1.9.+</li>
<li>Rails 3+</li>
<li>MySQL 5</li>
</ul>
<p>If you're brand new to Ruby and Rails, you can start the learning process <a href="http://rubyonrails.org/">here</a>. We will be making use of Terminal (Mac), or the Command Line, if you're a Windows user. </p>
<hr>
<h2 class="nolinks"> <span>Step 1</span> Create a New Rails App</h2>
<p>First, we need to create a Rails app. Open Terminal, and browse to your desired folder. We'll call our app, "ShareBox." Type the following into Terminal.</p>
<div><div id="highlighter_83572" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails </code><code class="ruby keyword">new</code> <code class="ruby plain">sharebox -d mysql</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"The <code>-d mysql</code> option is added to ensure that the app uses MySQL as its database, since, by default, it will use sqlite3."</p>
</blockquote>
<p>This will create a file and folder structure, similar to what's shown below.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_3ffd3a476ae8a9200bb1be0ab8289489.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/rails_app_structure.png"><br>
        </figure>
<p>We now must make sure that we have the correct gems installed. Open the "Gemfile" from your Rails directory, and replace all of the code inside with the following:</p>
<div><div id="highlighter_639849" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">source </code><code class="ruby string">'<a href="http://rubygems.org/">http://rubygems.org</a>'</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby plain">gem </code><code class="ruby string">'Rails'</code><code class="ruby plain">, </code><code class="ruby string">'3.0.3'</code></div><div class="line number4 index3 alt1"><code class="ruby plain">gem </code><code class="ruby string">'ruby-mysql'</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"The Gemfile is the file where you put all the necessary gems required to run this specific app. It helps you organize the gems you would need."</p>
</blockquote>
<p>Since we are using Rails 3 and MySQL, those two gems are added to the Gemfile. Then we need to run the following command in the Rails "sharebox" directory using Terminal. If you are not in the "sharebox" directory, type "cd sharebox" to go into the folder.</p>
<div><div id="highlighter_460817" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">bundle install</code></div></div></td></tr></tbody></table></div></div>
<p>The command <code>bundle install</code> will install all gems defined in the Gemfile if they haven't already been installed.</p>
<p>Next, let's make sure that we have a working database connection, and the database, "sharebox," set up. From the 'sharebox' folder, open "config/<span class="skimlinks-unlinked">database.yml</span>." Change the development and test environment settings, like so:</p>
<div><div id="highlighter_678223" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">development: </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">adapter: mysql </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">encoding: utf8 </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">reconnect: </code><code class="ruby keyword">false</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">database: sharebox_development </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">pool: </code><code class="ruby constants">5</code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">username: root </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">password: </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">socket: /tmp/mysql.sock </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="ruby plain">test: </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">adapter: mysql </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">encoding: utf8 </code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">reconnect: </code><code class="ruby keyword">false</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">database: sharebox_test </code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">pool: </code><code class="ruby constants">5</code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">username: root </code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">password: </code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">socket: /tmp/mysql.sock</code></div></div></td></tr></tbody></table></div></div>
<p>Of course, replace your own MySQL connection details, accordingly. Additionally, you might need to change the socket and add <code>host</code> to make it work. Run the following command in the Terminal (under the "sharebox" folder).</p>
<div><div id="highlighter_481272" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">rake db</code><code class="ruby color2">:create</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"If you don't see any feedback once this command has completed, you are good to go."</p>
</blockquote>
<p>Now if you do, you'll probably need to change the <span class="skimlinks-unlinked">database.yml</span> file to match your system's MySQL connection settings.</p>
<p>Let's review our application in the browser. Run the following in Terminal:</p>
<div><div id="highlighter_344192" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails server</code></div></div></td></tr></tbody></table></div></div>
<p>You'll see something like the following in your Terminal.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_0afe08651c520e044b147933241a2117.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/rails_server.png"><br>
        </figure>
<p>Now, fire up your favourite browse such as Firefox or Chrome, and type this in the address bar:</p>
<div><div id="highlighter_648148" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain"><a href="http://localhost/">http://localhost:</a></code><code class="ruby constants">3000</code><code class="ruby plain">/</code></div></div></td></tr></tbody></table></div></div>
<p>You should see the Rails' default home page as follows:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_5c0d9258ec030f8bf1415536ca24ad2b.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/rail_default_page.png"><br>
        </figure>
<hr>
<h2 class="nolinks"> <span>Step 2</span> Create User Authentication</h2>
<p>Next up, we'll create basic user authentication.</p>
<p>We'll use the fantastic <a href="https://github.com/plataformatec/devise">devise</a> gem to help with our user authentication. We can also use <a href="http://railscasts.com/">Ryan's</a> <a href="https://github.com/ryanb/nifty-generators">nifty-generator</a> to help with our layout and view helpers.</p>
<p>Add those two gems to your Gemfile at the bottom:</p>
<div><div id="highlighter_195615" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#for user authentication </code></div><div class="line number2 index1 alt1"><code class="ruby plain">gem </code><code class="ruby string">'devise'</code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby comments">#for layout and helpers generations </code></div><div class="line number5 index4 alt2"><code class="ruby plain">gem </code><code class="ruby string">"nifty-generators"</code><code class="ruby plain">, </code><code class="ruby color2">:group</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:development</code></div></div></td></tr></tbody></table></div></div>
<blockquote class="pullquote pqRight">
<p>"Don't forget to run <code>bundle install</code> to install those gems on your system."</p>
</blockquote>
<p>Once the gems are installed, let's start by installing some layouts using nifty-generator. Type the following into Terminal to generate the layout files in the "sharebox" directory.</p>
<div><div id="highlighter_889905" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g nifty</code><code class="ruby color2">:layout</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>"'Rails g' is short-hand for <code>Rails generate.</code></p>
</blockquote>
<p>It will ask you if you want to overwrite the "layouts/<span class="skimlinks-unlinked">application.html.erb</span>". Press "Y" and Enter key to proceed. It will then create a few files which we will be using in a while.</p>
<p>Now let's install "devise". Type this in Terminal:</p>
<div><div id="highlighter_816989" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g devise</code><code class="ruby color2">:install</code></div></div></td></tr></tbody></table></div></div>
<p>This command will install a handful of files, but it'll also ask you to perform three things manually.</p>
<p>First, copy the following line, and paste it into "config/environments/<span class="skimlinks-unlinked">development.rb</span>". Paste it just before the last "end."</p>
<div><div id="highlighter_503917" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">config.action_mailer.default_url_options = { </code><code class="ruby color2">:host</code> <code class="ruby plain">=&gt; </code><code class="ruby string">'localhost:3000'</code> <code class="ruby plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Secondly, we have to set up the root_url in "config/<span class="skimlinks-unlinked">routes.rb</span>" file. Open the file and add:</p>
<div><div id="highlighter_654454" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Sharebox::Application.routes.draw </code><code class="ruby keyword">do</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">root </code><code class="ruby color2">:to</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"home#index"</code></div><div class="line number4 index3 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>We'll skip the last step as it's been done by the nifty generator.</p>
<p>Now, let's create our first model, <code>User</code>, using "devise". </p>
<div><div id="highlighter_862454" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Sharebox::Application.routes.draw </code><code class="ruby keyword">do</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">root </code><code class="ruby color2">:to</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"home#index"</code></div><div class="line number4 index3 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This will create a few files within your Rails directory. Let's have a quick look at the migration file, "db/migrate/[datetime]<span class="skimlinks-unlinked">_devise_create_users.rb</span>". It should look something along the lines of:</p>
<div><div id="highlighter_9604" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">DeviseCreateUsers &lt; ActiveRecord::Migration </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.up </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">create_table(</code><code class="ruby color2">:users</code><code class="ruby plain">) </code><code class="ruby keyword">do</code> <code class="ruby plain">|t| </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.database_authenticatable </code><code class="ruby color2">:null</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">false</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.recoverable </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.rememberable </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.trackable </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments"># t.confirmable </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments"># t.lockable :lock_strategy =&gt; :failed_attempts, :unlock_strategy =&gt; :both </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments"># t.token_authenticatable </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.timestamps </code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:users</code><code class="ruby plain">, </code><code class="ruby color2">:email</code><code class="ruby plain">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="ruby color2">:unique</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:users</code><code class="ruby plain">, </code><code class="ruby color2">:reset_password_token</code><code class="ruby plain">, </code><code class="ruby color2">:unique</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments"># add_index :users, :confirmation_token,&nbsp;&nbsp; :unique =&gt; true </code></div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments"># add_index :users, :unlock_token,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :unique =&gt; true </code></div><div class="line number21 index20 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number22 index21 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.down </code></div><div class="line number24 index23 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">drop_table </code><code class="ruby color2">:users</code></div><div class="line number25 index24 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number26 index25 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Devise contains built-in features ready for use out of the box. Among these great features, we'll be using: </p>
<ul>
<li>
<code>database_authenticatable</code>: authenticates users. </li>
<li> <code>recoverable</code>: lets the user recover or change a password, if needed.</li>
<li> <code>rememberable</code>: lets the user "remember" their account on their system whenever they login. </li>
<li> <code>trackable</code>: tracks the log in count, timestamps, and IP address. </li>
</ul>
<p>The migration also adds two indexes for "email" and "reset_password_token".</p>
<p>We won't change much, but we will add a "name" field to the table, and remove all commented lines as follows:</p>
<div><div id="highlighter_285227" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">DeviseCreateUsers &lt; ActiveRecord::Migration </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.up </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">create_table(</code><code class="ruby color2">:users</code><code class="ruby plain">) </code><code class="ruby keyword">do</code> <code class="ruby plain">|t| </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.database_authenticatable </code><code class="ruby color2">:null</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">false</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.recoverable </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.rememberable </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.trackable </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.string </code><code class="ruby color2">:name</code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.timestamps </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:users</code><code class="ruby plain">, </code><code class="ruby color2">:email</code><code class="ruby plain">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="ruby color2">:unique</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:users</code><code class="ruby plain">, </code><code class="ruby color2">:reset_password_token</code><code class="ruby plain">, </code><code class="ruby color2">:unique</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.down </code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">drop_table </code><code class="ruby color2">:users</code></div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number21 index20 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Next, run <code>rake db:migrate</code> in the Terminal. This should create a "users" table in the Database. Let's check the User model at "app/models/<span class="skimlinks-unlinked">user.rb</span>," and add the "name" attribute there. Also, let's add some validation as well.</p>
<div><div id="highlighter_470301" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">User &lt; ActiveRecord::Base </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments"># Include default devise modules. Others available are: </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments"># :token_authenticatable, :confirmable, :lockable and :timeoutable </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">devise </code><code class="ruby color2">:database_authenticatable</code><code class="ruby plain">, </code><code class="ruby color2">:registerable</code><code class="ruby plain">, </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:recoverable</code><code class="ruby plain">, </code><code class="ruby color2">:rememberable</code><code class="ruby plain">, </code><code class="ruby color2">:trackable</code><code class="ruby plain">, </code><code class="ruby color2">:validatable</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments"># Setup accessible (or protected) attributes for your model </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">attr_accessible </code><code class="ruby color2">:email</code><code class="ruby plain">, </code><code class="ruby color2">:name</code><code class="ruby plain">, </code><code class="ruby color2">:password</code><code class="ruby plain">, </code><code class="ruby color2">:password_confirmation</code><code class="ruby plain">, </code><code class="ruby color2">:remember_me</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">validates </code><code class="ruby color2">:email</code><code class="ruby plain">, </code><code class="ruby color2">:presence</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code><code class="ruby plain">, </code><code class="ruby color2">:uniqueness</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code></div><div class="line number11 index10 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Before we move on, we need to quickly add a Home controller with an Index action for the root url. Create a file "<span class="skimlinks-unlinked">home_controller.rb</span>" in the "app/controllers" folder. Next, add the followings inside the file for Index action:</p>
<div><div id="highlighter_427679" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">HomeController &lt; ApplicationController </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number6 index5 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Don't forget; we have to create a view for this as well. Create a folder, named "home" inside "app/views/," and add an "<span class="skimlinks-unlinked">index.html.erb</span>" file there. Append the following to this file.</p>
<div><div id="highlighter_79710" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">This is the Index.html.erb under "app/views/home" folder.</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"We need to remove/delete the 'public/<span class="skimlinks-unlinked">index.html</span>' file to make root_url work correctly."</p>
</blockquote>
<p>Now let's try creating a user, and then sign in/out to get the feel for devise's magic. You need to restart the Rails server (by pressing Ctrl+C and running 'Rails server') to reload all the new installed files from devise. Then go to http://localhost:3000 and you should see:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_b57029b4ee4c1eb0f9a0c5963e399937.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/draft_home_page.png"><br>
        </figure>
<p>If we browse to <code>http://localhost:3000/users/sign_up</code>, which is one of the default routes already built-in by Devise, to sign up users, you should see this:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_4f64dda0a0a55bb67bd9cb4dd0117991.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/user_sign_up_page.png"><br>
        </figure>
<p>Notice how the <code>name</code> field is not there yet? We need to change the view to add the name. Since Devise views are hidden by default, we must unhide them with the following command.</p>
<div><div id="highlighter_48370" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g devise</code><code class="ruby color2">:views</code></div></div></td></tr></tbody></table></div></div>
<p>Open "app/views/devise/registrations/<span class="skimlinks-unlinked">new.html.erb</span>" and edit the file to add the "name" field to the form.</p>
<div><div id="highlighter_864432" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">h2</code><code class="html plain">&gt;Sign up&lt;/</code><code class="html keyword">h2</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="html plain">&lt;%= form_for(resource, :as =&gt; resource_name, :url =&gt; registration_path(resource_name)) do |f| %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= devise_error_messages! %&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.label :email %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.text_field :email %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.label :name %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.text_field :name %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.label :password %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.password_field :password %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number14 index13 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.label :password_confirmation %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number16 index15 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.password_field :password_confirmation %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number17 index16 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number18 index17 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.submit "Sign up" %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number19 index18 alt2"><code class="html plain">&lt;% end %&gt; </code></div><div class="line number20 index19 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number21 index20 alt2"><code class="html plain">&lt;%= render :partial =&gt; "devise/shared/links" %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>If you refresh the page, you should now see:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_2660639d2b2ebd30a87a45c580833e22.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_user_sign_up_page.png"><br>
        </figure>
<p>If you fill in the form and submit it to create a new user, you'll then see the following image, which means you have successfully created the user, and have logged in.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_9544455f0a36622f5ff481648bc6eacc.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_user_sign_up_confirmation_page.png"><br>
        </figure>
<p>To sign out, go to "http://localhost:3000/users/sign_out" and you'll be signed out with this flash message.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_2df4184e44664e30abe8f7466c57c3ef.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/user_sign_out.png"><br>
        </figure>
<p>You can then sign back in at "http://localhost:3000/users/sign_in" with your login credentials:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_ccd3139b658299e6c509ce73ddd6d12a.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/user_sign_in.png"><br>
        </figure>
<p>We now have the basic authentication working. The next step is for tidying up the layout and look and feel of the pages along with the links.</p>
<hr>
<h2 class="nolinks"> <span>Step 3</span> Add Basic CSS</h2>
<blockquote><p>
"The 'app/views/layouts/<span class="skimlinks-unlinked">application.html.erb</span>' layout file will be applied to all view pages unless you specify your own layout file."
</p></blockquote>
<p>Before we do anything, change the title of each page. Open up "app/views/layouts/<span class="skimlinks-unlinked">application.html.erb</span>" file and revise the title like so:</p>
<div><div id="highlighter_607931" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">title</code><code class="html plain">&gt;ShareBox | &lt;%= content_for?(:title) ? yield(:title) : "File-sharing web app" %&gt;&lt;/</code><code class="html keyword">title</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>That'll make the titles look like "ShareBox | File-sharing web app", "ShareBox | Upload files" and so on.</p>
<p>Next, we'll add "Sign In" and "Sign out" links into the same <span class="skimlinks-unlinked">application.html.erb</span> layout file. In the body tag, just before the "container" <code>div</code>, add this:</p>
<div><div id="highlighter_133056" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"header_wrapper"</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"logo"</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "ShareBox", root_url %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This markup/code will add a Logo (text) with a clickable link. We'll add the CSS in a bit. Now place this snippet of html with Ruby code for showing User login, log out links. Make sure you add this in the "header_wrapper" <code>div</code> after the "logo" <code>div</code>.</p>
<div><div id="highlighter_903381" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">id</code><code class="html plain">=</code><code class="html string">"login_user_status"</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% if user_signed_in? %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= current_user.email&nbsp; %&gt;&nbsp; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">| </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Sign out", destroy_user_session_path %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% else %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">em</code><code class="html plain">&gt;Not Signed in.&lt;/</code><code class="html keyword">em</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to 'Sign in', new_user_session_path%&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">or </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to 'Sign up', new_user_registration_path%&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number12 index11 alt1"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"The <code>user_signed_in?</code> method determines whether a user has logged in."</p>
</blockquote>
<p>The paths <code>destroy_user_session_path</code>, <code>new_user_session_path</code> and <code>new_user_registration_path</code> are the default paths provided by devise for Signing out, Signing in and Signing up, respectively.</p>
<p>Now let's add the necessary CSS to make things look a bit better. Open the "public/stylesheets/<span class="skimlinks-unlinked">application.css</span>" file, and insert the following CSS. Make sure you replace the "body" and "container" styles as well.</p>
<div><div id="highlighter_727185" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">body { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">background-color</code><code class="css plain">: </code><code class="css value">#EFEFEF</code><code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">font-family</code><code class="css plain">: </code><code class="css string">"Lucida Grande"</code><code class="css plain">,</code><code class="css string">"Verdana"</code><code class="css plain">,</code><code class="css string">"Arial"</code><code class="css plain">,</code><code class="css string">"Bitstream Vera Sans"</code><code class="css plain">,</code><code class="css color1">sans-serif</code><code class="css plain">; </code></div><div class="line number4 index3 alt1"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">: </code><code class="css value">14px</code><code class="css plain">; </code></div><div class="line number5 index4 alt2"><code class="css plain">} </code></div><div class="line number6 index5 alt1"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="css plain">.header_wrapper { </code></div><div class="line number8 index7 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">: </code><code class="css value">880px</code><code class="css plain">; </code></div><div class="line number9 index8 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">margin</code><code class="css plain">: </code><code class="css value">0</code> <code class="css value">auto</code><code class="css plain">; </code></div><div class="line number10 index9 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">overflow</code><code class="css plain">:</code><code class="css value">hidden</code><code class="css plain">; </code></div><div class="line number11 index10 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">:</code><code class="css value">20px</code> <code class="css value">0</code><code class="css plain">; </code></div><div class="line number12 index11 alt1"><code class="css plain">} </code></div><div class="line number13 index12 alt2"><code class="css plain">.logo a{ </code></div><div class="line number14 index13 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">: </code><code class="css value">#338DCF</code><code class="css plain">; </code></div><div class="line number15 index14 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">: </code><code class="css value">left</code><code class="css plain">; </code></div><div class="line number16 index15 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">: </code><code class="css value">48px</code><code class="css plain">; </code></div><div class="line number17 index16 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-weight</code><code class="css plain">: </code><code class="css value">bold</code><code class="css plain">; </code></div><div class="line number18 index17 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">text-shadow</code><code class="css plain">: </code><code class="css value">2px</code> <code class="css value">2px</code> <code class="css value">2px</code> <code class="css value">#FFFFFF</code><code class="css plain">; </code></div><div class="line number19 index18 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">text-decoration</code><code class="css plain">:</code><code class="css value">none</code><code class="css plain">; </code></div><div class="line number20 index19 alt1"><code class="css plain">} </code></div><div class="line number21 index20 alt2"><code class="css plain">#container { </code></div><div class="line number22 index21 alt1"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">: </code><code class="css value">800px</code><code class="css plain">; </code></div><div class="line number23 index22 alt2"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">margin</code><code class="css plain">: </code><code class="css value">0</code> <code class="css value">auto</code><code class="css plain">; </code></div><div class="line number24 index23 alt1"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">background-color</code><code class="css plain">: </code><code class="css value">#FFF</code><code class="css plain">; </code></div><div class="line number25 index24 alt2"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">: </code><code class="css value">20px</code> <code class="css value">40px</code><code class="css plain">; </code></div><div class="line number26 index25 alt1"><code class="css spaces">&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">: </code><code class="css value">solid</code> <code class="css value">1px</code> <code class="css value">#BFBFBF</code><code class="css plain">;&nbsp;&nbsp; </code></div><div class="line number27 index26 alt2"><code class="css plain">} </code></div><div class="line number28 index27 alt1"><code class="css plain">#login_user_status { </code></div><div class="line number29 index28 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">right</code><code class="css plain">;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number30 index29 alt1"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>If you refresh the home page in your browser, you'll see:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_347a1fc0efb065f94313ef28acef4c03.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_home_page.png"><br>
        </figure>
<hr>
<h2 class="nolinks"> <span>Step 4</span> Uploading Files</h2>
<p>We'll be using the <a href="https://github.com/thoughtbot/paperclip">Paperclip</a> gem to help us upload files. Add this gem in Gemfile as follows, and run "bundle install" in the Terminal.</p>
<div><div id="highlighter_175045" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#for uploading files </code></div><div class="line number2 index1 alt1"><code class="ruby plain">gem </code><code class="ruby string">"paperclip"</code><code class="ruby plain">, </code><code class="ruby string">"~&gt; 2.3"</code></div></div></td></tr></tbody></table></div></div>
<p>Once installed, we'll create our File table. However, since the word "File" is one of the <a href="http://wiki.rubyonrails.org/Rails/pages/reservedwords">Reserved Words</a>, we'll just use the term "Asset" for the files.</p>
<p>One user can upload multiple files, so we need to add <code>user_id</code> to the <code>Asset</code> model. So run this in the Terminal to scaffold the <code>Asset</code> model.</p>
<div><div id="highlighter_55317" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g nifty</code><code class="ruby color2">:scaffold</code> <code class="ruby plain">Asset user_id</code><code class="ruby color2">:integer</code></div></div></td></tr></tbody></table></div></div>
<p>Next, go to the newly created migration file, within the "db/migrate/" folder, and add the index for the <code>user_id.</code></p>
<div><div id="highlighter_343545" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">add_index </code><code class="ruby color2">:assets</code><code class="ruby plain">, </code><code class="ruby color2">:user_id</code></div></div></td></tr></tbody></table></div></div>
<p>Run <code>rake db:migrate</code> in Terminal to create the Asset table.</p>
<p>Then we need to add relationships to both the <code>User</code> and <code>Asset</code> table. In "app/models/<span class="skimlinks-unlinked">user.rb</span>" file, add this.</p>
<div><div id="highlighter_976091" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">has_many </code><code class="ruby color2">:assets</code></div></div></td></tr></tbody></table></div></div>
<p>In "app/models/<span class="skimlinks-unlinked">asset.rb</span>", add this:</p>
<div><div id="highlighter_987782" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">belongs_to </code><code class="ruby color2">:user</code></div></div></td></tr></tbody></table></div></div>
<p>Now it's time to use those relationships in the controller for loading the relevant resources(assets) for each logged in user. Within "app/controllers/<span class="skimlinks-unlinked">assets_controller.rb</span>", alter the code, like so: </p>
<div><div id="highlighter_900649" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">AssetsController &lt; ApplicationController </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">before_filter </code><code class="ruby color2">:authenticate_user</code><code class="ruby plain">!&nbsp; </code><code class="ruby comments">#authenticate for users before any methods is called </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= current_user.assets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">show </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">new</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.</code><code class="ruby keyword">new</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">create </code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.</code><code class="ruby keyword">new</code><code class="ruby plain">(params[</code><code class="ruby color2">:asset</code><code class="ruby plain">]) </code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number21 index20 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number22 index21 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">edit </code></div><div class="line number23 index22 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number24 index23 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number25 index24 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number26 index25 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">update </code></div><div class="line number27 index26 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number28 index27 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number29 index28 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number30 index29 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number31 index30 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">destroy </code></div><div class="line number32 index31 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number33 index32 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number34 index33 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number35 index34 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>In the code above, we're making sure that the asset(s) requested is, in fact, owned or created by the current_user (logged-in user), since "current_user.assets" will give you assets which are "belonged to" the user.</p>
<p>Then let's run Paperclip's migration script to add some necessary fields in Asset model. We'll name the main file field as "uploaded_file". So type this in Terminal.</p>
<div><div id="highlighter_716575" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g paperclip asset uploaded_file</code></div></div></td></tr></tbody></table></div></div>
<p>Run "rake db:migrate" to add the fields.</p>
<p>Now that we have added the "uploaded_file" field in the table, we then need to add it in the model. So in the "app/models/<span class="skimlinks-unlinked">user.rb</span>" Model, add the "uploaded_file" field, and define it as "attachment," using Paperclip.</p>
<div><div id="highlighter_968691" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">attr_accessible </code><code class="ruby color2">:user_id</code><code class="ruby plain">, </code><code class="ruby color2">:uploaded_file</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby plain">belongs_to </code><code class="ruby color2">:user</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby comments">#set up "uploaded_file" field as attached_file (using Paperclip) </code></div><div class="line number7 index6 alt2"><code class="ruby plain">has_attached_file </code><code class="ruby color2">:uploaded_file</code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby plain">validates_attachment_size </code><code class="ruby color2">:uploaded_file</code><code class="ruby plain">, </code><code class="ruby color2">:less_than</code> <code class="ruby plain">=&gt; </code><code class="ruby constants">10</code><code class="ruby plain">.megabytes&nbsp;&nbsp; </code></div><div class="line number10 index9 alt1"><code class="ruby plain">validates_attachment_presence </code><code class="ruby color2">:uploaded_file</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"<code>validates_attachment_size</code> and <code>validates_attachment_presence</code> are validation methods provided by Paperclip to let you validate the file uploaded. In this case, we are checking if a file is uploaded and if the file size is less than 10 MB."</p>
</blockquote>
<p>We use <code>has_attached_file</code> to identify which field is for saving the uploaded file data. It's provided by Paperclip anyway.</p>
<p>Before we test this out, let's change the view a bit to handle the file upload. So open up "app/views/assets/<span class="skimlinks-unlinked">_form.html.erb</span>" file and insert the following.</p>
<div><div id="highlighter_659165" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= form_for @asset, :html =&gt; {:multipart =&gt; true} do |f| %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.error_messages %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.label :uploaded_file, "File" %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.file_field :uploaded_file %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.submit "Upload" %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>In the <code>form_for</code> method, we have added the html attribute, "multipart," to be <code>true</code>. It's always needed to post the file to the server correctly. We've also removed the <code>user_id</code> field from the view. </p>
<p>Now it's time to test things out. </p>
<blockquote class="pullquote pqRight">
<p>
"Restarting the Rails server is necessary each time you add and install a new gem."</p>
</blockquote>
<p>If you visit "http://localhost:3000/assets/new", you should see something like:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_e4efdc6295e172cb83a636522063d29e.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/upload_file.png"><br>
        </figure>
<p>Once you upload a file, and go to "http://localhost:3000/assets", you'll see:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_154d67a401bff6ebe9b8dfc8bb817ed3.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/ugly_list_files.png"><br>
        </figure>
<p>It's not quite right, is it? So let's change the "list" view of the assets. Open "app/views/assets/<span class="skimlinks-unlinked">index.html.erb</span>" file and insert:</p>
<div><div id="highlighter_1153" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% title "Assets" %&gt; </code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;</code><code class="html keyword">table</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">tr</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">th</code><code class="html plain">&gt;Uploaded Files&lt;/</code><code class="html keyword">th</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">tr</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;% for asset in @assets %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">tr</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">td</code><code class="html plain">&gt;&lt;%= link_to asset.uploaded_file_file_name, asset.uploaded_file.url %&gt;&lt;/</code><code class="html keyword">td</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">td</code><code class="html plain">&gt;&lt;%= link_to "Show", asset %&gt;&lt;/</code><code class="html keyword">td</code><code class="html plain">&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">td</code><code class="html plain">&gt;&lt;%= link_to "Edit", edit_asset_path(asset) %&gt;&lt;/</code><code class="html keyword">td</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">td</code><code class="html plain">&gt;&lt;%= link_to "Destroy", asset, :confirm =&gt; 'Are you sure?', :method =&gt; :delete %&gt;&lt;/</code><code class="html keyword">td</code><code class="html plain">&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">tr</code><code class="html plain">&gt; </code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number14 index13 alt1"><code class="html plain">&lt;/</code><code class="html keyword">table</code><code class="html plain">&gt; </code></div><div class="line number15 index14 alt2"><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= link_to "New Asset", new_asset_path %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>As you can see, we have updated the header to "Uploaded Files," and have added the link instead of User Id. <code>asset</code> now has the <code>uploaded_file</code> accessor to load the file details. One of the methods available is "url," which gives you the full url of the file location. Paperclip also saves the file name in the name of the field we defined ("uploaded_file" in our case) plus "_file_name". So we have "uploaded_file_file_name" as the name of the file. </p>
<p>With that in mind, let's quickly refactor this to have a nicer name for the actual file name. Place this method in the Asset model located at "app/models/<span class="skimlinks-unlinked">asset.rb</span>".</p>
<div><div id="highlighter_815060" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">file_name </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">uploaded_file_file_name </code></div><div class="line number3 index2 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This code should allow you to use something like "asset.file_name" to get the uploaded file's actual file name. Make sure you update the <span class="skimlinks-unlinked">index.html.erb</span> page with the new file_name method, as exemplified below.</p>
<div><div id="highlighter_319681" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">td</code><code class="html plain">&gt;&lt;%= link_to asset.uploaded_file_file_name, asset.uploaded_file.url %&gt;&lt;/</code><code class="html keyword">td</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Now if we refresh the page "http://localhost:3000/assets", you'll see:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_7c23d49bda49377daa38c167efe8bfa7.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_file_list.png"><br>
        </figure>
<p>If you then click the link in the file, you'll be taken to a url, like "http://localhost:3000/system/uploaded_files/1/original/<span class="skimlinks-unlinked">Venus.gif?1295900873</span>".</p>
<blockquote>
<p>
"By default, Paperclip will save the files under your Rails root at <code>system/[name of the file field]s/:id/original/:file_name</code>."</p>
</blockquote>
<h3 class="nolinks"> But These Links Are Public! </h3>
<p>One of our goals for this application is to secure the uploaded files from unauthorized access. But as you can see, the link is quite open to the public, and you can download it even after logging out. Let's fix this.</p>
<p>First, we should think of a nice url for the file to be downloaded from. "system/uploaded_files/1/original/" looks nice, right?</p>
<blockquote>
<p>
"So we will make the url like this 'http://localhost:3000/assets/get/1' which looks a lot neater."</p>
</blockquote>
<p>Let's change the <code>Asset</code> model to store the uploaded file in the "assets" folder rather than "system" folder. Change the code like so:</p>
<div><div id="highlighter_903742" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">has_attached_file </code><code class="ruby color2">:uploaded_file</code><code class="ruby plain">, </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:url</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"/assets/get/:id"</code><code class="ruby plain">, </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:path</code> <code class="ruby plain">=&gt; </code><code class="ruby string">":Rails_root/assets/:id/:basename.:extension"</code></div></div></td></tr></tbody></table></div></div>
<p>The option <code>:url</code> is for the url you would see in the address bar to download the file, whereas the <code>path</code> is for the place to actually store the file on your machine. </p>
<p>The <code>:Rails_root</code> is the physical root directory of your Rails app, such as "C:\web_apps\sharebox" (windows) or "/Users/phyowaiwin/Sites/apps/sharebox" (mac). The <code>:id</code> is the id of the Asset file record. The <code>:basename</code> is the file name (without extension) and <code>:extension</code> is for the file extension.</p>
<p>We are essentially instructing Paperclip to store the uploaded files in the "assets" folder, under the Rails root folder. The url would be the same as if we wanted: "http://localhost:3000/assets/get/1".</p>
<p>Now let's destroy the file at <em>http://localhost:3000/assets</em> and re-upload the file to <em>http://localhost:3000/assets/new</em>.</p>
<p>When you click on the file link, it should take you to a url like <em>http://localhost:3000/assets/get/2</em> which should display this error.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_fce066f3fc283d6d622953bf95e0e00c.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/error_no_file.png"><br>
        </figure>
<p>This is due to the fact that we haven't added any routes to handle this. Secondly, there isn't an action or controller to take care of the file download. Let's create a route first within the <code>config/routes.rb</code> file.</p>
<div><div id="highlighter_381306" class="syntaxhighlighter noskimlinks noskimwords ruby "><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this route is for file downloads </code></div><div class="line number2 index1 alt1"><code class="ruby plain">match </code><code class="ruby string">"assets/get/:id"</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"assets#get"</code><code class="ruby plain">, </code><code class="ruby color2">:as</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"download"</code></div></div></td></tr></tbody></table></div></div>
<p>This means, when the url is accessed, it should route to the <code>get</code> action at <code>assets_controller</code>. This also gives up the <code>download_url()</code> named-route. Let's make use of this route quickly in <code>app/views/assets/index.html.erb</code>:</p>
<div><div id="highlighter_121532" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">&lt;%= link_to asset.file_name, download_url(asset) %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Okay, now we need to add the <code>get</code> action to <code>app/controllers/assets_controller.rb</code>.</p>
<div><div id="highlighter_128466" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this action will let the users download the files (after a simple authorization check) </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">get </code></div><div class="line number3 index2 alt2"><code class="ruby plain">asset = current_user.assets.find_by_id(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number4 index3 alt1"><code class="ruby keyword">if</code> <code class="ruby plain">asset </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">send_file asset.uploaded_file.path, </code><code class="ruby color2">:type</code> <code class="ruby plain">=&gt; asset.uploaded_file_content_type </code></div><div class="line number6 index5 alt1"><code class="ruby keyword">end</code></div><div class="line number7 index6 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<blockquote class="pullquote pqRight">
<p>
"<code>find_by_id(:id)</code> will return null if no record with an <code>id</code> is found, whereas <code>find(:id)</code> will raise an exception if no record is found."</p>
</blockquote>
<p>Above, we first grab the <code>id</code> and find it within the current_user's own assets. We then determine if the asset is found. If it is, we use the Rails method <code>send_file</code> to let the user download the file. <code>send_file</code> takes a "path" as a first parameter and file_type (content_type) as the second.</p>
<p>Now if you click the file link on the page, you should be able to download the file.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_ee24069eb5eef3a1452e5268d1e0e598.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/file_download.png"><br>
        </figure>
<p>This is now much better. The download link is fairly secure now. You can now copy the URL of the download link (eg., <em>http://localhost:3000/assets/get/2</em>), logout from the application and go the link again. It should ask you to login first before you can download the file. Even after you've logged in, if you attempt to download a file which is not yours, you'll receive an error for now.</p>
<p>We'll put a nice message for users who are trying to access other people files. In the same <code>get</code> action of <code>assets_controller</code>, change the code like so:</p>
<div><div id="highlighter_234757" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">asset = current_user.assets.find_by_id(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">if</code> <code class="ruby plain">asset </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">send_file asset.uploaded_file.path, </code><code class="ruby color2">:type</code> <code class="ruby plain">=&gt; asset.uploaded_file_content_type </code></div><div class="line number4 index3 alt1"><code class="ruby keyword">else</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:error</code><code class="ruby plain">] = </code><code class="ruby string">"Don't be cheeky! Mind your own assets!"</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to assets_path </code></div><div class="line number7 index6 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Above, we've added a flash message. To try this out, login to the system, and browse to a URL, like <em>http://localhost:3000/assets/get/22</em> (which you shouldn't have access to). As a result, you will be presented with this:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_35c99db2e32b959b0c4d9ff6b66e1481.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/dont_be_cheeky.png"><br>
        </figure>
<h3 class="nolinks">Further Potential Improvements</h3>
<p>The above method for letting the users download files will most likely be fine for an application with a small number of users and traffic. But once you get more and more requests (for download), the Rails app will suffer from using the default <code>send_file</code> method, since the Rails process will read through the entire file, copying the contents of the file to the output stream as it goes. </p>
<p>However, it can be easily fixed by using <code>X-Sendfile</code>. It's available as an <a href="https://tn123.org/mod_xsendfile/">apache module</a>. You can read more about how Rails handle downloading files with <code>send_file</code> <a href="http://www.therailsway.com/2009/2/22/file-downloads-done-right">here</a>.</p>
<hr>
<h2 class="nolinks"> <span>Step 5</span> Integrate Amazon S3</h2>
<blockquote>
<p>
"Now we will review how to store the files on Amazon S3 instead of your local machine. You may <code>skip</code> this step and move on to Step 6 if you don't require this functionality."</p>
</blockquote>
<p>Since our application is for storing files and sharing them, we shouldn't ignore the opportunity to use <a href="http://aws.amazon.com/s3/">Amazon S3</a>. After all, most of us are already using it, aren't we?</p>
<p>
Storing files on your local machine (or your server) will limit the application, when it comes to data storage. Let's make this app use S3 to store the files to prevent some headaches which might come up later.</p>
<p>As always, we don't want to waste time reinventing the wheel. Instead, why not use the brilliant gem, called <code>aws-s3</code> to help Paperclip use Amazon S3 to store the files. Let's add that to our Gemfile, and run <code>bundle install</code> in Terminal.</p>
<div><div id="highlighter_694500" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#for Paperclip to use Amazon S3 </code></div><div class="line number2 index1 alt1"><code class="ruby plain">gem </code><code class="ruby string">"aws-s3"</code></div></div></td></tr></tbody></table></div></div>
<p>Next, let's change the Asset model for the paperclip configuration to instruct it to store the files in S3. Go to <code>app/models/asset.rb</code> and change the <code>has_attached_file</code>, as below:</p>
<div><div id="highlighter_692689" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">has_attached_file </code><code class="ruby color2">:uploaded_file</code><code class="ruby plain">, </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:path</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"assets/:id/:basename.:extension"</code><code class="ruby plain">, </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:storage</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:s3</code><code class="ruby plain">, </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:s3_credentials</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"#{Rails_ROOT}/config/amazon_s3.yml"</code><code class="ruby plain">, </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:bucket</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"shareboxapp"</code></div></div></td></tr></tbody></table></div></div>
<blockquote class="pullquote pqRight">
<p>
"The Paperclip version we are using doesn't seem to create the <code>bucket</code> if it doesn't exist. So you need to <code>create the bucket first</code> on Amazon S3 first."</p>
</blockquote>
<p><code>:storage</code> says that we'll store the files in S3. You should put your bucket name in the <code>:bucket</code> option. Of course, S3 requires the proper credentials in order to upload the files. We'll provide the credentials in the <code>config/amazon_s3.yml</code> file. Create this file, and insert credentials. An example file is provided below:</p>
<div><div id="highlighter_355493" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">development: </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">access_key_id: your_own_access_key_id </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">secret_access_key: your_own_secret_access_key </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="ruby plain">staging: </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">access_key_id: your_own_access_key_id </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">secret_access_key: your_own_secret_access_key </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby plain">production: </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">access_key_id: your_own_access_key_id </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">secret_access_key: your_own_secret_access_key</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"The bucket namespace is shared by all users of the Amazon S3 system. So make sure that you use a <code>unique bucket name</code>."</p>
</blockquote>
<p>If you restart your Rails server and upload a file, you should see the file within the S3 bucket. I use the amazing S3fox Firefox plugin to browse my S3 folders and files.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_cd429ea9e084a723fd708250741a5bbb.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/s3_file_upload.png"><br>
        </figure>
<p>However, if you go to the index page of the <code>assets</code> controller and click on the newly uploaded file, you'll  be faced with this error.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_9c0a80390ab2048fbad34969e06582b7.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/error_s3_download.png"><br>
        </figure>
<p>This error notes that the application can't find the file at <em>assets/3/<span class="skimlinks-unlinked">Saturn.gif</span></em>. Although we have specified that we should -- within Paperclip's configuration -- use S3 as storage, we are still using the <code>send_file</code> method, which only sends the local files from your machine (or your server), not from a remote location, like Amazon S3.</p>
<p>Let's fix this by changing the <code>get</code> action in the <span class="skimlinks-unlinked">assets_controller.rb</span></p>
<div><div id="highlighter_567257" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">get </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">asset = current_user.assets.find_by_id(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">asset&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#redirect to amazon S3 url which will let the user download the file automatically </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to asset.uploaded_file.url, </code><code class="ruby color2">:type</code> <code class="ruby plain">=&gt; asset.uploaded_file_content_type </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:error</code><code class="ruby plain">] = </code><code class="ruby string">"Don't be cheeky! Mind your own assets!"</code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to assets_path </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number10 index9 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>We have just redirected the link to Amazon's S3 file. Let's see this in action by clicking the file link again on the index page of the assets. You will then be redirected to the actual location of the file stored on S3 such as <em>http://s3.<span class="skimlinks-unlinked">amazonaws.com/shareboxapp/assets/3/Saturn.gif?1295915759</span></em>.</p>
<blockquote>
<p>
"Exposing a downloadable link from your Amazon s3 is never a good thing, unless you intend to actually share it with others."</p>
</blockquote>
<p>As you can see, this time the downloadable links aren't secure anymore. You can even download the files without logging in. We need to do something about it.</p>
<p>There are a couple of options available to us. </p>
<ul>
<li>We can try to download the file from S3 to the server (or your machine) first, and, in the background, send the file to the user.</li>
<li>We could stream the file from S3 while opening it in a Rails process to server the data (file) back to the user.</li>
</ul>
<p>We'll use the first option for now to progress quickly, as the second one is far more advanced to get it right, which will be outside of the scope of this tutorial.</p>
<p>So let's change the <code>get</code> action again in <span class="skimlinks-unlinked">assets_controller.rb</span>.</p>
<div><div id="highlighter_533869" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">get </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">asset = current_user.assets.find_by_id(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">asset </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#Parse the URL for special characters first before downloading </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">data = open(</code><code class="ruby constants">URI</code><code class="ruby plain">.parse(</code><code class="ruby constants">URI</code><code class="ruby plain">.encode(asset.uploaded_file.url))) </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#then again, use the "send_data" method to send the above binary "data" as file. </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">send_data data, </code><code class="ruby color2">:filename</code> <code class="ruby plain">=&gt; asset.uploaded_file_file_name </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#redirect to amazon S3 url which will let the user download the file automatically </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#redirect_to asset.uploaded_file.url, :type =&gt; asset.uploaded_file_content_type </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:error</code><code class="ruby plain">] = </code><code class="ruby string">"Don't be cheeky! Mind your own assets!"</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number17 index16 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>We've added a couple of lines here. The first one is used for parsing the Amazon s3 url strings (for special characters like spaces etc) and opening the file there, using the "<code>open</code>" method. That will return the binary data, which we can then send as a file back to the user, using the <code>send_data</code> method in the next line.</p>
<p>If we return and click the file link again, you'll get the download file, as shown below, without seeing the actual Amazon s3 url. </p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_85720ee52b2a1166d74b72a4b0e1c5ef.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/s3_proper_download.png"><br>
        </figure>
<p>Well that's better, right? Not quite. Because we are opening the file from Rails first, before passing it to the user, you could face a significant delay before you can download the file. But we will leave things as-is for simplicity's sake. </p>
<p>In the next step, we'll list the files properly on the home page.</p>
<hr>
<h2 class="nolinks"> <span>Step 6</span> Show Files on the Home Page</h2>
<p>Let's list the files nicely on the home page. We will show the files when the user goes to the <code>root_url</code> (which is at <em>http://localhost:3000</em>). Since the <code>root_url</code> actually directs to the <code>Index</code> action of the <code>Home</code> controller, we'll change the action now. </p>
<div><div id="highlighter_638390" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">user_signed_in? </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= current_user.assets.order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number5 index4 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Above, we loaded the <em>@assets</em> instance variable with the current_user's own assets -- if the user is logged in. We also order the files by the "file name".</p>
<p>Next, in <code>app/views/home/index.html.erb</code>, insert the following:</p>
<div><div id="highlighter_173571" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% unless user_signed_in? %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">h1</code><code class="html plain">&gt;Welcome to ShareBox&lt;/</code><code class="html keyword">h1</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;File sharing web application you can't ignore.&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_list_header"</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name_header"</code><code class="html plain">&gt;File Name&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size_header"</code><code class="html plain">&gt;Size&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated_header"</code><code class="html plain">&gt;Modified&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_list"</code><code class="html plain">&gt; </code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% @assets.each do |asset| %&gt; </code></div><div class="line number14 index13 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_details"</code><code class="html plain">&gt; </code></div><div class="line number15 index14 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name"</code><code class="html plain">&gt;&lt;%= link_to asset.file_name, download_url(asset) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number16 index15 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size"</code><code class="html plain">&gt;&lt;%= asset.uploaded_file_file_size %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number17 index16 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated"</code><code class="html plain">&gt;&lt;%= asset.uploaded_file_updated_at %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number18 index17 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number19 index18 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number20 index19 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number21 index20 alt2"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We've added a condition to check if the user has logged in or not. If the user has not, he/she will see:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_6800f06802dd265a87104857a45cb4db.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/better_home_page.png"><br>
        </figure>
<p>If the user has logged in, we'll use the <em>@assets</em> we set in the controller to loop through it to show the <code>File Name</code>, <code>File Size</code> and <code>Last modified date time</code>. Paperclip provides file_size information in the form of <em>[field_name]_file_size</em>. This will provide you with the total <code>bytes</code> of the file. What we mean by <code>Last modified date time</code> here is the time when the file was uploaded. Paperclip also provides it as <em>[field_name]_updated_at</em>.</p>
<blockquote>
<p>
"Without the proper styling, what we have here looks quite ugly. So let's add some CSS."</p>
</blockquote>
<p>Now, open the <code>public/stylesheets/application.css</code> file, and add the following styles to the bottom of the file.</p>
<div><div id="highlighter_619754" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">.asset_list_header, .asset_list, .asset_details { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">800px</code><code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-weight</code><code class="css plain">:</code><code class="css value">bold</code><code class="css plain">; </code></div><div class="line number4 index3 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">12px</code><code class="css plain">; </code></div><div class="line number5 index4 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">overflow</code><code class="css plain">:</code><code class="css value">hidden</code><code class="css plain">; </code></div><div class="line number6 index5 alt1"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="css plain">} </code></div><div class="line number8 index7 alt1"><code class="css plain">.file_name_header, .file_name { </code></div><div class="line number9 index8 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">350px</code><code class="css plain">; </code></div><div class="line number10 index9 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">left</code><code class="css plain">; </code></div><div class="line number11 index10 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding-left</code><code class="css plain">:</code><code class="css value">20px</code><code class="css plain">; </code></div><div class="line number12 index11 alt1"><code class="css plain">} </code></div><div class="line number13 index12 alt2"><code class="css plain">.file_size_header, .file_size { </code></div><div class="line number14 index13 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">100px</code><code class="css plain">; </code></div><div class="line number15 index14 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">left</code><code class="css plain">; </code></div><div class="line number16 index15 alt1"><code class="css plain">} </code></div><div class="line number17 index16 alt2"><code class="css plain">.file_last_updated_header, .file_last_updated { </code></div><div class="line number18 index17 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">150px</code><code class="css plain">; </code></div><div class="line number19 index18 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">left</code><code class="css plain">; </code></div><div class="line number20 index19 alt1"><code class="css plain">} </code></div><div class="line number21 index20 alt2"><code class="css plain">.asset_list { </code></div><div class="line number22 index21 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">:</code><code class="css value">20px</code> <code class="css value">0</code><code class="css plain">; </code></div><div class="line number23 index22 alt2"><code class="css plain">} </code></div><div class="line number24 index23 alt1"><code class="css plain">.asset_details { </code></div><div class="line number25 index24 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-weight</code><code class="css plain">:</code><code class="css value">normal</code><code class="css plain">; </code></div><div class="line number26 index25 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">height</code><code class="css plain">:</code><code class="css value">25px</code><code class="css plain">; </code></div><div class="line number27 index26 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">line-height</code><code class="css plain">:</code><code class="css value">25px</code><code class="css plain">; </code></div><div class="line number28 index27 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#FFF</code><code class="css plain">; </code></div><div class="line number29 index28 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">790px</code><code class="css plain">; </code></div><div class="line number30 index29 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#4F4F4F</code><code class="css plain">; </code></div><div class="line number31 index30 alt2"><code class="css plain">} </code></div><div class="line number32 index31 alt1"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number33 index32 alt2"><code class="css plain">.asset_details a, .asset_details a:visited { </code></div><div class="line number34 index33 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">text-decoration</code><code class="css plain">:</code><code class="css value">none</code><code class="css plain">; </code></div><div class="line number35 index34 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#1D96EF</code><code class="css plain">; </code></div><div class="line number36 index35 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">12px</code><code class="css plain">; </code></div><div class="line number37 index36 alt2"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>I won't go much into the details here, as it exceeds the scope of this tutorial.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_15fa96a3fc70e29ba149671db74bf3da.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_files_list.png"><br>
        </figure>
<p>As you can see, the file size and last modified fields look quite weird at the moment. So let's add a method in the Asset model to help with File Size info. Go to <code>app/models/asset.rb</code> file and add this method.</p>
<div><div id="highlighter_157865" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">file_size </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">uploaded_file_file_size </code></div><div class="line number3 index2 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This method acts as an alias for <code>uploaded_file_file_size</code>. You can also call <em>asset.file_size</em> instead. While we're here, let's make the <em>bytes</em> more readable. On the <code>app/views/home/index.html.erb</code> page, change the <em>asset.uploaded_file_file_size</em> to:</p>
<div><div id="highlighter_245189" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">number_to_human_size(asset.file_size, </code><code class="ruby color2">:precision</code> <code class="ruby plain">=&gt; </code><code class="ruby constants">2</code><code class="ruby plain">)</code></div></div></td></tr></tbody></table></div></div>
<p>We have just used the <code>number_to_human_size</code> view helper from Rails to help with file size info.</p>
<p>Before we refresh the page to see the changes, let's add the following lines to the <code>config/environment.rb</code> file.</p>
<div><div id="highlighter_606791" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#Formatting DateTime to look like "20/01/2011 10:28PM" </code></div><div class="line number2 index1 alt1"><code class="ruby color1">Time</code><code class="ruby plain">::</code><code class="ruby constants">DATE_FORMATS</code><code class="ruby plain">[</code><code class="ruby color2">:default</code><code class="ruby plain">] = </code><code class="ruby string">"%d/%m/%Y %l:%M%p"</code></div></div></td></tr></tbody></table></div></div>
<blockquote><p>Always restart the Rails server when you make a change within your environment files.</p></blockquote>
<p>Restart the Rails server and refresh the home page. </p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_7ddabcee07eb548b5210351229b67ab0.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/home_page_new.png"><br>
        </figure>
<p>From the home page, we can't do much, except to view the files. Let's add an Upload button to the top. </p>
<div><div id="highlighter_328988" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% unless user_signed_in? %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">h1</code><code class="html plain">&gt;Welcome to ShareBox&lt;/</code><code class="html keyword">h1</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;File sharing web application you can't ignore.&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">id</code><code class="html plain">=</code><code class="html string">"menu"</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">ul</code> <code class="html color1">id</code><code class="html plain">= </code><code class="html string">"top_menu"</code><code class="html plain">&gt;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "Upload", new_asset_path %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">ul</code><code class="html plain">&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">... </code></div><div class="line number12 index11 alt1"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>The upload button is linked to creating a new asset_path as we wanted. Now we'll add the following CSS into the <code>application.css</code> file.</p>
<div><div id="highlighter_667178" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">#menu { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">800px</code><code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">:</code><code class="css value">0</code> <code class="css value">20px</code><code class="css plain">; </code></div><div class="line number4 index3 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">margin</code><code class="css plain">:</code><code class="css value">20px</code> <code class="css value">auto</code> <code class="css plain">; </code></div><div class="line number5 index4 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">overflow</code><code class="css plain">:</code><code class="css value">hidden</code><code class="css plain">; </code></div><div class="line number6 index5 alt1"><code class="css plain">} </code></div><div class="line number7 index6 alt2"><code class="css plain">#menu ul{ </code></div><div class="line number8 index7 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">:</code><code class="css value">0</code><code class="css plain">; </code></div><div class="line number9 index8 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">margin</code><code class="css plain">:</code><code class="css value">0</code><code class="css plain">; </code></div><div class="line number10 index9 alt1"><code class="css plain">} </code></div><div class="line number11 index10 alt2"><code class="css plain">#menu ul li { </code></div><div class="line number12 index11 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">list-style</code><code class="css plain">:</code><code class="css value">none</code><code class="css plain">; </code></div><div class="line number13 index12 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">left</code><code class="css plain">; </code></div><div class="line number14 index13 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">display</code><code class="css plain">:</code><code class="css value">block</code><code class="css plain">; </code></div><div class="line number15 index14 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">margin-right</code><code class="css plain">:</code><code class="css value">10px</code><code class="css plain">; </code></div><div class="line number16 index15 alt1"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number17 index16 alt2"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number18 index17 alt1"><code class="css plain">} </code></div><div class="line number19 index18 alt2"><code class="css plain">#menu ul li a, #menu ul li a:visited{ </code></div><div class="line number20 index19 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">display</code><code class="css plain">:</code><code class="css value">block</code><code class="css plain">; </code></div><div class="line number21 index20 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">:</code><code class="css value">0</code> <code class="css value">15px</code><code class="css plain">; </code></div><div class="line number22 index21 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">line-height</code><code class="css plain">:</code><code class="css value">25px</code><code class="css plain">; </code></div><div class="line number23 index22 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">text-decoration</code><code class="css plain">:</code><code class="css value">none</code><code class="css plain">; </code></div><div class="line number24 index23 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#45759F</code><code class="css plain">; </code></div><div class="line number25 index24 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">#EFF8FF</code><code class="css plain">; </code></div><div class="line number26 index25 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#CFEBFF</code><code class="css plain">; </code></div><div class="line number27 index26 alt2"><code class="css plain">} </code></div><div class="line number28 index27 alt1"><code class="css plain">#menu ul li a:hover, #menu ul li a:active{ </code></div><div class="line number29 index28 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">#DFF1FF</code><code class="css plain">; </code></div><div class="line number30 index29 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#AFDDFF</code><code class="css plain">; </code></div><div class="line number31 index30 alt2"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>If you refresh the page, it should look like the following:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_be958f1089914eb3a463c153697dd424.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/upload_button.png"><br>
        </figure>
<p>Let's next customize the <code>app/views/assets/new.html.erb</code>. </p>
<div><div id="highlighter_261037" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% title "Upload a file" %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="html plain">&lt;%= render 'form' %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= link_to "Back to List", root_url %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>In next step, we'll learn how to create folders.</p>
<hr>
<h2 class="nolinks"> <span>Step 7</span> Create Folders</h2>
<blockquote>
<p>
We need to organize our files and folders. The app needs to provide the ability to allow users to create folder structures, and upload files within them.</p>
</blockquote>
<p>We can create folders virtually on the views by using the database table(model), called Folder. We won't be actually creating the folders on the file system or on the Amazon S3. We'll basically make the concept and add the feature effortlessly.</p>
<p>Let's begin by creating the <code>Folder</code> model. Run the following Scaffold command in the Terminal:</p>
<div><div id="highlighter_592399" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g nifty</code><code class="ruby color2">:scaffold</code> <code class="ruby plain">Folder name</code><code class="ruby color2">:string</code> <code class="ruby plain">parent_id</code><code class="ruby color2">:integer</code> <code class="ruby plain">user_id</code><code class="ruby color2">:integer</code></div></div></td></tr></tbody></table></div></div>
<p>With that command, we've added <code>name</code> for the name of the folder, and <code>user_id</code> for the relationship with the user. One user <em>has many</em> folders and one folder <em>belongs to</em> a user. We've also added a <code>parent_id</code> for storing the nested folders. </p>
<p>That <code>parent_id</code> field is also a necessity for the gem "<a href="https://github.com/Rails/acts_as_tree">acts_as_tree</a>," which we will use to help with our nested folders. Now open the newly created migration file and add the following database indexes:</p>
<div><div id="highlighter_899001" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">add_index </code><code class="ruby color2">:folders</code><code class="ruby plain">, </code><code class="ruby color2">:parent_id</code></div><div class="line number2 index1 alt1"><code class="ruby plain">add_index </code><code class="ruby color2">:folders</code><code class="ruby plain">, </code><code class="ruby color2">:user_id</code></div></div></td></tr></tbody></table></div></div>
<p>Run "<code>rake db:migrate</code>" to create the Folder model.</p>
<p>Then go to the <code>User</code> (<code>app/models/user.rb</code>) model to update this.</p>
<div><div id="highlighter_895264" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">has_many </code><code class="ruby color2">:folders</code></div></div></td></tr></tbody></table></div></div>
<p>And go to Folder (<code>app/models/folder.rb</code>) model to update it as well.</p>
<div><div id="highlighter_851324" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">belongs_to </code><code class="ruby color2">:user</code></div></div></td></tr></tbody></table></div></div>
<p>Let's add the <code>acts_as_tree</code> gem to the Gemfile.</p>
<div><div id="highlighter_516313" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#For nested folders </code></div><div class="line number2 index1 alt1"><code class="ruby plain">gem </code><code class="ruby string">"acts_as_tree"</code></div></div></td></tr></tbody></table></div></div>
<p>We need to add this in the Folder model as part of the set up for <code>acts_as_tree</code>.</p>
<div><div id="highlighter_333180" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">Folder &lt; ActiveRecord::Base </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">acts_as_tree </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number4 index3 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Now, run <code>bundle install</code>, and restart your Rails server.</p>
<blockquote>
<p>
"<code>acts_as_tree</code> allows you to use methods, like <code>folder.children</code> to access sub-folders, and <code>folder.ancestors</code> to access root folders."</p>
</blockquote>
<p>Next, within <code>app/controllers/folders_controller.rb</code>, change the following, which allows for securing the folders for the user who owns them:</p>
<div><div id="highlighter_299193" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">FoldersController &lt; ApplicationController </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby plain">before_filter </code><code class="ruby color2">:authenticate_user</code><code class="ruby plain">! </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folders</code> <code class="ruby plain">= current_user.folders </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">show </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">new</code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.</code><code class="ruby keyword">new</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">create </code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.</code><code class="ruby keyword">new</code><code class="ruby plain">(params[</code><code class="ruby color2">:folder</code><code class="ruby plain">]) </code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number21 index20 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">edit </code></div><div class="line number22 index21 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number23 index22 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number24 index23 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number25 index24 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">update </code></div><div class="line number26 index25 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number27 index26 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number28 index27 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number29 index28 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number30 index29 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">destroy </code></div><div class="line number31 index30 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number32 index31 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number33 index32 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number34 index33 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Above, we added <code>before_filter :authenticate_user!</code> to the top, which requires users to first login in order to gain access. Secondly, we changed all the <code>Folder.new</code> or <code>Folder.find</code> to <code>current_user.folders.new</code> to make sure the user is viewing/accessing the folder that he or she owns.</p>
<p>Let's change the view for this. Open <code>app/views/folders/_form.html.erb</code>.</p>
<div><div id="highlighter_290428" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= form_for @folder do |f| %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;%= f.error_messages %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.label :name %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.text_field :name %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.submit "Create Folder" %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Here, we've removed the two fields ("user_id" and "parent_id").</p>
<p>You can now see the list of folders at <em>http://localhost:3000/folders</em>. You can also create new folders at <em>http://localhost:3000/folders/new</em>. Next, we'll put those folders on the home page.</p>
<hr>
<h2 class="nolinks"> <span>Step 8</span> Display Folders on the Home Page</h2>
<p>To display folders on the home page, we need to load the folders in an instance variable from the controller. Go ahead and open <code>app/controllers/home_controller.rb</code> to add this in the <code>index</code> action.</p>
<div><div id="highlighter_364508" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">user_signed_in? </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#load current_user's folders </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folders</code> <code class="ruby plain">= current_user.folders.order(</code><code class="ruby string">"name desc"</code><code class="ruby plain">)&nbsp;&nbsp; </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#load current_user's files(assets) </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= current_user.assets.order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number9 index8 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>We've added a line to load the user's folders into the <em>@folders</em> instance variable.</p>
<p>Then, on the <code>app/views/home/index.html.erb</code> page, update the code, like the following, to list the folders.</p>
<div><div id="highlighter_50111" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_list"</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html comments">&lt;!-- Listing Folders --&gt;</code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% @folders.each do |folder| %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_details folder"</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name"</code><code class="html plain">&gt;&lt;%= link_to folder.name, folder_path(folder) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size"</code><code class="html plain">&gt; - &lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated"</code><code class="html plain">&gt; - &lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html comments">&lt;!-- Listing Files --&gt;</code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% @assets.each do |asset| %&gt; </code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_details file"</code><code class="html plain">&gt; </code></div><div class="line number14 index13 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name"</code><code class="html plain">&gt;&lt;%= link_to asset.file_name, download_url(asset) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number15 index14 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size"</code><code class="html plain">&gt;&lt;%= number_to_human_size(asset.file_size, :precision =&gt; 2) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number16 index15 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated"</code><code class="html plain">&gt;&lt;%= asset.uploaded_file_updated_at %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number17 index16 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number18 index17 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number19 index18 alt2"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We've used the <em>@folders</em> variable to list the folders and link them to <em>folder_path</em>. Now, if you refresh the home page, you should see something like:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_c6e867f60683d2cd095c0bc736466522.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/folder_list_home_page.png"><br>
        </figure>
<p>Though, it doesn't seem obvious which one is a folder, and which is a file. Since we've already added the CSS classes <code>file</code> and <code>folder</code>, we will only have to grab some images and use them in the stylesheet as background images.</p>
<p>You can use any images you like. For this tutorial, we'll use <a href="http://jonas.seph.ws/stuff/drf.zip">some</a> of <a href="http://www.jonasraskdesign.com/downloads/downloads.html">these images</a>. Download them and place them in the  <code>public/images</code> folder. Next, let's add some CSS to <code>application.css</code>.</p>
<div><div id="highlighter_581128" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">.folder&nbsp; { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">url</code><code class="css plain">(</code><code class="css string">"../images/folder.png"</code><code class="css plain">) </code><code class="css value">no-repeat</code> <code class="css value">scroll</code> <code class="css value">left</code> <code class="css value">center</code> <code class="css value">transparent</code><code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css plain">} </code></div><div class="line number4 index3 alt1"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="css plain">.file { </code></div><div class="line number6 index5 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">url</code><code class="css plain">(</code><code class="css string">"../images/file.png"</code><code class="css plain">) </code><code class="css value">no-repeat</code> <code class="css value">scroll</code> <code class="css value">left</code> <code class="css value">center</code> <code class="css value">transparent</code><code class="css plain">; </code></div><div class="line number7 index6 alt2"><code class="css plain">} </code></div><div class="line number8 index7 alt1"><code class="css plain">.folder.asset_details:hover, .shared_folder.asset_details:hover, .file.asset_details:hover&nbsp; { </code></div><div class="line number9 index8 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#DFDFDF</code><code class="css plain">; </code></div><div class="line number10 index9 alt1"><code class="css plain">} </code></div><div class="line number11 index10 alt2"><code class="css plain">.folder.asset_details:hover&nbsp; { </code></div><div class="line number12 index11 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">url</code><code class="css plain">(</code><code class="css string">"../images/folder.png"</code><code class="css plain">) </code><code class="css value">no-repeat</code> <code class="css value">scroll</code> <code class="css value">left</code> <code class="css value">center</code> <code class="css value">#EFEFEF</code><code class="css plain">; </code></div><div class="line number13 index12 alt2"><code class="css plain">} </code></div><div class="line number14 index13 alt1"><code class="css plain">.shared_folder&nbsp; { </code></div><div class="line number15 index14 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">url</code><code class="css plain">(</code><code class="css string">"../images/shared_folder.png"</code><code class="css plain">) </code><code class="css value">no-repeat</code> <code class="css value">scroll</code> <code class="css value">left</code> <code class="css value">center</code> <code class="css value">transparent</code><code class="css plain">; </code></div><div class="line number16 index15 alt1"><code class="css plain">} </code></div><div class="line number17 index16 alt2"><code class="css plain">.shared_folder.asset_details:hover&nbsp; { </code></div><div class="line number18 index17 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">url</code><code class="css plain">(</code><code class="css string">"../images/shared_folder.png"</code><code class="css plain">) </code><code class="css value">no-repeat</code> <code class="css value">scroll</code> <code class="css value">left</code> <code class="css value">center</code> <code class="css value">#EFEFEF</code><code class="css plain">; </code></div><div class="line number19 index18 alt2"><code class="css plain">} </code></div><div class="line number20 index19 alt1"><code class="css plain">.file.asset_details:hover&nbsp; { </code></div><div class="line number21 index20 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">background</code><code class="css plain">:</code><code class="css value">url</code><code class="css plain">(</code><code class="css string">"../images/file.png"</code><code class="css plain">) </code><code class="css value">no-repeat</code> <code class="css value">scroll</code> <code class="css value">left</code> <code class="css value">center</code> <code class="css value">#EFEFEF</code><code class="css plain">; </code></div><div class="line number22 index21 alt1"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>If you refresh the home page, you should see folder and file icons aligned next to each folder and files you have.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_03d2912242dacf4335adb8092fcaef2e.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/folder_list_new.png"><br>
        </figure>
<p>It's missing "New Folder" button, though. Let's add it next to the "Upload" button, like below:</p>
<div><div id="highlighter_530261" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "New Folder", new_folder_path %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_b876fe4d2f35ace3a11302450c29a84b.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_folder_button.png"><br>
        </figure>
<p>Great! What we have here is looking good. Next, we'll learn how to create nested folders, and display breadcrumbs.</p>
<hr>
<h2 class="nolinks"> <span>Step 9</span> Handle Nested Folders and Create Breadcrumbs</h2>
<p>In this step, we'll allow users to create folders inside other folders, using the <code>acts_as_tree</code> gem that we installed in Step 8.</p>
<p>Although we'll provide breadcrumbs navigation at the top of every page, we'll make the <em>URL</em> simple. Let's create a new route in the <code>config/routes.rb</code> file. Put this line near the top of the page.</p>
<div><div id="highlighter_714833" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">match </code><code class="ruby string">"browse/:folder_id"</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"home#browse"</code><code class="ruby plain">, </code><code class="ruby color2">:as</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"browse"</code></div></div></td></tr></tbody></table></div></div>
<p>With this route, we'll now have URLs like <em>http://localhost:3000/browse/23</em> to see the folder (with id 23). It will direct to the <em>browse</em> action of the <em>home</em> controller. This folder might be nested within another, but we won't care that in the URL. Instead, we'll deal with it in the controller. Add the following <em>browse</em> in the Home controller.</p>
<div><div id="highlighter_503571" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this action is for viewing folders </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">browse </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#get the folders owned/created by the current_user </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">])&nbsp;&nbsp; </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#getting the folders which are inside this @current_folder </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folders</code> <code class="ruby plain">= </code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">.children </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#We need to fix this to show files under a specific folder if we are viewing that folder </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= current_user.assets.order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">) </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">render </code><code class="ruby color2">:action</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"index"</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:error</code><code class="ruby plain">] = </code><code class="ruby string">"Don't be cheeky! Mind your own folders!"</code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number19 index18 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
<code>@current_folder.children</code> will give you all the folders of which the <code>@current_folder</code> is the <em>parent</em>.</p>
</blockquote>
<p>Ok, let's look at the code above, line by line. First, we determine if this folder is owned/created by the current_user and put it into <code>@current_folder</code>. Then, we get all the folders which are inside that folder.</p>
<p>Since we are going to use the <code>app/views/home/index.html.erb</code> view to render this, we need to provide the <code>@assets</code> variable. At the moment, we are listing all assets owned by the current_user, not the ones under that folder. We'll take care of that in a bit.</p>
<p>Finally, if you're trying to view a folder not owned by you, you'll receive a similar message like before, and will be redirected back to the home page.</p>
<p>A folder should have many files (assets), and a file should belongs to a folder. So we need to add a <code>folder_id</code> to the Asset model. Run this command to create a migration file.</p>
<div><div id="highlighter_573804" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g migration add_folder_id_to_assets folder_id</code><code class="ruby color2">:integer</code></div></div></td></tr></tbody></table></div></div>
<p>This will create a new migration file in the <code>db/migrate/</code> folder. Inside of this file, we'll add the index for <code>folder_id</code>, like so.</p>
<div><div id="highlighter_599359" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">AddFolderIdToAssets &lt; ActiveRecord::Migration </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.up </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_column </code><code class="ruby color2">:assets</code><code class="ruby plain">, </code><code class="ruby color2">:folder_id</code><code class="ruby plain">, </code><code class="ruby color2">:integer</code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:assets</code><code class="ruby plain">, </code><code class="ruby color2">:folder_id</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.down </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">remove_column </code><code class="ruby color2">:assets</code><code class="ruby plain">, </code><code class="ruby color2">:folder_id</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number10 index9 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Next, run <code>rake db:migrate</code>. This should add a new column, <code>folder_id</code> into the Assets table. Add the new field to the Asset model (<code>app/models/asset.rb</code>). Also, add a relationship to the Folder model.</p>
<div><div id="highlighter_437920" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">attr_accessible </code><code class="ruby color2">:user_id</code><code class="ruby plain">, </code><code class="ruby color2">:uploaded_file</code><code class="ruby plain">, </code><code class="ruby color2">:folder_id</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby plain">belongs_to </code><code class="ruby color2">:folder</code></div></div></td></tr></tbody></table></div></div>
<div><div id="highlighter_718031" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">has_many </code><code class="ruby color2">:assets</code><code class="ruby plain">, </code><code class="ruby color2">:dependent</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:destroy</code></div></div></td></tr></tbody></table></div></div>
<p>This time, we've added <code>:dependent =&gt; :destroy</code>; this instructs Rails to <em>destroy</em> all the assets which belong to the folder... once the folder is <em>destroyed</em>.</p>
<blockquote>
<p>
"If you are confused about <em>destroy</em> and <em>delete</em> in Rails, you might want to read <a href="http://www.nickpeters.net/2007/12/21/delete-vs-destroy/">this</a>."</p>
</blockquote>
<p>Back to the <code>browse</code> action in the Home controller, let's change the way we set the <code>@assets</code> variable.</p>
<div><div id="highlighter_977407" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this action is for viewing folders </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">browse </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show only files under this current folder </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= </code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">.assets.order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">) </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number9 index8 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>The <code>browse</code> action is now good to go. But, we need to revisit the
</p><p>index</p>
<p>action again, because we don't want to display all files and folders on the index page once you are logged.</p>
<blockquote>
<p>
"We wish to display only the <em>root</em> folders which have no parents, and only the files which are not under any folders."</p>
</blockquote>
<p>To achieve this, let's change the <code>index</code> action, as follows:</p>
<div><div id="highlighter_750792" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">user_signed_in? </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show only root folders (which have no parent folders) </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folders</code> <code class="ruby plain">= current_user.folders.roots&nbsp; </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show only root files which has no "folder_id" </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= current_user.assets.where(</code><code class="ruby string">"folder_id is NULL"</code><code class="ruby plain">).order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number9 index8 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p><code>Folder.roots</code> will give you all root folders which have no parents. This is one of the useful scopes provided by the <code>acts_as_tree</code> gem.</p>
<p>We also put a condition on the assets to grab only the ones which have no <code>folder_id</code>.</p>
<p>We've got the structure to show files and folders correctly. We now have to change the links to these folders to go to <code>browse_path</code>. On the Home index page, change the link, like so:</p>
<div><div id="highlighter_799812" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">&lt;!-- Listing Folders --&gt; </code></div><div class="line number2 index1 alt1"><code class="ruby plain">... </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">&lt;div </code><code class="ruby keyword">class</code><code class="ruby plain">=</code><code class="ruby string">"file_name"</code><code class="ruby plain">&gt;&lt;%= link_to folder.name, browse_path(folder) %&gt;&lt;/div&gt; </code></div><div class="line number4 index3 alt1"><code class="ruby plain">...</code></div></div></td></tr></tbody></table></div></div>
<p>Let's start by creating a new route within the <code>routes.rb</code> to enable the creation of "sub folders."</p>
<div><div id="highlighter_685060" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#for creating folders insiide another folder </code></div><div class="line number2 index1 alt1"><code class="ruby plain">match </code><code class="ruby string">"browse/:folder_id/new_folder"</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"folders#new"</code><code class="ruby plain">, </code><code class="ruby color2">:as</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"new_sub_folder"</code></div></div></td></tr></tbody></table></div></div>
<p>Above, we've added a new route, called <em>new_sub_folder</em>, which will allow for URLs, like <em>http://localhost:3000/browse/22/new_folder</em>. This will reference the <code>new</code> action of the <code>Folder</code> controller. We'll essentially be creating a new folder under the folder (with id 22 or so).</p>
<p>Now, we have to make a <code>New Folder</code> button that will direct to that route, if you are within another folder (ie. if you are at URLs like <em>http://localhost:3000/browse/22</em>). Let's add a conditional change on the Home index page to the <code>New Folder button</code>.</p>
<div><div id="highlighter_826488" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">&lt;% </code><code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code> <code class="ruby plain">%&gt; </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">&lt;li&gt;&lt;%= link_to </code><code class="ruby string">"New Folder"</code><code class="ruby plain">, new_sub_folder_path(</code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">) %&gt;&lt;/li&gt; </code></div><div class="line number3 index2 alt2"><code class="ruby plain">&lt;% </code><code class="ruby keyword">else</code> <code class="ruby plain">%&gt; </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">&lt;li&gt;&lt;%= link_to </code><code class="ruby string">"New Folder"</code><code class="ruby plain">, new_folder_path %&gt;&lt;/li&gt; </code></div><div class="line number5 index4 alt2"><code class="ruby plain">&lt;% </code><code class="ruby keyword">end</code> <code class="ruby plain">%&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We determine if the <code>@current_folder</code> exists. If it does, we know we are within a folder, thus, making the link direct to <code>new_sub_folder_path</code>. Otherwise, it'll still go to <code>normal new_folder_path</code>.</p>
<p>Now, it's time to change the <code>new</code> action in the Folder controller.</p>
<div><div id="highlighter_569700" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby keyword">new</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.</code><code class="ruby keyword">new</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#if there is "folder_id" param, we know that we are under a folder, thus, we will essentially create a subfolder </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">] </code><code class="ruby comments">#if we want to create a folder inside another folder </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#we still need to set the @current_folder to make the buttons working fine </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">]) </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#then we make sure the folder we are creating has a parent folder which is the @current_folder </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code><code class="ruby plain">.parent_id = </code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">.id </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number12 index11 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>We set the <code>parent_id</code> equal to the current_folder's <code>id</code> for the folder we are going to create. </p>
<div><div id="highlighter_681999" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= form_for @folder do |f| %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;%= f.error_messages %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.label :name %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.text_field :name %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.hidden_field :parent_id %&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.submit "Create Folder" %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Next, we should take care of the <code>create</code> action to redirect to a correct path, once the folder has been saved.</p>
<div><div id="highlighter_464872" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">create </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.</code><code class="ruby keyword">new</code><code class="ruby plain">(params[</code><code class="ruby color2">:folder</code><code class="ruby plain">]) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@folder</code><code class="ruby plain">.save </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:notice</code><code class="ruby plain">] = </code><code class="ruby string">"Successfully created folder."</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@folder</code><code class="ruby plain">.parent </code><code class="ruby comments">#checking if we have a parent folder on this one </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to browse_path(</code><code class="ruby variable bold">@folder</code><code class="ruby plain">.parent)&nbsp; </code><code class="ruby comments">#then we redirect to the parent folder </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code><code class="ruby comments">#if not, redirect back to home page </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">render </code><code class="ruby color2">:action</code> <code class="ruby plain">=&gt; </code><code class="ruby string">'new'</code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number14 index13 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This code ensures that the user is correctly redirected to the folder he/she was browsing before creating the folder.</p>
<p>Lastly, let's correct the "Back to List" link on the Folder creation page. This file is located at <code>app/views/folders/new.html.erb</code>. Open it and change it, as follows:</p>
<div><div id="highlighter_595553" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% title "New Folder" %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="html plain">&lt;%= render 'form' %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html plain">&lt;% if @folder.parent %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Back to '#{@folder.parent.name}' Folder", browse_path(@folder.parent) %&gt; </code></div><div class="line number8 index7 alt1"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Back to Home page", root_url %&gt; </code></div><div class="line number10 index9 alt1"><code class="html plain">&lt;% end %&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>The page should now have the necessary links, such as <code>Back to 'Documents' Folder</code>. </p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_a951056d3c7f67c2fbb07eb9ad3af418.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_folder_creation.png"><br>
        </figure>
<p>Now, let's create basic breadcrumb navigation for the pages.</p>
<p>Create a partial file, called <code>_breadcrumbs.html.erb</code> within the <code>app/views/home/</code> folder, and insert the following code:</p>
<div><div id="highlighter_904081" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"breadcrumbs"</code><code class="html plain">&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% if @current_folder #checking if we are under any folder %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "ShareBox", root_url %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% @current_folder.ancestors.reverse.each do |folder| %&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">» &lt;%= link_to folder.name, browse_path(folder) %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">»&nbsp; &lt;%= @current_folder.name %&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% else #if we are not under any folder%&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">ShareBox </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"<code>@current_folder.ancestors</code> provides us with a folders array, which contains all the parent folders of the <code>@current_folder</code>."</p>
</blockquote>
<p>In the code above, we are first determining if we are under any folders. If not (ie. if we are on the home page the first time), we simply show the text (not a link), "ShareBox."</p>
<p>Otherwise, we display a "ShareBox" link, so that users can return to the home page easily. Then, we use the <code>ancestors</code> method to get the parents folder and reverse it to display them correctly.</p>
<p>We finish it with the current_folder's name, which we display as plain text. Because the user is under that folder already, it doesn't need to be a link.</p>
<p>Now, let's add a bit of CSS to the <span class="skimlinks-unlinked">applications.css</span> file.</p>
<div><div id="highlighter_509756" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">.breadcrumbs { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css keyword">margin</code><code class="css plain">:</code><code class="css value">10px</code> <code class="css value">0</code><code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-weight</code><code class="css plain">:</code><code class="css value">bold</code><code class="css plain">; </code></div><div class="line number4 index3 alt1"><code class="css plain">} </code></div><div class="line number5 index4 alt2"><code class="css plain">.breadcrumbs a { </code></div><div class="line number6 index5 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#1D96EF</code><code class="css plain">; </code></div><div class="line number7 index6 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css keyword">text-decoration</code><code class="css plain">:</code><code class="css value">none</code><code class="css plain">; </code></div><div class="line number8 index7 alt1"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Finally, we have to call the partial in both the home and folder creation pages. Go to <code>app/views/home/index.html.erb</code>, and add the following, just after the "menu" <code>div</code>.</p>
<div><div id="highlighter_47833" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">&lt;%= render </code><code class="ruby color2">:partial</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"breadcrumbs"</code> <code class="ruby plain">%&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Also, add the following to <code>app/views/folders/new.html.erb</code>, just after the "title" line.</p>
<p> "home/breadcrumbs" %&gt;</p>
<p>Note that you have to pass the "home" directory to call the partial from the "folders" directory, because they are both  under the same directory. Let's see some screen shots of the breadcrumbs in action!</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_2929160d84f25cbb3c9dead78f0fcf03.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/bc_1.png"><br>
        </figure>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_b51cb5ca4665f7bbbf36b9224a62e095.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/bc_2.png"><br>
        </figure>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_820ac2887238b08cfd5d301dd568cac7.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/bc_3.png"><br>
        </figure>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_168bc543ba709a4c924736f69bdbc731.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/bc_4.png"><br>
        </figure>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_3e9e7487022a9f1e68c7460cf2f76ba3.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/bc_5.png"><br>
        </figure>
<p>This breadcrumb navigation should do quite well, for our needs. Next, we'll add the ability to upload and store files inside a folder.</p>
<hr>
<h2 class="nolinks"> <span>Step 10</span> Uploading Files to a Folder</h2>
<p>Similar to creating a sub folder, we'll use the same type of route for uploading a (sub) file under a folder. Open <code>routes.rb</code>, and add:</p>
<div><div id="highlighter_353698" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#for uploading files to folders </code></div><div class="line number2 index1 alt1"><code class="ruby plain">match </code><code class="ruby string">"browse/:folder_id/new_file"</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"assets#new"</code><code class="ruby plain">, </code><code class="ruby color2">:as</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"new_sub_file"</code></div></div></td></tr></tbody></table></div></div>
<p>This will create url structures, like <em>http://localhost:3000/browse/22/new_file</em>. It will also hit the <code>new</code> action of Asset controller. </p>
<p>Change the <code>Upload</code> button on the home page to direct to the correct url, if we are browsing a folder. So edit the "top_menu" link, as demonstrated below: </p>
<div><div id="highlighter_926157" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">ul</code> <code class="html color1">id</code><code class="html plain">= </code><code class="html string">"top_menu"</code><code class="html plain">&gt;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% if @current_folder %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "Upload", new_sub_file_path(@current_folder) %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "New Folder", new_sub_folder_path(@current_folder) %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% else %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "Upload", new_asset_path %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "New Folder", new_folder_path %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number9 index8 alt2"><code class="html plain">&lt;/</code><code class="html keyword">ul</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This code will make the <code>Upload</code> button direct to <code>new_asset_path</code>, if there's no <code>@current_folder</code>. If there is, on the other hand, it will direct to <code>new_sub_file_path</code>. </p>
<p>Next, change the <code>new</code> action of the Asset controller.</p>
<div><div id="highlighter_536019" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby keyword">new</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.build&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">] </code><code class="ruby comments">#if we want to upload a file inside another folder </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">]) </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code><code class="ruby plain">.folder_id = </code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">.id </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number7 index6 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Let's make a quick change to <code>app/views/assets/new.html.erb</code>. We need to have the correct "Back" url, as well as the breadcrumbs.</p>
<div><div id="highlighter_528488" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% title "Upload a file" %&gt; </code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;%= render :partial =&gt; "home/breadcrumbs" %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="html plain">&lt;%= render 'form' %&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html plain">&lt;% if @asset.folder %&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Back to '#{@asset.folder.name}' Folder", browse_path(@asset.folder) %&gt; </code></div><div class="line number9 index8 alt2"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Back", root_url %&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;% end %&gt; </code></div><div class="line number12 index11 alt1"><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This code should look quite similar to Folder's new page. We've added the breadcrumbs partial, and have personalized the <code>Back to</code> link to direct to the parent folder.</p>
<p>Then, in the <code>app/views/assets/_form.html.erb</code> file, add the hidden field, <code>folder_id</code>.</p>
<div><div id="highlighter_513869" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= form_for @asset, :html =&gt; {:multipart =&gt; true} do |f| %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;%= f.error_messages %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.label :uploaded_file, "File" %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.file_field :uploaded_file %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.hidden_field :folder_id %&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt;&lt;%= f.submit "Upload" %&gt;&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number10 index9 alt1"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Also, in the <code>Asset</code> controller, change the <code>create</code> action, like so:</p>
<div><div id="highlighter_950692" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">create </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.build(params[</code><code class="ruby color2">:asset</code><code class="ruby plain">]) </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@asset</code><code class="ruby plain">.save </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:notice</code><code class="ruby plain">] = </code><code class="ruby string">"Successfully uploaded the file."</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@asset</code><code class="ruby plain">.folder </code><code class="ruby comments">#checking if we have a parent folder for this file </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to browse_path(</code><code class="ruby variable bold">@asset</code><code class="ruby plain">.folder)&nbsp; </code><code class="ruby comments">#then we redirect to the parent folder </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">render </code><code class="ruby color2">:action</code> <code class="ruby plain">=&gt; </code><code class="ruby string">'new'</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number15 index14 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This code will ensure that the user is redirected back to correct folder, once the upload is complete.</p>
<p>You should now be able to upload files to specific folders. Give it a try to make sure things work, before moving forward.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_d019f4765eb2d854baa0af9755323344.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_file_upload.png"><br>
        </figure>
<hr>
<h2 class="nolinks"> <span>Step 11</span> Add Actions to Files and Folders</h2>
<p>Now that we have files and folders listed nicely, we need to be able to edit/delete/download/share them. Let's start by creating some links on the home page.</p>
<blockquote>
<p>
"We need to allow users to do three things to Folders: <code>Share</code>, <code>Rename</code> and <code>Delete</code>. However, for files, we'll only allow the user to perform two things: <code>Download</code> and <code>Delete</code>"</p>
</blockquote>
<p>Return to the home page, and edit the folder list, as follows:</p>
<div><div id="highlighter_966559" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html comments">&lt;!-- Listing Folders --&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;% @folders.each do |folder| %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_details folder"</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name"</code><code class="html plain">&gt;&lt;%= link_to folder.name, browse_path(folder) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size"</code><code class="html plain">&gt;-&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated"</code><code class="html plain">&gt;-&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"actions"</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"share"</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Share" %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"rename"</code><code class="html plain">&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Rename" %&gt; </code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number14 index13 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"delete"</code><code class="html plain">&gt; </code></div><div class="line number15 index14 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Delete" %&gt; </code></div><div class="line number16 index15 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number17 index16 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number18 index17 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number19 index18 alt2"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Let's also do the same for the file list:</p>
<div><div id="highlighter_207340" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html comments">&lt;!-- Listing Files --&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;% @assets.each do |asset| %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_details file"</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name"</code><code class="html plain">&gt;&lt;%= link_to asset.file_name, download_url(asset) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size"</code><code class="html plain">&gt;&lt;%= number_to_human_size(asset.file_size, :precision =&gt; 2) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated"</code><code class="html plain">&gt;&lt;%= asset.uploaded_file_updated_at %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"actions"</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"download"</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Download" %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"delete"</code><code class="html plain">&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Delete" %&gt; </code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number14 index13 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number15 index14 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number16 index15 alt1"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We've added a download and delete links, above. Why not add some CSS to make these links look a bit nicer? Add the following to <span class="skimlinks-unlinked">application.css</span></p>
<div><div id="highlighter_541684" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">.actions { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">right</code><code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">11px</code><code class="css plain">; </code></div><div class="line number4 index3 alt1"><code class="css plain">} </code></div><div class="line number5 index4 alt2"><code class="css plain">.share, .rename, .download, .delete{ </code></div><div class="line number6 index5 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">float</code><code class="css plain">:</code><code class="css value">left</code><code class="css plain">;&nbsp; </code></div><div class="line number7 index6 alt2"><code class="css plain">} </code></div><div class="line number8 index7 alt1"><code class="css plain">.asset_details .share a,.asset_details .rename a,.asset_details .download a,.asset_details .delete a{ </code></div><div class="line number9 index8 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">: </code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#CFE9FF</code><code class="css plain">; </code></div><div class="line number10 index9 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">: </code><code class="css value">11px</code><code class="css plain">; </code></div><div class="line number11 index10 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">margin-left</code><code class="css plain">: </code><code class="css value">5px</code><code class="css plain">; </code></div><div class="line number12 index11 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">: </code><code class="css value">0</code> <code class="css value">2px</code><code class="css plain">; </code></div><div class="line number13 index12 alt2"><code class="css plain">} </code></div><div class="line number14 index13 alt1"><code class="css plain">.asset_details .share a:hover,.asset_details .rename a:hover,.asset_details .download a:hover,.asset_details .delete a:hover{ </code></div><div class="line number15 index14 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#8FCDFF</code><code class="css plain">; </code></div><div class="line number16 index15 alt1"><code class="css plain">} </code></div><div class="line number17 index16 alt2"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number18 index17 alt1"><code class="css plain">.asset_details .delete a{ </code></div><div class="line number19 index18 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#BF0B12</code><code class="css plain">; </code></div><div class="line number20 index19 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#FFCFD1</code><code class="css plain">; </code></div><div class="line number21 index20 alt2"><code class="css plain">} </code></div><div class="line number22 index21 alt1"><code class="css spaces">&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="css plain">.asset_details .delete a:hover{ </code></div><div class="line number24 index23 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#BF0B12</code><code class="css plain">; </code></div><div class="line number25 index24 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">border</code><code class="css plain">:</code><code class="css value">1px</code> <code class="css value">solid</code> <code class="css value">#FF8F93</code><code class="css plain">; </code></div><div class="line number26 index25 alt1"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_2d68f1737f44b16b2d27d7e63ce54f88.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/new_action_links.png"><br>
        </figure>
<h3 class="nolinks">Delete Files</h3>
<p>Now, let's get those action links working. We'll begin with the Asset (File) delete links. Change the file <code>delete</code> link on the home page, like so:</p>
<div><div id="highlighter_398749" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= link_to "Delete", asset, :confirm =&gt; 'Are you sure?', :method =&gt; :delete %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This will pop up a confirmation message, once you click the link asking you if you are sure you want to delete it. Then it'll direct you to the destroy action of the Asset controller. So let's change that action to redirect:</p>
<div><div id="highlighter_479464" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">destroy </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code> <code class="ruby plain">= current_user.assets.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@parent_folder</code> <code class="ruby plain">= </code><code class="ruby variable bold">@asset</code><code class="ruby plain">.folder </code><code class="ruby comments">#grabbing the parent folder before deleting the record </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@asset</code><code class="ruby plain">.destroy </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:notice</code><code class="ruby plain">] = </code><code class="ruby string">"Successfully deleted the file."</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments">#redirect to a relevant path depending on the parent folder </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@parent_folder</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to browse_path(</code><code class="ruby variable bold">@parent_folder</code><code class="ruby plain">) </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number13 index12 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"Note that we need to get the <code>@parent_folder</code> of the file before it is deleted."</p>
</blockquote>
<h3 class="nolinks">Delete Folders</h3>
<p>Now it's time to change the folder delete link on the home page as follows:</p>
<div><div id="highlighter_803606" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= link_to "Delete", folder, :confirm =&gt; 'Are you sure to delete the folder and all of its contents?', :method =&gt; :delete %&gt;</code></div></div></td></tr></tbody></table></div></div>
<blockquote class="pullquote pqRight">
<p>
"Remember: whenever we delete a folder, we also need to delete the contents (files and folders) within it."</p>
</blockquote>
<p>And here's the Destroy action of the Folder Controller. So we'll edit the code there.</p>
<div><div id="highlighter_114296" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">destroy </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@parent_folder</code> <code class="ruby plain">= </code><code class="ruby variable bold">@folder</code><code class="ruby plain">.parent </code><code class="ruby comments">#grabbing the parent folder </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#this will destroy the folder along with all the contents inside </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#sub folders will also be deleted too as well as all files inside </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code><code class="ruby plain">.destroy </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:notice</code><code class="ruby plain">] = </code><code class="ruby string">"Successfully deleted the folder and all the contents inside."</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#redirect to a relevant path depending on the parent folder </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@parent_folder</code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to browse_path(</code><code class="ruby variable bold">@parent_folder</code><code class="ruby plain">) </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number16 index15 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This is the sam as we did in the Asset controller. Note that when you destroy a folder, all files and folders will be automatically be destroyed, because we have defined <code>:dependent =&gt; :destroy</code> in the Folder model for all files. Also, <code>acts_as_tree</code> will destroy all child folders, by default.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_c5164e222d66adc5b3ea603b05dc7a0f.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/delete_folder.png"><br>
        </figure>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_368cbdb390f90ece423048cf03186228.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/folder_deleted.png"><br>
        </figure>
<h3 class="nolinks">Download Files</h3>
<p>Creating the "Download File" link is an easy one. Change the <code>Download</code> link in the files list on the home page.</p>
<div><div id="highlighter_839688" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= link_to "Download", download_url(asset) %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>The <code>download_url(asset)</code> is already used on the file name link; so it shouldn't be a surprise for you.</p>
<h3 class="nolinks">Rename Folders</h3>
<p>To rename a folder is to edit it. So we need to redirect the link to direct to the Edit action of the Folder controller. Let's do that with a new route to handle nested folder ids too. We can create this new route within the <code>routes.rb</code> file.</p>
<div><div id="highlighter_387979" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#for renaming a folder </code></div><div class="line number2 index1 alt1"><code class="ruby plain">match </code><code class="ruby string">"browse/:folder_id/rename"</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"folders#edit"</code><code class="ruby plain">, </code><code class="ruby color2">:as</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"rename_folder"</code></div></div></td></tr></tbody></table></div></div>
<p>Next, change the Rename link in the Folder list on the home page.</p>
<div><div id="highlighter_329582" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= link_to "Rename", rename_folder_path(folder) %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>In the Folder Controller, change the Edit action, like so:</p>
<div><div id="highlighter_336514" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">edit </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">]) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">= </code><code class="ruby variable bold">@folder</code><code class="ruby plain">.parent&nbsp;&nbsp;&nbsp; </code><code class="ruby comments">#this is just for breadcrumbs </code></div><div class="line number4 index3 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"<code>@current_folder</code>, in the Edit action might not make sense at first, but we need the instance variable for displaying the breadcrumbs correctly."</p>
</blockquote>
<p>Next, update the <code>app/views/folders/edit.html.erb</code> page:</p>
<div><div id="highlighter_223098" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% title "Rename Folder" %&gt; </code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;%= render :partial =&gt; "home/breadcrumbs" %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="html plain">&lt;%= render 'form' %&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html plain">&lt;% if @folder.parent %&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Back to '#{@folder.parent.name}' Folder", browse_path(@folder.parent) %&gt; </code></div><div class="line number9 index8 alt2"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Back", root_url %&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;% end %&gt; </code></div><div class="line number12 index11 alt1"><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We've simply added the breadcrumbs, and have updated the title and the <code>Back to</code> link. </p>
<p>Now we only need to change the "Create Folder" button to "Rename Folder." So, change <code>app/views/folders/_form.html.erb</code> to:</p>
<div><div id="highlighter_288017" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= form_for @folder do |f| %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;%= f.error_messages %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.label :name %&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.text_field :name %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.hidden_field :parent_id %&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html plain">&lt;% if @folder.new_record? %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.submit "Create Folder" %&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= f.submit "Rename Folder" %&gt; </code></div><div class="line number13 index12 alt2"><code class="html plain">&lt;% end %&gt; </code></div><div class="line number14 index13 alt1"><code class="html plain">&lt;/</code><code class="html keyword">p</code><code class="html plain">&gt; </code></div><div class="line number15 index14 alt2"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>The page should now look like the following image, when you click to rename a folder.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_b5f8cf9ab2e0170e1b86c5d2b7196264.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/rename_folder.png"><br>
        </figure>
<hr>
<h2 class="nolinks"> <span>Step 12</span> Sharing Folders Across Users</h2>
<blockquote>
<p>
"In this ShareBox app, we need to make folders shareable. Any contents (Files and/or Folders) inside a shared folder will be accessible by each shared users."</p>
</blockquote>
<h3 class="nolinks">Creating a Structure</h3>
<p>We'll make the Sharing process easy with a few simple steps. The most likely scenario when a user shares a folder is:</p>
<ul>
<li>A user clicks on the <em>Share</em> link for a folder</li>
<li>A dialog box will pop up to let the user enter email addresses to share the folder with</li>
<li>The user may add an additional message to the invitation, if they wish</li>
<li>Once the user invites a person (an email address), we'll store this information in the DB to inform the system to let that email address holder have access to the Shared folder.</li>
<li>An email will be sent to the shared user to inform the invitation.</li>
<li>Then the shared user signs in (or signs up first and then signs in) and he/she will see the shared folder.</li>
<li>The shared user cannot perform any actions on the shared folders, other than downloading the file(s) inside them.</li>
</ul>
<p>We need a new model handle the Shared Folders. Let's call it, <code>SharedFolder</code>. Run the following model generation script in the Terminal.</p>
<div><div id="highlighter_875249" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g model SharedFolder user_id</code><code class="ruby color2">:integer</code> <code class="ruby plain">shared_email</code><code class="ruby color2">:string</code> <code class="ruby plain">shared_user_id</code><code class="ruby color2">:integer</code> <code class="ruby plain">folder_id</code><code class="ruby color2">:integer</code> <code class="ruby plain">message</code><code class="ruby color2">:string</code></div></div></td></tr></tbody></table></div></div>
<p>The <code>user_id</code> is for the owner of the shared folder. The <code>shared_user_id</code> is for the user to whom the owner has shared the folder to. The <code>shared_email</code> is for the email address of the shared_user. The <code>folder_id</code> is obviously the folder being shared. The <code>message</code> is for optional message to be sent in the invitation email.</p>
<p>In the newly created migration file (under <code>db/migrate</code> folder), add the following indexes: </p>
<div><div id="highlighter_731090" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">CreateSharedFolders &lt; ActiveRecord::Migration </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.up </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">create_table </code><code class="ruby color2">:shared_folders</code> <code class="ruby keyword">do</code> <code class="ruby plain">|t| </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.integer </code><code class="ruby color2">:user_id</code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.string </code><code class="ruby color2">:shared_email</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.integer </code><code class="ruby color2">:shared_user_id</code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.integer </code><code class="ruby color2">:folder_id</code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.string </code><code class="ruby color2">:message</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">t.timestamps </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:user_id</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:shared_user_id</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">add_index </code><code class="ruby color2">:shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:folder_id</code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby keyword">self</code><code class="ruby plain">.down </code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">drop_table </code><code class="ruby color2">:shared_folders</code></div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number21 index20 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Now, run <code>rake db:migrate</code>. It'll create the DB table for you.</p>
<p>In the SharedFolder model, located at <code>app/models/shared_folder.rb</code>, add the following:</p>
<div><div id="highlighter_596997" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">SharedFolder &lt; ActiveRecord::Base </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">attr_accessible </code><code class="ruby color2">:user_id</code><code class="ruby plain">, </code><code class="ruby color2">:shared_email</code><code class="ruby plain">, </code><code class="ruby color2">:shared_user_id</code><code class="ruby plain">,&nbsp; </code><code class="ruby color2">:message</code><code class="ruby plain">,&nbsp; </code><code class="ruby color2">:folder_id</code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments">#this is for the owner(creator) of the assets </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">belongs_to </code><code class="ruby color2">:user</code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments">#this is for the user to whom the owner has shared folders to </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">belongs_to </code><code class="ruby color2">:shared_user</code><code class="ruby plain">, </code><code class="ruby color2">:class_name</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"User"</code><code class="ruby plain">, </code><code class="ruby color2">:foreign_key</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"shared_user_id"</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments">#for the folder being shared </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">belongs_to </code><code class="ruby color2">:folder</code></div><div class="line number12 index11 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"We are linking to the <code>User</code> model twice from the <code>ShareFolder</code> model. For the <code>shared_user</code> connection, we need to specify which class and which foreign key is used, because it's not following the Rails default conventions to link to <code>User</code> model."</p>
</blockquote>
<p>Now in the <code>User</code> model, let's add those two relationships:</p>
<div><div id="highlighter_838213" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this is for folders which this user has shared </code></div><div class="line number2 index1 alt1"><code class="ruby plain">has_many </code><code class="ruby color2">:shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:dependent</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:destroy</code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby comments">#this is for folders which the user has been shared by other users </code></div><div class="line number5 index4 alt2"><code class="ruby plain">has_many </code><code class="ruby color2">:being_shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:class_name</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"SharedFolder"</code><code class="ruby plain">, </code><code class="ruby color2">:foreign_key</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"shared_user_id"</code><code class="ruby plain">, </code><code class="ruby color2">:dependent</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:destroy</code></div></div></td></tr></tbody></table></div></div>
<p>Then, in the Folder model, add this relationship.</p>
<div><div id="highlighter_109649" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">has_many </code><code class="ruby color2">:shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:dependent</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:destroy</code></div></div></td></tr></tbody></table></div></div>
<h3 class="nolinks">Creating View for Sharing</h3>
<blockquote>
<p>
"We are going to use jQuery and jQuery UI to create the invitation form for sharing the folders."</p>
</blockquote>
<p>First off, we use jQuery instead of Prototype to prevent the possibility of CSRF attacks. By default, Rails uses the Prototype JS library to help with that.</p>
<p>We need to first download the jQuery version of the sort from <a href="https://github.com/Rails/jquery-ujs">here</a>. You should download the zip file, extract it and copy the <code>jquery.Rails.js</code> file and paste it in our Rails app <code>public/javascripts</code> folder.</p>
<p>Then, we have to use that JS file instead of the default one. Open the <code>app/views/layout/application.html.erb</code> file, and change the following in the "head" section.</p>
<div><div id="highlighter_938829" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">head</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">title</code><code class="html plain">&gt;ShareBox |&lt;%= content_for?(:title) ? yield(:title) : "Untitled" %&gt;&lt;/</code><code class="html keyword">title</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= stylesheet_link_tag "application" %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="html comments">&lt;!-- This is for preventing CSRF attacks. --&gt;</code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= javascript_include_tag "jquery.Rails" %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= csrf_meta_tag %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= yield(:head) %&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;/</code><code class="html keyword">head</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We need to download jQuery UI from <a href="http://jqueryui.com/download">here</a>. Make sure that you choose the <code>Redmond</code> theme to match our colors. </p>
<p>Once you've downloaded it, copy the <em>jquery-1.4.4.<span class="skimlinks-unlinked">min.js</span></em> and <em>jquery-ui-1.8.9.<span class="skimlinks-unlinked">custom.min.js</span></em> files and paste them into the <code>public/javascripts</code> folder.</p>
<p>Also copy the entire <em>redmond</em> folder from the CSS folder into <code>public/stylesheets</code> </p>
<p>Next, we need to load the files in our layout application file (<code>app/views/layouts/application.html.erb</code>) in the "head" section.</p>
<div><div id="highlighter_90245" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">head</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">title</code><code class="html plain">&gt;ShareBox |&lt;%= content_for?(:title) ? yield(:title) : "Untitled" %&gt;&lt;/</code><code class="html keyword">title</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= stylesheet_link_tag "application", "redmond/jquery-ui-1.8.9.custom" %&gt; </code></div><div class="line number4 index3 alt1"><code class="html plain">&lt;%= javascript_include_tag "jquery-1.4.4.min", "jquery-ui-1.8.9.custom.min" %&gt; </code></div><div class="line number5 index4 alt2"><code class="html plain">&lt;%= javascript_include_tag "application" %&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="html comments">&lt;!-- This is for preventing CSRF attacks. --&gt;</code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= javascript_include_tag "jquery.Rails" %&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= csrf_meta_tag %&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;</code><code class="html plain">&lt;%= yield(:head) %&gt; </code></div><div class="line number13 index12 alt2"><code class="html plain">&lt;/</code><code class="html keyword">head</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>The <code>application.js</code> file is also being loaded here. We'll put our own JavaScript code in that file shortly.</p>
<p>We'll now create a jQuery UI dialog box to help with the invitation form. We'll make it load when the Share button is clicked.</p>
<p>First, open the <code>app/views/home/index.html.erb</code> page, and append the following near the bottom of the page, just before the last <code></code>.</p>
<div><div id="highlighter_294124" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">id</code><code class="html plain">=</code><code class="html string">"invitation_form"</code> <code class="html color1">title</code><code class="html plain">=</code><code class="html string">"Invite others to share"</code> <code class="html color1">style</code><code class="html plain">=</code><code class="html string">"display:none"</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% form_tag '/home/share' do -%&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">label</code> <code class="html color1">for</code><code class="html plain">=</code><code class="html string">"email_addresses"</code><code class="html plain">&gt;Enter recipient email addresses here&lt;/</code><code class="html keyword">label</code><code class="html plain">&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= text_field_tag 'email_addresses', "", :class =&gt; 'text ui-widget-content ui-corner-all'%&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">label</code> <code class="html color1">for</code><code class="html plain">=</code><code class="html string">"message"</code><code class="html plain">&gt;Optional message&lt;/</code><code class="html keyword">label</code><code class="html plain">&gt;&lt;</code><code class="html keyword">br</code> <code class="html plain">/&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= text_area_tag 'message',"",&nbsp; :class =&gt; 'text ui-widget-content ui-corner-all'%&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= hidden_field_tag "folder_id" %&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end -%&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number10 index9 alt1"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Above, we've created an HTML form with one text field for an email address, and a textarea for the optional message. Also note that we have added a hidden field, called "folder_id," which we'll make use of to post the form later.</p>
<p>The <em>div</em> is hidden by default, and will be revealed in a dialog box when the Share button is clicked.</p>
<p>We are going to place the trigger in our JavaScript code. Before we do that, though, we need to have the specific <em>folder id</em> and <em>folder name</em> for the one that the user wants to share. To retrieve that, we need to change the Share folder link in the list of the Folder actions. On the home page in the folder list, revise the Share link, like this:</p>
<div><div id="highlighter_885100" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;%= link_to "Share", "#", :folder_id =&gt; folder.id, :folder_name =&gt; folder.name %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Now, the link will be generated:</p>
<div><div id="highlighter_182559" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">a</code> <code class="html color1">folder_name</code><code class="html plain">=</code><code class="html string">"Documents"</code> <code class="html color1">folder_id</code><code class="html plain">=</code><code class="html string">"1"</code> <code class="html color1">href</code><code class="html plain">=</code><code class="html string">"#"</code><code class="html plain">&gt;Share&lt;/</code><code class="html keyword">a</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>Every Share link for each folder will now have a unique folder_name and folder_id attribute.</p>
<p>We'll next create the trigger event in the <code>public/javascripts/application.js</code> file:</p>
<div><div id="highlighter_730933" class="syntaxhighlighter noskimlinks noskimwords js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js plain">$(</code><code class="js keyword">function</code> <code class="js plain">() {&nbsp; </code></div><div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//open the invitation form when a share button is clicked </code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$( </code><code class="js string">".share a"</code> <code class="js plain">) </code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">.button() </code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">.click(</code><code class="js keyword">function</code><code class="js plain">() { </code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//assign this specific Share link element into a variable called "a" </code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code> <code class="js plain">a = </code><code class="js keyword">this</code><code class="js plain">; </code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//First, set the title of the Dialog box to display the folder name </code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$(</code><code class="js string">"#invitation_form"</code><code class="js plain">).attr(</code><code class="js string">"title"</code><code class="js plain">, </code><code class="js string">"Share '"</code> <code class="js plain">+ $(a).attr(</code><code class="js string">"folder_name"</code><code class="js plain">) + </code><code class="js string">"' with others"</code> <code class="js plain">); </code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//a hack to display the different folder names correctly </code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$(</code><code class="js string">"#ui-dialog-title-invitation_form"</code><code class="js plain">).text(</code><code class="js string">"Share '"</code> <code class="js plain">+ $(a).attr(</code><code class="js string">"folder_name"</code><code class="js plain">) + </code><code class="js string">"' with others"</code><code class="js plain">);&nbsp; </code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//then put the folder_id of the Share link into the hidden field "folder_id" of the invite form </code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$(</code><code class="js string">"#folder_id"</code><code class="js plain">).val($(a).attr(</code><code class="js string">"folder_id"</code><code class="js plain">)); </code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//Add the dialog box loading here </code></div><div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js keyword">false</code><code class="js plain">; </code></div><div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}); </code></div><div class="line number22 index21 alt1"><code class="js plain">});</code></div></div></td></tr></tbody></table></div></div>
<p>This code specifies that, whenever each link with a CSS class of "share" is clicked, we'll trigger an anonymous function. Refer to the comments above for additional details.</p>
<p>Now, we need to add the following code in the place of <code>//Add the dialog box loading here</code> to actually load the dialog box.</p>
<div><div id="highlighter_655260" class="syntaxhighlighter noskimlinks noskimwords js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js comments">//the dialog box customization </code></div><div class="line number2 index1 alt1"><code class="js plain">$( </code><code class="js string">"#invitation_form"</code> <code class="js plain">).dialog({ </code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">height: 300, </code></div><div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">width: 600, </code></div><div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">modal: </code><code class="js keyword">true</code><code class="js plain">, </code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">buttons: { </code></div><div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//First button </code></div><div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js string">"Share"</code><code class="js plain">: </code><code class="js keyword">function</code><code class="js plain">() { </code></div><div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//get the url to post the form data to </code></div><div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code> <code class="js plain">post_url = $(</code><code class="js string">"#invitation_form form"</code><code class="js plain">).attr(</code><code class="js string">"action"</code><code class="js plain">); </code></div><div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//serialize the form data and post it the url with ajax </code></div><div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$.post(post_url,$(</code><code class="js string">"#invitation_form form"</code><code class="js plain">).serialize(), </code><code class="js keyword">null</code><code class="js plain">, </code><code class="js string">"script"</code><code class="js plain">); </code></div><div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code> <code class="js keyword">false</code><code class="js plain">; </code></div><div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}, </code></div><div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">//Second button </code></div><div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">Cancel: </code><code class="js keyword">function</code><code class="js plain">() { </code></div><div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">$( </code><code class="js keyword">this</code> <code class="js plain">).dialog( </code><code class="js string">"close"</code> <code class="js plain">); </code></div><div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">} </code></div><div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">}, </code></div><div class="line number22 index21 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">close: </code><code class="js keyword">function</code><code class="js plain">() { </code></div><div class="line number23 index22 alt2"><code class="js spaces">&nbsp;</code>&nbsp;</div><div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js plain">} </code></div><div class="line number25 index24 alt2"><code class="js plain">});</code></div></div></td></tr></tbody></table></div></div>
<p>The dialog box should be loaded with the specified width and height, and it also has two buttons: Share and Cancel. When the Share button is clicked, we'll perform two actions. First, we store the Form's action (which is "home/share") into a variable, called <code>post_url</code>. Secondly, we post the form, using AJAX, to the <code>post_url</code> after serializing the form data.</p>
<blockquote>
<p>
"The last parameter value <em>script</em> of AJAX method, <em>$.post()</em>, instructs Rails to respond when the AJAX request has completed."</p>
</blockquote>
<p>Before we test this out in our browser, let's add a bit of styling in the <span class="skimlinks-unlinked">application.css</span> file.</p>
<div><div id="highlighter_506051" class="syntaxhighlighter noskimlinks noskimwords css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css plain">.ui-button-text-only .ui-button-text { </code></div><div class="line number2 index1 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">: </code><code class="css value">14px</code> <code class="css plain">; </code></div><div class="line number3 index2 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">: </code><code class="css value">3px</code> <code class="css value">10px</code> <code class="css color3">!important</code><code class="css plain">; </code></div><div class="line number4 index3 alt1"><code class="css plain">} </code></div><div class="line number5 index4 alt2"><code class="css plain">.share .ui-button-text-only .ui-button-text { </code></div><div class="line number6 index5 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">padding</code><code class="css plain">: </code><code class="css value">0</code> <code class="css value">2px</code> <code class="css color3">!important</code><code class="css plain">; </code></div><div class="line number7 index6 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">11px</code><code class="css plain">; </code></div><div class="line number8 index7 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-weight</code><code class="css plain">:</code><code class="css value">normal</code><code class="css plain">; </code></div><div class="line number9 index8 alt2"><code class="css plain">} </code></div><div class="line number10 index9 alt1"><code class="css plain">#invitation_form{ </code></div><div class="line number11 index10 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">14px</code><code class="css plain">; </code></div><div class="line number12 index11 alt1"><code class="css plain">} </code></div><div class="line number13 index12 alt2"><code class="css plain">#invitation_form label{ </code></div><div class="line number14 index13 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-weight</code><code class="css plain">:</code><code class="css value">bold</code><code class="css plain">; </code></div><div class="line number15 index14 alt2"><code class="css plain">} </code></div><div class="line number16 index15 alt1"><code class="css plain">#invitation_form input.text { </code></div><div class="line number17 index16 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">480px</code><code class="css plain">; </code></div><div class="line number18 index17 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">height</code><code class="css plain">:</code><code class="css value">20px</code><code class="css plain">; </code></div><div class="line number19 index18 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">12px</code><code class="css plain">; </code></div><div class="line number20 index19 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#7F7F7F</code><code class="css plain">;&nbsp;&nbsp; </code></div><div class="line number21 index20 alt2"><code class="css plain">} </code></div><div class="line number22 index21 alt1"><code class="css plain">#invitation_form textarea { </code></div><div class="line number23 index22 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">width</code><code class="css plain">:</code><code class="css value">480px</code><code class="css plain">; </code></div><div class="line number24 index23 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">height</code><code class="css plain">:</code><code class="css value">100px</code><code class="css plain">; </code></div><div class="line number25 index24 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">font-size</code><code class="css plain">:</code><code class="css value">12px</code><code class="css plain">; </code></div><div class="line number26 index25 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css keyword">color</code><code class="css plain">:</code><code class="css value">#7F7F7F</code><code class="css plain">; </code></div><div class="line number27 index26 alt2"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_ef59babc87dd462ddee91334b17478c2.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/invite_form.png"><br>
        </figure>
<p>Since we don't currently have any route matched for <em>home/share</em>, submitting the form will silently fail in the background, as it's an AJAX request.</p>
<p>We'll create a new route in the <code>routes.rb</code> file.</p>
<div><div id="highlighter_126193" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">#for sharing the folder </code></div><div class="line number2 index1 alt1"><code class="html plain">match "home/share" =&gt; "home#share"</code></div></div></td></tr></tbody></table></div></div>
<p>This route will direct to the Share action of the Home controller. So let's create that action now.</p>
<div><div id="highlighter_348270" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this handles ajax request for inviting others to share folders </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">share&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#first, we need to separate the emails with the comma </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">email_addresses = params[</code><code class="ruby color2">:email_addresses</code><code class="ruby plain">].split(</code><code class="ruby string">","</code><code class="ruby plain">) </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">email_addresses.</code><code class="ruby keyword">each</code> <code class="ruby keyword">do</code> <code class="ruby plain">|email_address| </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#save the details in the ShareFolder table </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code> <code class="ruby plain">= current_user.shared_folders.</code><code class="ruby keyword">new</code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">.folder_id = params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">] </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">.shared_email = email_address </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#getting the shared user id right the owner the email has already signed up with ShareBox </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#if not, the field "shared_user_id" will be left nil for now. </code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">shared_user = User.find_by_email(email_address) </code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">.shared_user_id = shared_user.id </code><code class="ruby keyword">if</code> <code class="ruby plain">shared_user </code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">.message = params[</code><code class="ruby color2">:message</code><code class="ruby plain">] </code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">.save </code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#now we need to send email to the Shared User </code></div><div class="line number21 index20 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number22 index21 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#since this action is mainly for ajax (javascript request), we'll respond with js file back (refer to share.js.erb) </code></div><div class="line number24 index23 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">respond_to </code><code class="ruby keyword">do</code> <code class="ruby plain">|format| </code></div><div class="line number25 index24 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">format.js { </code></div><div class="line number26 index25 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">} </code></div><div class="line number27 index26 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number28 index27 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Here, we are splitting the email addresses with a comma, since we can share one folder with multiple email addresses. Then, we loop through each email address to create a <em>SharedFolder</em> record. We make sure we have the correct user id (owner) and folder id.</p>
<blockquote>
<p>
"Getting a shared user is a bit tricky. The email address holder may or may not be an account holder of this ShareBox app."</p>
</blockquote>
<p>To compensate, we'll grab the <code>shared_user</code> only when we can find the email address holder. If we can't find it, we'll leave it as null in the <code>shared_user_id</code> for now. We'll take care of that in a bit. We'll also save the optional message.</p>
<p>Let's now create the "<span class="skimlinks-unlinked">share.js.erb</span>" file in the <code>app/views/home</code> folder, as the AJAX request will be expecting a JavaScript response. </p>
<div><div id="highlighter_281550" class="syntaxhighlighter noskimlinks noskimwords js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js comments">//closing the dialog box </code></div><div class="line number2 index1 alt1"><code class="js plain">$(</code><code class="js string">"#invitation_form"</code><code class="js plain">).dialog(</code><code class="js string">"close"</code><code class="js plain">); </code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="js comments">//making sure we don't display the flash notice more than once </code></div><div class="line number5 index4 alt2"><code class="js plain">$(</code><code class="js string">"#flash_notice"</code><code class="js plain">).remove(); </code></div><div class="line number6 index5 alt1"><code class="js spaces">&nbsp;</code>&nbsp;</div><div class="line number7 index6 alt2"><code class="js comments">//showing a flash message </code></div><div class="line number8 index7 alt1"><code class="js plain">$(</code><code class="js string">"#container"</code><code class="js plain">).prepend(</code><code class="js string">"&lt;div id='flash_notice'&gt;Successfully shared the folder&lt;/div&gt;"</code><code class="js plain">);</code></div></div></td></tr></tbody></table></div></div>
<p>We close the dialog box first. Then, we remove any existing Flash messages, and, finally, we display a new Flash message to inform the user that the folder has been shared.</p>
<p>But I want the <em>shared</em> folder icons to be different from the normal folder icon. First, I need to know if a folder is shared or not. We can add a quick method to the Folder model to help with this task.</p>
<div><div id="highlighter_260516" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#a method to check if a folder has been shared or not </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">shared? </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">!</code><code class="ruby keyword">self</code><code class="ruby plain">.shared_assets.empty? </code></div><div class="line number4 index3 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
We can determine if <code>a_folder</code> is shared or not by calling <code>a_folder.shared?</code>, which returns a boolean.</p>
</blockquote>
<p>Next, we need to know which folder element to change in our jQuery. So we can add a <code>folder_id</code> to every folder line. Within home/index page, update the following line:</p>
<div><div id="highlighter_132363" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"asset_details folder"</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>...and replace it with:</p>
<div><div id="highlighter_427575" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html plain">class="asset_details &lt;%= folder.shared? ? 'shared_folder' : 'folder' %&gt;" id="folder_&lt;%= folder.id %&gt;"&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This assigns a new CSS class, called "shared_folder," to the <code>div</code> if the folder is shared. Also we add a folder_id to let jQuery dynamically change the icons by switching the CSS class.</p>
<p>In fact, we already added the CSS class, "shared_folder" earlier. So it should look something like this once you share a folder.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_11dfd5920f394c4c25be1bd5a82ee287.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/shared_folders.png"><br>
        </figure>
<p>Add the following two lines in the <code>share.js.erb</code> to change the folder icons dynamically after the Ajax request.</p>
<div><div id="highlighter_60915" class="syntaxhighlighter noskimlinks noskimwords js"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="js comments">//Removing the css class 'folder' </code></div><div class="line number2 index1 alt1"><code class="js plain">$(</code><code class="js string">"#folder_&lt;%= params[:folder_id] %&gt;"</code><code class="js plain">).removeClass(</code><code class="js string">"folder"</code><code class="js plain">); </code></div><div class="line number3 index2 alt2"><code class="js spaces">&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="js comments">//Adding the css class 'shared_folder' </code></div><div class="line number5 index4 alt2"><code class="js plain">$(</code><code class="js string">"#folder_&lt;%= params[:folder_id] %&gt;"</code><code class="js plain">).addClass(</code><code class="js string">"shared_folder"</code><code class="js plain">);</code></div></div></td></tr></tbody></table></div></div>
<p>Before we go back and work on the email section, we need to place an "after_create" method in the User model to be executed every time a new user is added. This will be to sync the new user id with the SharedFolder's <code>shared_user_id</code> if the email address is matched. We add this in the User model.</p>
<div><div id="highlighter_380580" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">after_create </code><code class="ruby color2">:check_and_assign_shared_ids_to_shared_folders</code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="ruby comments">#this is to make sure the new user ,of which the email addresses already used to share folders by others, to have access to those folders </code></div><div class="line number4 index3 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">check_and_assign_shared_ids_to_shared_folders&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#First checking if the new user's email exists in any of ShareFolder records </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">shared_folders_with_same_email = SharedFolder.find_all_by_shared_email(</code><code class="ruby keyword">self</code><code class="ruby plain">.email) </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">shared_folders_with_same_email&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#loop and update the shared user id with this new user id&nbsp; </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">shared_folders_with_same_email.</code><code class="ruby keyword">each</code> <code class="ruby keyword">do</code> <code class="ruby plain">|shared_folder| </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">shared_folder.shared_user_id = </code><code class="ruby keyword">self</code><code class="ruby plain">.id </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">shared_folder.save </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number15 index14 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Here, we get the new user id for the purpose of putting it in the <code>shared_user_id</code> of the SharedFolder object if any of the records have the same email address as the new user's. That should keep it synced with the non-users who you are trying to share your folder with, on ShareBox.</p>
<hr>
<h2 class="nolinks"> <span>Step 13</span> Sending Emails to Shared Users</h2>
<p>Now, we'll review how to send emails when a user shares a folder with others.</p>
<blockquote>
<p>
"Sending emails in Rails 3 is quite easy. We'll use Gmail, since you can easily and quickly create Gmail accounts to test this bit of the tutorial."</p>
</blockquote>
<p>First, we need to add the SMTP settings to the system. So, create a file named "<span class="skimlinks-unlinked">setup_mail.rb</span>" within the <code>config/initializers</code> folder. Append the following settings to the file:</p>
<div><div id="highlighter_684087" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">ActionMailer::Base.smtp_settings = { </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:address</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="ruby plain">=&gt; </code><code class="ruby string">"smtp.gmail.com"</code><code class="ruby plain">, </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:port</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="ruby plain">=&gt; </code><code class="ruby constants">587</code><code class="ruby plain">, </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:domain</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="ruby plain">=&gt; </code><code class="ruby string">"gmail.com"</code><code class="ruby plain">, </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:user_name</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="ruby plain">=&gt; </code><code class="ruby string">"shareboxapp"</code><code class="ruby plain">, </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:password</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="ruby plain">=&gt; </code><code class="ruby string">"secret"</code><code class="ruby plain">, </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:authentication</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="ruby plain">=&gt; </code><code class="ruby string">"plain"</code><code class="ruby plain">, </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby color2">:enable_starttls_auto</code> <code class="ruby plain">=&gt; </code><code class="ruby keyword">true</code></div><div class="line number9 index8 alt2"><code class="ruby plain">}</code></div></div></td></tr></tbody></table></div></div>
<blockquote>
<p>
"Don't forget to restart the Rails server to reload these settings."</p>
</blockquote>
<p>We next need to create mailer objects and views. Let's call it, "UserMailer". Run the following generator:</p>
<div><div id="highlighter_103723" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby plain">Rails g mailer user_mailer</code></div></div></td></tr></tbody></table></div></div>
<p>This command will create the <code>app/mailers/user_mailer.rb</code> file among others. Let's edit the file to create a new email template.</p>
<div><div id="highlighter_151439" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">class</code> <code class="ruby plain">UserMailer &lt; ActionMailer::Base </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby plain">default </code><code class="ruby color2">:from</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"shareboxapp@gmail.com"</code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">def</code> <code class="ruby plain">invitation_to_share(shared_folder) </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@shared_folder</code> <code class="ruby plain">= shared_folder </code><code class="ruby comments">#setting up an instance variable to be used in the email template </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">mail( </code><code class="ruby color2">:to</code> <code class="ruby plain">=&gt; </code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">.shared_email,&nbsp; </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby color2">:subject</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"#{@shared_folder.user.name} wants to share '#{@shared_folder.folder.name}' folder with you"</code> <code class="ruby plain">) </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number9 index8 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>You can set the default values with the <code>default</code> method there. We'll basically create a method, which accepts the <code>shared_folder</code> object and pass it on to the email template, which we'll create next.</p>
<p>Now, we have to create the email template. The file name should be the same as the method's name you have in the UserMailer. So let's create the <code>invitation_to_share.text.erb</code> file under <code>app/views/user_mailer</code> folder.</p>
<p>
We name it as <code>invitation_to_share.text.erb</code> to use Text-based emails. If you'd like to use HTML-based emails, name it, <code>invitation_to_share.html.erb</code></p>
<p>Insert the following wording.</p>
<div><div id="highlighter_279400" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">Hey, </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="html plain">&lt;%= @shared_folder.user.name %&gt; has shared the "&lt;%= @shared_folder.folder.name %&gt;" folder on Sharebox.&nbsp; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="html plain">Message from &lt;%= @shared_folder.user.name %&gt;: </code></div><div class="line number6 index5 alt1"><code class="html plain">"&lt;%= @shared_folder.message %&gt;" </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="html plain">You can now login at &lt;%= new_user_session_url %&gt; and view the folder if you have an account already. If you don't have one,&nbsp; you can sign up here at &lt;%= new_user_registration_url %&gt;&nbsp; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="html plain">Have fun, </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="html plain">Sharebox</code></div></div></td></tr></tbody></table></div></div>
<p>To make this work, we add the following code to the <code>share</code> action of the Home controller where we left space to send emails.</p>
<div><div id="highlighter_415013" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#now send email to the recipients </code></div><div class="line number2 index1 alt1"><code class="ruby plain">UserMailer.invitation_to_share(</code><code class="ruby variable bold">@shared_folder</code><code class="ruby plain">).deliver</code></div></div></td></tr></tbody></table></div></div>
<p>Now, if you share a folder, it'll send an email to the shared user. Once you click the "Share" button within the dialog box, you might have to wait a few seconds or so to let the system send an email to the user before you see the flash message. </p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_4c279ce165f72408d441fe04c905fb86.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/email_template.png"><br>
        </figure>
<hr>
<h2 class="nolinks"> <span>Step 14</span> Giving Shared Folder Access to Other Users</h2>
<blockquote>
<p>
Thus far, even though a user can share his folder with others, they will not see his folder yet on their ShareBox pages."</p>
</blockquote>
<p>To fix this, we need to display the shared folders to the shared users on the home page. We definitely have to pass a new instance variable loaded with these shared folders to the Index page.</p>
<p>Update your index action in the Home controller, like so:</p>
<div><div id="highlighter_680931" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">index </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">user_signed_in? </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show folders shared by others </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@being_shared_folders</code> <code class="ruby plain">= current_user.shared_folders_by_others </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show only root folders </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folders</code> <code class="ruby plain">= current_user.folders.roots </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show only root files </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= current_user.assets.where(</code><code class="ruby string">"folder_id is NULL"</code><code class="ruby plain">).order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number11 index10 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>In this code, we've added the <code>@being_shared_folders</code> instance variables. Note that we don't currently have the relationship, called <code>shared_folders_by_others</code>, in the <code>User</code> model; so, let's add that now.</p>
<div><div id="highlighter_164191" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this is for getting Folders objects which the user has been shared by other users </code></div><div class="line number2 index1 alt1"><code class="ruby plain">has_many </code><code class="ruby color2">:shared_folders_by_others</code><code class="ruby plain">, </code><code class="ruby color2">:through</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:being_shared_folders</code><code class="ruby plain">, </code><code class="ruby color2">:source</code> <code class="ruby plain">=&gt; </code><code class="ruby color2">:folder</code></div></div></td></tr></tbody></table></div></div>
<p>Now let's show that shared folders list on the home/index page. Insert the following code, just before the normal Folder listing:</p>
<div><div id="highlighter_435142" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html comments">&lt;!-- Listing Shared Folders (the folders shared by others) --&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;% @being_shared_folders.each do |folder| %&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html plain">class="asset_details &lt;%= folder.shared? ? 'shared_folder' : 'folder' %&gt;" id="folder_&lt;%= folder.id %&gt;"&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_name"</code><code class="html plain">&gt;&lt;%= link_to folder.name, browse_path(folder) %&gt;&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_size"</code><code class="html plain">&gt;-&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"file_last_updated"</code><code class="html plain">&gt;-&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"actions"</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number10 index9 alt1"><code class="html plain">&lt;% end %&gt; </code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="html comments">&lt;!-- Listing Folders --&gt;</code></div><div class="line number13 index12 alt2"><code class="html plain">...</code></div></div></td></tr></tbody></table></div></div>
<blockquote><p>
"Note that we won't provide any action links for Shared Folders, since they don't belong to the shared user."
</p></blockquote>
<p>This should work fine on the home page. You should now be able to see others' shared folders at the top of the pages.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_223566f3ad2b307a58a81e8a3f965e8a.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/movies_shared.png"><br>
        </figure>
<p> But if you're in a subfolder (of your own), you will receive a <code>nil object</code> error for <code>@being_shared_folders</code>. We need to fix that, and can do so in the <code>browse</code> action of the <code>Home</code> controller. Visit that page, and add:</p>
<div><div id="highlighter_527204" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#this action is for viewing folders </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">browse </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#making sure that this folder is owned/created by the current_user </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">= current_user.folders.find(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">])&nbsp;&nbsp; </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#if under a sub folder, we shouldn't see shared folders </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@being_shared_folders</code> <code class="ruby plain">= [] </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">... </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number14 index13 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This code ensures that we don't wish to see folders shared by others. Those folders should only exist at the Root level. The above should fixes this issue.</p>
<h3 class="nolinks">Viewing a Folder Shared by Others</h3>
<p>Now if you try to browse into a folder shared by others, you'll get this error:</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_84b007e67dff70f34ba9d3590db8465d.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/error.png"><br>
        </figure>
<p>This is due to the fact that the system thinks you are trying to gain access to a folder, for which you don't have the proper privileges. The reason we are seeing this error, instead of the "<em>Don't be cheeky!</em>" message, is because we have used the <code>find()</code> method instead of <code>find_by_id()</code>, while getting the <code>@current_folder</code> in the <code>browse</code> action of <code>Home</code> controller.</p>
<p>Now once again, we have to rethink the logic. We need to set the <code>@current_folder</code> for folders shared by others, but we also must pass some sort of flag to the views, which specifies that this folder is shared by others. That way, the views can restrict the access privileges -- such as deleting folders, etc.</p>
<p>To handle this, wee need a method for the <code>User</code> model, which determines if the user has "Share" access to the folder specified. So let's add this first before we change it in the <code>Browse</code> action.</p>
<div><div id="highlighter_376360" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby comments">#to check if a user has acess to this specific folder </code></div><div class="line number2 index1 alt1"><code class="ruby keyword">def</code> <code class="ruby plain">has_share_access?(folder) </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#has share access if the folder is one of one of his own </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">return</code> <code class="ruby keyword">true</code> <code class="ruby keyword">if</code> <code class="ruby keyword">self</code><code class="ruby plain">.folders.include?(folder) </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#has share access if the folder is one of the shared_folders_by_others </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">return</code> <code class="ruby keyword">true</code> <code class="ruby keyword">if</code> <code class="ruby keyword">self</code><code class="ruby plain">.shared_folders_by_others.include?(folder) </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#for checking sub folders under one of the being_shared_folders </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">return_value = </code><code class="ruby keyword">false</code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">folder.ancestors.</code><code class="ruby keyword">each</code> <code class="ruby keyword">do</code> <code class="ruby plain">|ancestor_folder| </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">return_value = </code><code class="ruby keyword">self</code><code class="ruby plain">.being_shared_folders.include?(ancestor_folder) </code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">return_value </code><code class="ruby comments">#if it's true </code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">return</code> <code class="ruby keyword">true</code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby keyword">return</code> <code class="ruby keyword">false</code></div><div class="line number21 index20 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Again, this method determines if the user has share access to the folder. The user has share access if he/she owns it. Alternatively, the user has share access if the folder is one of the user's Folders shared By others. </p>
<p>If none of the above return <code>true</code>, we still need to check one last thing. Although the folder you are viewing might not exactly be the folder shared by others, it could still be a subfolder of one of the folders shared by others, in which case, the user does, indeed, have share access.  </p>
<p>So the code above checks the folder's ancestors to validate this.</p>
<p>Back to the browse action of the <code>Home</code> controller; insert the following code there:</p>
<div><div id="highlighter_880356" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">browse </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments">#first find the current folder within own folders </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">= current_user.folders.find_by_id(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">])&nbsp;&nbsp; </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby variable bold">@is_this_folder_being_shared</code> <code class="ruby plain">= </code><code class="ruby keyword">false</code> <code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code> <code class="ruby comments">#just an instance variable to help hiding buttons on View </code></div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby comments">#if not found in own folders, find it in being_shared_folders </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code><code class="ruby plain">.</code><code class="ruby keyword">nil</code><code class="ruby plain">? </code></div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">folder = Folder.find_by_id(params[</code><code class="ruby color2">:folder_id</code><code class="ruby plain">]) </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@current_folder</code> <code class="ruby plain">||= folder </code><code class="ruby keyword">if</code> <code class="ruby plain">current_user.has_share_access?(folder) </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@is_this_folder_being_shared</code> <code class="ruby plain">= </code><code class="ruby keyword">true</code> <code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code> <code class="ruby comments">#just an instance variable to help hiding buttons on View </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby variable bold">@current_folder</code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#if under a sub folder, we shouldn't see shared folders </code></div><div class="line number17 index16 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@being_shared_folders</code> <code class="ruby plain">= [] </code></div><div class="line number18 index17 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number19 index18 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show folders under this current folder </code></div><div class="line number20 index19 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@folders</code> <code class="ruby plain">= </code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">.children </code></div><div class="line number21 index20 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number22 index21 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#show only files under this current folder </code></div><div class="line number23 index22 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby variable bold">@assets</code> <code class="ruby plain">= </code><code class="ruby variable bold">@current_folder</code><code class="ruby plain">.assets.order(</code><code class="ruby string">"uploaded_file_file_name desc"</code><code class="ruby plain">) </code></div><div class="line number24 index23 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number25 index24 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">render </code><code class="ruby color2">:action</code> <code class="ruby plain">=&gt; </code><code class="ruby string">"index"</code></div><div class="line number26 index25 alt1"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number27 index26 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:error</code><code class="ruby plain">] = </code><code class="ruby string">"Don't be cheeky! Mind your own assets!"</code></div><div class="line number28 index27 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code></div><div class="line number29 index28 alt2"><code class="ruby spaces">&nbsp;&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number30 index29 alt1"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>This code accomplishes two main things: </p>
<ul>
<li>Assigns the <code>@current_folder</code>, even if you are under a subfolder of a folder shared by others </li>
<li>Assigns the flag, <code>@is_this_folder_being_shared</code>, to pass it to the views. This will inform us as to whether the <code>@current_folder</code> is a folder shared by others or not.</li>
</ul>
<h3 class="nolinks">Downloading the Files from Folders Shared By Others</h3>
<p>If you attempt to download a file from a folder shared by others, you'll be met with the "<em>Don't be cheeky!</em>" message. So, let's adjust the <code>get</code> action of the <code>Asset</code> controller now.</p>
<div><div id="highlighter_919241" class="syntaxhighlighter noskimlinks noskimwords ruby"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="ruby keyword">def</code> <code class="ruby plain">get </code></div><div class="line number2 index1 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby comments">#first find the asset within own assets </code></div><div class="line number3 index2 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby plain">asset = current_user.assets.find_by_id(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code></div><div class="line number4 index3 alt1"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby comments">#if not found in own assets, check if the current_user has share access to the parent folder of the File </code></div><div class="line number6 index5 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby plain">asset ||= Asset.find(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]) </code><code class="ruby keyword">if</code> <code class="ruby plain">current_user.has_share_access?(Asset.find_by_id(params[</code><code class="ruby color2">:id</code><code class="ruby plain">]).folder) </code></div><div class="line number7 index6 alt2"><code class="ruby spaces">&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">if</code> <code class="ruby plain">asset </code></div><div class="line number9 index8 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#Parse the URL for special characters first before downloading </code></div><div class="line number10 index9 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">data = open(</code><code class="ruby constants">URI</code><code class="ruby plain">.parse(</code><code class="ruby constants">URI</code><code class="ruby plain">.encode(asset.uploaded_file.url))) </code></div><div class="line number11 index10 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">send_data data, </code><code class="ruby color2">:filename</code> <code class="ruby plain">=&gt; asset.uploaded_file_file_name </code></div><div class="line number12 index11 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby comments">#redirect_to asset.uploaded_file.url </code></div><div class="line number13 index12 alt2"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">else</code></div><div class="line number14 index13 alt1"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">flash[</code><code class="ruby color2">:error</code><code class="ruby plain">] = </code><code class="ruby string">"Don't be cheeky! Mind your own assets!"</code></div><div class="line number15 index14 alt2"><code class="ruby spaces">&nbsp;&nbsp;&nbsp;</code><code class="ruby plain">redirect_to root_url </code></div><div class="line number16 index15 alt1"><code class="ruby spaces">&nbsp;</code><code class="ruby keyword">end</code></div><div class="line number17 index16 alt2"><code class="ruby keyword">end</code></div></div></td></tr></tbody></table></div></div>
<p>Above, we've added a line to assign the <code>asset</code> variable if the user has shared access to the folder of that asset (file).</p>
<div class="post__inarticle-ad-template" style="margin-top: 30px;"><div class="ad view ad--inarticle"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1392179526912-0"><div id="google_ads_iframe_/11757429/hub_development_inarticle_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_inarticle_0" name="google_ads_iframe_/11757429/hub_development_inarticle_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe></div><iframe id="google_ads_iframe_/11757429/hub_development_inarticle_0__hidden__" name="google_ads_iframe_/11757429/hub_development_inarticle_0__hidden__" width="0" height="0" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom; visibility: hidden; display: none;"></iframe></div><div class="ad__label">Advertisement</div></div></div></div><h3 class="nolinks">Restricting Actions Available to Shared Users</h3>
<p>We need to restrict access to the top Buttons: "Upload" and "New Folder". Open the <code>app/views/home/index.html.erb</code> file and alter the <code>top_menu</code> ul list, like so:</p>
<div><div id="highlighter_53389" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;% unless @is_this_folder_being_shared %&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">ul</code> <code class="html color1">id</code><code class="html plain">= </code><code class="html string">"top_menu"</code><code class="html plain">&gt;&nbsp;&nbsp;&nbsp; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% if @current_folder %&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "Upload", new_file_path(@current_folder) %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "New Folder", new_sub_folder_path(@current_folder) %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% else %&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "Upload", new_asset_path %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">li</code><code class="html plain">&gt;&lt;%= link_to "New Folder", new_folder_path %&gt;&lt;/</code><code class="html keyword">li</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;% end %&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">ul</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;% else %&gt; </code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">h3</code><code class="html plain">&gt;This folder is being shared to you by &lt;%= @current_folder.user.name %&gt;&lt;/</code><code class="html keyword">h3</code><code class="html plain">&gt; </code></div><div class="line number13 index12 alt2"><code class="html plain">&lt;% end %&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>We're using the <code>@is_this_folder_being_shared</code> variable to determine if the current_folder is indeed a folder shared by others or not. If it is, we'll hide them and display a message.</p>
<figure class="post_image">
          <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/8551_a9d75655edad9fd6281534ba6a27c92e.png" alt="" data-original-url="http://tutsplus.s3.amazonaws.com/tutspremium/web-development/132_fileSharingSite/images/shared_folder_view.png"><br>
        </figure>
<p>On this same page, near the <code>@folders</code> list, adjust the actions, as shown below:</p>
<div><div id="highlighter_608564" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"actions"</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"share"</code><code class="html plain">&gt; </code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Share", "#", :folder_id =&gt; folder.id, :folder_name =&gt; folder.name unless @is_this_folder_being_shared%&gt; </code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"rename"</code><code class="html plain">&gt; </code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Rename", rename_folder_path(folder) unless @is_this_folder_being_shared%&gt; </code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"delete"</code><code class="html plain">&gt; </code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Delete", folder, :confirm =&gt; 'Are you sure to delete the folder and all of its contents?', :method =&gt; :delete unless @is_this_folder_being_shared%&gt; </code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt; </code></div><div class="line number11 index10 alt2"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This code restricts actions on the subfolders of a folder shared by others.</p>
<p>Next, on the <code>Delete</code> action of the file, add: </p>
<div><div id="highlighter_189669" class="syntaxhighlighter noskimlinks noskimwords html"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;</code><code class="html keyword">div</code> <code class="html color1">class</code><code class="html plain">=</code><code class="html string">"delete"</code><code class="html plain">&gt; </code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;%= link_to "Delete", asset, :confirm =&gt; 'Are you sure?', :method =&gt; :delete unless @is_this_folder_being_shared%&gt; </code></div><div class="line number3 index2 alt2"><code class="html plain">&lt;/</code><code class="html keyword">div</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<p>This ensures that the actions are now nicely secure for the shared users.</p>
<hr>
<h2 class="nolinks">Conclusion</h2>
<p>Although there are certain plenty of additional things to cover to transform this app into a full-blown file sharing web site, this will provide with a solid start.</p>
<p> We've implemented each essential feature of a typical file sharing, including creating (nested) folders, and using emails for invites.   </p>
<p>In terms of the techniques we've used in this tutorial, we covered several topics, ranging from uploading files with Paper clip to the use of jQuery UI for the modal dialog box and sending post requests with AJAX.</p>
<p>This was a massive tutorial; so, take your time, read it again, work along with each step, and you'll be finished in no time!</p>
</div></div></div></div><div class="layout__sidebar"><div class="ad view"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1379650391729-0"><div id="google_ads_iframe_/11757429/hub_development_post_top_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_post_top_0" name="google_ads_iframe_/11757429/hub_development_post_top_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div><div class="post__sidebar"><div class="post__sidebar-primary"><div class="post__series-info"></div><div class="post-meta"><img sizes="100px" alt="Preview for Build a Dropbox-like File Sharing Site with Ruby on Rails" class="post-meta__image" srcset="https://cms-assets.tutsplus.com/legacy-premium-tutorials/default-preview-images/code.png 400w, https://thumbsplus.tutsplus.com/legacy-premium-tutorials/default-preview-images/code.png?height=300&amp;width=300 300w, https://thumbsplus.tutsplus.com/legacy-premium-tutorials/default-preview-images/code.png?height=200&amp;width=200 200w, https://thumbsplus.tutsplus.com/legacy-premium-tutorials/default-preview-images/code.png?height=100&amp;width=100 100w" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/code.png"><div class="post-meta__description"><div class="post-meta__item"><div class="post-meta__label">Difficulty:</div><div class="post-meta__value">Advanced</div></div><div class="post-meta__item"><div class="post-meta__label">Length:</div><div class="post-meta__value">Long</div></div><div class="post-meta__item"><div class="post-meta__label">Categories:</div><div class="post-meta__value"><span class="post-meta__tag"><a class="post-meta__category-link" href="http://code.tutsplus.com/categories/ruby">Ruby</a></span></div></div><div class="post-meta__label">Translations:</div><div class="post-meta__translate-this-post"><p>Envato Tuts+ tutorials are translated into other languages by our community members—you can be involved too!</p><a class="post-meta__translate-button" href="https://getnative.me/?ref=tutsplus&lang=en&url=http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940&title=Build%20a%20Dropbox-like%20File%20Sharing%20Site%20with%20Ruby%20on%20Rails">Translate this post</a><span class="post-meta__translate-powered-by-native">Powered by<img class="post-meta__native-translate-image" title="Native" alt="Native logo" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/native-logo-658bb251c3d4aa0b1f50e8cdc1e3a003.png"></span></div><div class="post-meta__resource-links"><a class="post-meta__resource-link post-meta__download-attachment-link" href="http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940/attachment">Download Attachment <i class="tutsicon-download"></i></a></div></div></div><div class="instructor-bio view view--loaded"><div class="instructor-bio__title">About <a class="instructor-bio__title-link" href="http://tutsplus.com/authors/phyo-wai">Phyo Wai</a></div><div class="instructor-bio__details"><a class="instructor-bio__title-link" href="http://tutsplus.com/authors/phyo-wai"><img alt="" class="instructor-bio__image" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/78e11519fcc50a0a9d92bc27997f3472"></a>N/A</div><a class="instructor-bio__expand-link" href="javascript:;">+ Expand Bio</a><a class="instructor-bio__collapse-link" href="javascript:;" style="display: none;">- Collapse Bio</a></div><div class="post__ad"><div class="ad view"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1382314910331-0"><div id="google_ads_iframe_/11757429/hub_development_post_mid_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_post_mid_0" name="google_ads_iframe_/11757429/hub_development_post_mid_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div></div></div><div class="post__sidebar-secondary"><div class="post__recommended-courses"><div class="suggested-course"><div class="suggested-course__title">Suggested Envato Tuts+ Course</div><div class="suggested-course__video"><div class="lesson-video view view--loaded" data-course-sku="CRS-200262" data-human-readable-id="CRS-200262_1.1_introduction" data-wistia-id="f7zrmethqh"><div class="lesson-video__wrapper"><div class="wistia_video_foam_dummy" data-source-container-id="wistia_f7zrmethqh" style="border: 0px; display: block; height: 0px; margin: 0px; padding: 0px; position: static; visibility: hidden; width: auto;"></div><div class="lesson-video__video" data-video-height="540" data-video-width="960" id="wistia_f7zrmethqh" style="width: 298px; height: 168px;"><div id="wistia_chrome_11" style="display: inline-block; height: 168px; margin: 0px; padding: 0px; position: relative; vertical-align: top; width: 298px; zoom: 1; overflow: hidden; box-sizing: content-box;"><div id="wistia_grid_15_wrapper" style="display: block; width: 298px; height: 168px;"><div id="wistia_grid_15_above" style="height: 0px; font-size: 0px; line-height: 0px;"> </div><div id="wistia_grid_15_main" style="width: 298px; left: 0px; height: 168px; margin-top: 0px;"><div id="wistia_grid_15_behind"></div><div id="wistia_grid_15_center" style="width: 100%; height: 100%;"><div id="wistia_video_wrapper_17" style="display: inline-block; height: 100%; margin: 0px; padding: 0px; position: relative; vertical-align: top; width: 100%; zoom: 1; overflow: hidden;"><div id="wistia_14_romulus" style="display: block; height: 100%; overflow: hidden; position: relative; width: 100%; background: rgb(0, 0, 0);"><video id="wistia_14" preload="none" poster="//fast.wistia.com/assets/images/blank.gif" style="display: block; height: 100%; position: relative; visibility: visible; width: 100%; object-fit: fill; background: transparent;"><source id="wistia_14_source" src="http://embed.wistia.com/deliveries/e1a1b3fcafab17240719b946313269e6e891d0a3/file.mp4" type="video/mp4"></video><style id="wistia_18_style" type="text/css" class="wistia_injected_style">#wistia_chrome_11:fullscreen,
#wistia_chrome_11:-webkit-full-screen,
#wistia_chrome_11:-moz-full-screen {
background:#000;
}
#wistia_f7zrmethqh .wistia_romulus_control {
  -webkit-font-smoothing: antialiased;
  z-index: 1;
}
#wistia_f7zrmethqh .wistia_romulus_hidden {
  opacity: 0;
  -webkit-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
-moz-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
-o-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
-ms-transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
transition: opacity 200ms linear 0s,width 0s linear 200ms,height 0s linear 200ms;
}
#wistia_f7zrmethqh .wistia_romulus_visible {
  opacity: 1;
  visibility: visible;
  -webkit-transition: opacity 200ms linear 0s;
-moz-transition: opacity 200ms linear 0s;
-o-transition: opacity 200ms linear 0s;
-ms-transition: opacity 200ms linear 0s;
transition: opacity 200ms linear 0s;
}
#wistia_f7zrmethqh .wistia_played {
  -webkit-transition: width 300ms linear 0s;
-moz-transition: width 300ms linear 0s;
-o-transition: width 300ms linear 0s;
-ms-transition: width 300ms linear 0s;
transition: width 300ms linear 0s;
}
#wistia_f7zrmethqh .wistia_playbar.wistia_dragging .wistia_played {
  -webkit-transition: left 0 linear 0s;
-moz-transition: left 0 linear 0s;
-o-transition: left 0 linear 0s;
-ms-transition: left 0 linear 0s;
transition: left 0 linear 0s;
}
#wistia_f7zrmethqh .wistia_scrub_bar {
  -webkit-transition: left 300ms linear 0s;
-moz-transition: left 300ms linear 0s;
-o-transition: left 300ms linear 0s;
-ms-transition: left 300ms linear 0s;
transition: left 300ms linear 0s;
}
#wistia_f7zrmethqh .wistia_playbar.wistia_dragging .wistia_scrub_bar {
  -webkit-transition: left 0 linear 0s;
-moz-transition: left 0 linear 0s;
-o-transition: left 0 linear 0s;
-ms-transition: left 0 linear 0s;
transition: left 0 linear 0s;
}
#wistia_f7zrmethqh .wistia_scrub_bar_top {
  background: rgba(255, 255, 255, .33);
  height: 4px;
  left: 0;
  position: absolute;
  top: 0;
  width: 4px;
}
#wistia_f7zrmethqh .wistia_scrub_bar_middle {
  background: rgba(255, 255, 255, .66);
  height: 24px;
  left: 0;
  position: absolute;
  top: 4px;
  width: 4px;
}
#wistia_f7zrmethqh .wistia_scrub_bar_bottom {
  background: rgba(255, 255, 255, .33);
  height: 4px;
  left: 0;
  position: absolute;
  top: 28px;
  width: 4px;
}
#wistia_f7zrmethqh .wistia_menu_item {
  background: transparent;
  color: #555;
  font-family: Arial, Sans-Serif;
  font-size: 14px;
  font-weight: normal;
  padding: 6px 16px;
  transition: none;
  -webkit-font-smoothing: antialiased;
}
#wistia_f7zrmethqh .wistia_menu_item .wistia_bullet {
  display: inline-block;
  margin: -1px 7px 0 0;
  vertical-align: top;
}
#wistia_f7zrmethqh .wistia_menu_item.wistia_visible {
  display: block;
}
#wistia_f7zrmethqh .wistia_menu_item.wistia_hidden {
  display: none;
}
#wistia_f7zrmethqh .wistia_menu_item:hover {
  background: #54bbff;
  color: #fff;
}
#wistia_f7zrmethqh .wistia_menu_item.wistia_disabled {
  background: transparent;
  color: #bbb;
}
#wistia_f7zrmethqh .wistia_menu_item.wistia_title {
  background: transparent;
  color: #bbb;
  font-size: 11px;
  line-height: 1em;
  padding-bottom: 3px;
}
#wistia_f7zrmethqh .wistia_dont_animate {
  -webkit-transition: none;
  -moz-transition: none;
  -o-transition: none;
  -ms-transition: none;
  transition: none;
}
#wistia_14 {
  -ms-object-fit: contain;
  -o-object-fit: contain;
  -moz-object-fit: contain;
  -webkit-object-fit: contain;
  object-fit: contain;
}</style><div id="wistia_still_19" class="wistia_romulus_control wistia_romulus_hidden" style="cursor: pointer;"></div><div id="wistia_25.thumbnail" tabindex="-1" style="cursor: default; display: block; height: 168px; overflow: hidden; outline: none; position: absolute; width: 298px; left: 0px; top: 0px;"><img id="wistia_25.thumbnail_img" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/f7010871bb0704426caaae674e9bae747daf70ed.jpg" style="border: 0px solid rgb(0, 0, 0); display: block; float: none; height: 168px; margin: 0px; max-height: none; max-width: none; padding: 0px; position: absolute; width: 298px; left: 0px; top: 0px;"></div><div id="wistia_smallPlayButton_44" class="wistia_romulus_control wistia_romulus_hidden" alt="Click to play" style="cursor: pointer; position: absolute; bottom: 0px; width: 0px; height: 0px; left: 0px; background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABMCAYAAACmj3NpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARtJREFUeNrs2kFRAzEYgNEuCioBCeAACZWABCQsCpCABCRUAjioBHCwbA65MFx7+freTK4c/g8yG5LDAQAAAAAAAAAAAP7Ytm01hXbg4byve9PoBh6+93UykW7g6X1fR5PpBh4+9/VgOt3A04sJtQMPH7bsduD5AfZkWt3A05uJtQPPDzBn5nDguWU/m143sDPzjQQeLs7M7cDOzDcSeF5aJLbsO78a/xpn5YtLi+5fcObMvJQCX/HHfy3L8miLbvrZ16sxNLdoL0TCgVdTbQb2D49wYHfG0cAuHcKBvdsKB3bxHw3s6U448NmHVDewq8BoYGfbcGDPcaKBnW3DgT2JDQdeTaMZ2Nk2HtiHFAAAAAAAAAAAAFf1K8AAF3b4jLx17LUAAAAASUVORK5CYII=) 0px 0px / 50px 32px no-repeat rgba(123, 121, 106, 0.8);"></div><div id="wistia_playbarControl_49" class="wistia_romulus_control wistia_romulus_hidden wistia_playbar" alt="Playbar - click to seek" style="cursor: pointer; position: absolute; bottom: 0px; height: 0px; overflow: hidden; width: 133px; -webkit-user-select: none; left: 55px;"><div id="wistia_playbar_background_54" style="position: absolute; left: 4px; top: 4px; height: 24px; pointer-events: none; width: 125px; background: rgba(123, 121, 106, 0.498039);"></div><div id="buffered_55" class="wistia_buffered" style="position: absolute; left: 4px; top: 4px; width: 0px; height: 24px; background: rgba(223, 221, 206, 0.8);"></div><div style="position: absolute; left: 0px; top: 0px; border: 4px solid rgba(123, 121, 106, 0.8); pointer-events: none; width: 125px; height: 24px;"></div><div id="watched_56" class="wistia_played" style="position: absolute; left: 0px; top: 0px; width: 0px; height: 32px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQFJREFUeNrsl6EOwkAQRC+T1CBAYDAIEFRgiiiW/6cCDAJTBKYGQQWmouyGbbLZD5gzNBnxcmbSd+3dpnEcC8lJUkoSm5FS2ksGyT39HiprgZWkscU1m2GgjebWjspa4CUpJAfJg82wV7ELnmg87QF1c7VFKmuByuAjmbFZCzwlnbWr2awFbu77TGxG8NKwGTm8e0YO754RvJRs1gIXg6Vkw2Yt0NuvsbZmVIbz0pkbKsO8FMETjeG8DMEThZHDu2c4L5Wd1VSeNuFWsnBHJo3hrkrncHWisBY4Bi9U1gJvSeu8UBk5vHtGDu+e4a7I3hON/WjWhtGJwv/RLPto9hVgAAkkA1W/Un5YAAAAAElFTkSuQmCC);"><div id="time_57" class="wistia_time" style="bottom: 7px; color: rgba(255, 255, 255, 0.701961); cursor: pointer; display: inline-block; font-family: Arial, sans-serif; font-weight: bold; font-size: 15px; line-height: 1.1em; position: absolute; text-shadow: rgb(123, 121, 106) 0px 0px 9px; white-space: nowrap; width: 0px; left: auto; right: -8px;">2:40</div></div><div id="scrub_bar_60" class="wistia_scrub_bar" style="position: absolute; left: 0px; top: 0px; width: 4px; height: 32px;"><div class="wistia_scrub_bar_top">&nbsp;</div>
<div class="wistia_scrub_bar_middle">&nbsp;</div>
<div class="wistia_scrub_bar_bottom">&nbsp;</div></div></div><div id="wistia_volumeControl_61" class="wistia_romulus_control wistia_romulus_hidden" alt="Volume (100%) - click and drag horizontally to change" style="cursor: pointer; position: absolute; bottom: 0px; height: 0px; overflow: hidden; width: 0px; right: 55px;">&nbsp;<div style="position: absolute; left: 0px; top: 0px; height: 32px; width: 50px; background-color: rgba(123, 121, 106, 0.8);"></div><div style="position: absolute; left: 50px; top: 0px; height: 32px; width: 0px; background-color: rgba(123, 121, 106, 0.498039);"></div><div style="position: absolute; left: 15px; top: 7px; height: 18px; width: 21px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAkCAYAAAD/yagrAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAfZJREFUeNrsWO1thDAMhVMHYIOyQRmBbsAIbHCMcJ0AdQLUCU6dADpBrhNwN8HdBmkiBdVyHYePAPlRSwiEA3l5tmM7h2hHkVLW6mqikEUBLOWvOMEedsR6UdfDPGvQZcisZuq6A2azUEzdEO8LAFSsNXlhAkKMGGf1R/OPQSqfAFMNDvxcOsYnaPyJ0A8uoO+JLxahXzmBgsXB73Kkr7yxqpmQFiHGNnpR6F3O+SNYSD8XoDZNKxlB4wUwY8r4Y8kQkc/ZQnrpEMaMLeOPPeEeg9Rzs8dooObblvHH2rZ3Amv0Y03dyAliCR5yS+KYQ+ZPocKLWBZ8ZhYiqKBCAVdsles/IQCk68w9I2qACOvWBtqBZwz0m1pEHMcPUKw8bwJUTXqlJjVydVRWWtIty7w/k86RPevRf6BzJSeiebIrrAoUZZ0bUr+AoOuQLtma0cKyVXFMw/3za3jxpFYTW9iQC9nUrByHrUhNc4EpFIDpGCs8xjD6tpDNCpjwHemO4PnDwjRlBbbEE1NzPaq6ethacGUeqg/uXit7C9B6ZIlXElXbIOclPbiYUOYJAoirFTlRlZPXvslDc5eATqL3tj/6bJcJAk6hHkBktuAL6UgHs11EoQkBsgkRJD4WEpzJ9yzzMpBGdXp9NW1IkOejtclEzuD5EWAA23jc4a3H7VsAAAAASUVORK5CYII=); background-size: 21px 18px;"></div></div><div id="wistia_fullscreenButton_67" class="wistia_romulus_control wistia_romulus_hidden" alt="Fullscreen - click to toggle" style="cursor: pointer; position: absolute; bottom: 0px; width: 0px; height: 0px; -webkit-user-select: none; right: 0px; background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAkCAYAAADLsGk3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAK9JREFUeNrsmW0KgCAMhjW6l96supmdzCYkjDBRCqbjfUHwh+Ae9oGbJrZpN0JKd7cYuBglWtk+0DpfzgVBG2t3O1o+u048fP4IOzWhpTJHnm6LIxpsSao9oiq0jgFK7OfSbJEjyBGAAAQgAAEIQAACEIAARKqxYmOgQE/9qZorst2be66VOsSt1HFNIp/tR44MlyO9vTE8ApD+0HKVibxYaeYltiDHD+LHaiRdAgwAGD3VmeLXH3kAAAAASUVORK5CYII=) 12px 7px / 25px 18px no-repeat rgba(123, 121, 106, 0.8);">&nbsp;</div><div id="wistia_branding_72" class="wistia_romulus_control wistia_romulus_hidden" style="cursor: pointer; overflow: hidden; position: absolute; left: 0px; top: 0px; height: 0px; width: 0px; background-color: rgba(123, 121, 106, 0.8);"><a href="http://wistia.com/about-wistia?player=108233" tabindex="-1" style="display: block; font-size: 12px; font-family: &#39;Gill Sans&#39;, sans-serif; height: 14px; letter-spacing: 1px; line-height: 14px; padding-left: 5px; padding-top: 2px; padding-bottom: 2px; text-decoration: none; width: 293px;"><span style="color: rgba(255, 255, 255, 0.65098);">POWERED BY</span> <span style="color: rgb(255, 255, 255);">WISTIA</span></a></div><div id="wistia_14.big_play_button_background" style="height: 38px; position: absolute; width: 60px; z-index: 1; left: 119px; top: 65px; display: block; background-color: rgba(123, 121, 106, 0.8);"></div><div id="wistia_14.big_play_button_graphic" tabindex="0" aria-role="Button" aria-label="Play" style="cursor: pointer; display: block; height: 38px; outline: none; position: absolute; width: 60px; z-index: 1; left: 119px; top: 65px; background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAmCAYAAACYsfiPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJNJREFUeNrs1ksNhEAURNGWgAQkjAQkIAUJ7QApIwEJSEACEh6PBatJhmZJ1T1JCahU+lMKAACAioj4Zjqnwqc9MzoVvszya8evLTM4FdZeO/7TWzva6Kwd7dbMx6nwpboV3l99rh+WXV5/lh+sOrlcWueqvcOzpLNqQ2GtVW8KT0WZ3MeisXAtLixWBQAAQDoEGACTzSwy3SX7YgAAAABJRU5ErkJggg==) 0px 0px / 60px 38px no-repeat transparent;"></div><div id="wistia_loading_91" class="wistia_romulus_control" style="cursor: pointer; position: absolute; display: none; left: 0px; top: 0px; color: rgba(255, 255, 255, 0.8); font-family: Arial, sans-serif; font-style: italic; line-height: 1.1em; padding: 2px 5px; background-color: rgb(123, 121, 106);">Loading...</div><div id="wistia_context_menu_95" class="wistia_romulus_control wistia_context_menu" style="cursor: pointer; box-shadow: rgba(0, 0, 0, 0.2) 0px 3px 10px; left: 0px; line-height: 1.5em; position: absolute; text-shadow: none; top: 0px; width: 200px; z-index: 100000; display: none; background-color: rgb(255, 255, 255);"><div class="wistia_disabled wistia_menu_item wistia_menu_item_playingIn" id="playingIn">Playing in <span id="playingInName">540p</span></div><div style="font-size: 0px; height: 0px; line-height: 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(232, 232, 232); margin: 1px 0px;"></div><div id="auto" class="wistia_menu_item wistia_menu_item_auto"><span id="autoBullet" class="wistia_bullet">●</span> Auto</div><div id="mp4_h264_198k" class="wistia_menu_item wistia_menu_item_mp4_h264_198k"><span id="mp4_h264_198kBullet" class="wistia_bullet">○</span> 224p</div><div id="mp4_h264_580k" class="wistia_menu_item wistia_menu_item_mp4_h264_580k"><span id="mp4_h264_580kBullet" class="wistia_bullet">○</span> 360p</div><div id="mp4_h264_432k" class="wistia_menu_item wistia_menu_item_mp4_h264_432k"><span id="mp4_h264_432kBullet" class="wistia_bullet">○</span> 540p</div><div id="mp4_h264_508k" class="wistia_menu_item wistia_menu_item_mp4_h264_508k"><span id="mp4_h264_508kBullet" class="wistia_bullet">○</span> 720p</div><div style="font-size: 0px; height: 0px; line-height: 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(232, 232, 232); margin: 1px 0px;"></div><div id="switchToFlash" class="wistia_menu_item wistia_menu_item_switchToFlash">Switch to Flash</div><div style="font-size: 0px; height: 0px; line-height: 0px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(232, 232, 232); margin: 1px 0px;"></div><a href="http://wistia.com/about-wistia?about=108233" target="_blank" id="aboutWistia" class="wistia_menu_item wistia_menu_item_aboutWistia" style="display: block; text-decoration: none;">About Wistia</a></div></div></div></div><div id="wistia_grid_15_front"></div><div id="wistia_grid_15_top_inside"><div id="wistia_grid_15_top" style="height: 0px; font-size: 0px; line-height: 0px;"> </div><div id="wistia_12_cc_button" class="wistia_cc_button wistia_hidden" title="Turn on captions">CC</div><div id="wistia_12_captions_list_container" class="wistia_captions_list_container wistia_hidden"><div id="wistia_12_captions_list_spacer"></div><div id="wistia_12_captions_list" class="wistia_captions_list"><div class="wistia_12_caption_li" data-id="0"><div class="wistia_12_caption_check"></div><div id="wistia_12_off_caption" class="wistia_12_caption_name">Off</div></div><div class="wistia_12_caption_li" data-id="359720"><div class="wistia_12_caption_check wistia_hidden"></div><div id="wistia_12_english_caption" class="wistia_12_caption_name">English</div></div></div></div></div><div id="wistia_grid_15_bottom_inside"><div id="wistia_grid_15_bottom" style="height: 0px; font-size: 0px; line-height: 0px;"> </div><div id="wistia_12_captions_line_wrapper" class="wistia_captions_line_wrapper"><div id="wistia_12_captions" class="wistia_captions"><style id="wistia_153_style" type="text/css" class="wistia_injected_style">#wistia_12_captions_line_wrapper {
bottom: 38px;
height: 0;
left: 0;
pointer-events: none;
position: absolute;
width: 100%;
}
#wistia_12_captions {
bottom: 0;
left: 0;
text-align: center;
position: absolute;
width: 100%;
}
#wistia_12_captions .wistia_caption_line, #wistia_12_captions_notification {
background-color: rgba(0,0,0,0.8);
color: #ffffff;
display: inline-block;
*display: inline;
filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#cc000000', endColorStr='#cc000000');
font-family: Helvetica, Arial, Sans-Serif;
font-size: 14px;
line-height: 1.4em;
max-width: 80%;
padding: .25em .6em;
text-align: center;
vertical-align: top;
zoom: 1;
-webkit-font-smoothing: antialiased;
}
#wistia_12_cc_button.wistia_hidden {
filter: alpha(opacity=0);
opacity: 0;
}
#wistia_12_cc_button {
background: transparent url(http://fast.wistia.com/assets/images/player-controls-CC-2x.png);
cursor: pointer;

filter: alpha(opacity=40);
background-size: 73px;
height: 40px;
left: -5px;
line-height:32px;
opacity: .6;
position: absolute;
text-align: center;
text-indent: -999999em;
top: -1px;
width: 70px;
z-index: 2;
-moz-user-select: none;
-ms-user-select: none;
-webkit-user-select: none;
-webkit-touch-callout: none;
-webkit-backface-visibility: hidden;
}
#wistia_12_cc_button.wistia_fade_transition {
-webkit-transition: opacity 0.2s ease-in-out;
-moz-transition: opacity 0.2s ease-in-out;
-o-transition: opacity 0.2s ease-in-out;
-ms-transition: opacity 0.2s ease-in-out;
transition: opacity 0.2s ease-in-out;
}
#wistia_12_cc_button.wistia_hidden {
filter: alpha(opacity=0);
opacity: 0;
}
#wistia_12_cc_button:hover {
filter: alpha(opacity=50);
opacity: 1;
}
#wistia_12_cc_button.wistia_on {
filter: alpha(opacity=80);
opacity: 1;
}
#wistia_12_cc_button.wistia_on:hover {
filter: alpha(opacity=90);
opacity: 1;
}
#wistia_12_captions_list_container {
background-color: rgba(0,0,0, 0.3);
font-family: Helvetica, Arial, Sans-Serif;
margin-bottom: 32px;
overflow: hidden;
position: absolute;
width: 130px;
z-index: 1;
-moz-user-select: none;
-ms-user-select: none;
-webkit-user-select: none;
-webkit-touch-callout: none;
}
#wistia_12_captions_list_container.wistia_hidden {
filter: alpha(opacity=0);
opacity: 0;
cursor: default;
}
#wistia_12_captions_list_spacer {
display: block;
height: 40px;
}
#wistia_12_captions_list {
cursor: pointer;
display: block;
list-style: none;
max-height: 91px;
overflow-y: scroll;
padding-left: 0;
width: 155px;
margin: 0;
margin-top: 5px;
}
#wistia_12_captions_list_container.wistia_fade_transition {
-webkit-transition: opacity 0.2s ease-in-out;
-moz-transition: opacity 0.2s ease-in-out;
-o-transition: opacity 0.2s ease-in-out;
-ms-transition: opacity 0.2s ease-in-out;
transition: opacity 0.2s ease-in-out;
}
#wistia_12_captions_list .wistia_12_caption_li {
color: #ffffff;
margin: 0px;
padding: 10px 0px 10px 0px;
width: 100%;
}
#wistia_12_captions_list .wistia_12_caption_li:hover {
background-color: rgba(0,0,0, 0.6);
}
#wistia_12_captions_list .wistia_12_caption_name {
display: inline-block;
letter-spacing: 1px;
list-style: none;
}
#wistia_12_captions_list .wistia_12_caption_check {
display: inline-block;
background: transparent url(http://fast.wistia.com/assets/images/white-check-2x.png);
background-repeat: no-repeat;
background-size: 14px;
height: 13px;
margin: 0px 10px 0px 13px;
width: 15px;
}
#wistia_12_captions_list .wistia_12_caption_check.wistia_hidden{
filter: alpha(opacity=0);
opacity: 0;
}</style></div></div></div><div id="wistia_grid_15_left_inside"><div id="wistia_grid_15_left" style="height: 0px; font-size: 0px; line-height: 0px;"> </div></div><div id="wistia_grid_15_right_inside"><div id="wistia_grid_15_right" style="height: 0px; font-size: 0px; line-height: 0px;"> </div></div></div><div id="wistia_grid_15_below" style="height: 0px; font-size: 0px; line-height: 0px;"> </div><style id="wistia_16_style" type="text/css" class="wistia_injected_style">#wistia_grid_15_wrapper{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;font-family:Arial,sans-serif;font-size:14px;height:100%;position:relative;text-align:left;width:100%;}
#wistia_grid_15_wrapper *{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;}
#wistia_grid_15_above{position:relative;}
#wistia_grid_15_main{display:block;height:100%;position:relative;}
#wistia_grid_15_behind{height:100%;left:0;position:absolute;top:0;width:100%;}
#wistia_grid_15_center{height:100%;overflow:hidden;position:relative;width:100%;}
#wistia_grid_15_front{display:none;height:100%;left:0;position:absolute;top:0;width:100%;}
#wistia_grid_15_top_inside{position:absolute;left:0;top:0;width:100%;}
#wistia_grid_15_top{width:100%;position:absolute;bottom:0;left:0;}
#wistia_grid_15_bottom_inside{position:absolute;left:0;bottom:0;width:100%;}
#wistia_grid_15_bottom{width:100%;position:absolute;top:0;left:0;}
#wistia_grid_15_left_inside{height:100%;position:absolute;left:0;top:0;}
#wistia_grid_15_left{height:100%;position:absolute;right:0;top:0;}
#wistia_grid_15_right_inside{height:100%;right:0;position:absolute;top:0;}
#wistia_grid_15_right{height:100%;left:0;position:absolute;top:0;}
#wistia_grid_15_below{position:relative;}</style></div></div></div></div></div></div><a class="suggested-course__link" href="http://code.tutsplus.com/courses/get-started-with-ruby-on-rails?utm_source=Tuts+&utm_medium=website&utm_campaign=suggestedcoursevideo&utm_content=sidebar&WT.mc_id=Tuts+_website_suggestedcoursevideo_sidebar">Get Started With Ruby on Rails<span class="suggested-course__price">$9</span></a></div></div><div class="post__recommended-content"><div class="recommended-items"><div class="recommended-items__header">Related Tutorials</div><a href="http://code.tutsplus.com/tutorials/how-to-build-a-subscription-box-with-stamplay--cms-24808?utm_source=Tuts+&utm_medium=website&utm_campaign=relatedtutorials&utm_content=sidebar&WT.mc_id=Tuts+_website_relatedtutorials_sidebar"><div class="recommended-items__item"><div class="recommended-items__preview-image-container"><img class="recommended-items__preview-image " src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/stamplay-image.png" alt="Stamplay image"></div><div class="recommended-items__title">How to Build a Subscription Box With Stamplay</div><div class="recommended-items__topic topic-code">Code</div></div></a><a href="http://code.tutsplus.com/tutorials/creating-a-web-app-from-scratch-using-python-flask-and-mysql-part-7--cms-23518?utm_source=Tuts+&utm_medium=website&utm_campaign=relatedtutorials&utm_content=sidebar&WT.mc_id=Tuts+_website_relatedtutorials_sidebar"><div class="recommended-items__item"><div class="recommended-items__preview-image-container"><img class="recommended-items__preview-image " src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/python.png" alt="Python"></div><div class="recommended-items__title">Creating a Web App From Scratch Using Python Flask and MySQL: Part 7</div><div class="recommended-items__topic topic-code">Code</div></div></a><a href="http://code.tutsplus.com/tutorials/build-an-angularjs-app-from-scratch-powered-by-python-eve--cms-23063?utm_source=Tuts+&utm_medium=website&utm_campaign=relatedtutorials&utm_content=sidebar&WT.mc_id=Tuts+_website_relatedtutorials_sidebar"><div class="recommended-items__item"><div class="recommended-items__preview-image-container"><img class="recommended-items__preview-image " src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/angular-js-firebase.png" alt="Angular js firebase"></div><div class="recommended-items__title">Build an AngularJS App From Scratch, Powered by Python EVE</div><div class="recommended-items__topic topic-code">Code</div></div></a></div></div><div class="marketplace-items view view--loaded"><div class="marketplace-items__container">
  <div class="marketplace-items__header">Envato Market Item</div>
  <div class="marketplace-items__item">
  <a class="marketplace-items__item-link" href="http://codecanyon.net/item/super-backup-clone-migrate-for-wordpress/12943030?ref=tutshub">
    <img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/image-preview.jpg" alt="" class="marketplace-items__item-preview-image">
  </a>
</div>
</div></div><div class="post__call-for-subject"><div class="post__call-for-subject-title">What Would You Like to Learn?</div><div class="post__call-for-subject-body"><a href="https://tutsplus.uservoice.com/forums/248750-what-would-you-like-to-learn">Suggest an idea</a> to the content editorial team at Envato Tuts+.</div></div></div></div></div><footer class="post__footer"><div class="layout__content-with-sidebar"><div class="post__comments" id="comments"><div id="disqus_thread" name="disqus_thread"><iframe id="dsq-app1" name="dsq-app1" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/saved_resource.html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 1787px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div><script>var disqus_shortname  = "tutspremium";
var disqus_identifier = "1122514980";
var disqus_title      = "Build a Dropbox-like File Sharing Site with Ruby on Rails";
var disqus_url        = "http://code.tutsplus.com/tutorials/build-a-dropbox-like-file-sharing-site-with-ruby-on-rails--net-17940";
var disqus_config     = function() {
    this.language = "en";
};

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();

(function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());</script></div></div><div class="layout__sidebar"><div class="ad view"><div class="ad__wrapper"><div class="ad__content" id="div-gpt-1379650407131-0"><div id="google_ads_iframe_/11757429/hub_development_post_comments_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/11757429/hub_development_post_comments_0" name="google_ads_iframe_/11757429/hub_development_post_comments_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe></div></div><div class="ad__label">Advertisement</div></div></div></div></footer></article></main></div><footer class="page-footer"><div class="page-footer__content"><div class="page-footer__header"><div class="page-footer__tuts-brand"><img alt="envato-tuts+" class="page-footer__tuts-logo-image tuts-logo" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/tuts_logo-b4f5f5fad9a5f4b3f91e3b770689a808.svg"><span class="page-footer__tuts-brand-text">Teaching skills to millions worldwide.</span></div><div class="page-footer__counts"><div class="page-footer__count-item"><div class="page-footer__count-value">20,788</div><div class="page-footer__count-label">Tutorials</div><div class="page-footer__count-value">660</div><div class="page-footer__count-label">Video Courses</div></div></div></div><div class="page-footer__links-column"><div class="page-footer__section page-footer__section--first"><div class="page-footer__heading">Follow Us</div><a class="page-footer__social-link page-footer__facebook-link" href="https://www.facebook.com/tutsplus"><i class="fa fa-facebook"></i></a><a class="page-footer__social-link page-footer__twitter-link" href="https://twitter.com/tutsplus"><i class="fa fa-twitter"></i></a><a class="page-footer__social-link page-footer__googleplus-link" href="https://plus.google.com/108971748263060947124/posts"><i class="fa fa-google-plus"></i></a><a class="page-footer__social-link page-footer__pinterest-link" href="http://www.pinterest.com/tutsplus/"><i class="fa fa-pinterest"></i></a></div><div class="page-footer__section"><div class="page-footer__heading">Help and Support</div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/faq">FAQ</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/terms-of-use">Terms of Use</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/support">Contact Support</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/about">About Envato Tuts+</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/advertise">Advertise</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/teach">Teach at Envato Tuts+</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://tutsplus.com/translate-for-us">Translate for Envato Tuts+</a></div><div class="page-footer__support-item"><a class="page-footer__link" href="http://community.envato.com/#/events/">Meetups</a></div></div></div><div class="page-footer__email-column"><div class="page-footer__section page-footer__section--first"><div class="page-footer__newsletter-section"><div class="page-footer__heading">Email Newsletters</div><div class="page-footer__newsletter-description">Get Envato Tuts+ updates, news, surveys &amp; offers.</div><form class="page-footer__newsletter-form" action="http://code.tutsplus.com/weekly_digest_subscription_requests" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="LYGG8dx0wQsksSXqVXjaTUs7p/ab8SO3xnk4o2RRwuK0xwDiBTGIys74VcuvxAMxjweDBpwoK3Z2NFg7Rw3TbA=="><input placeholder="Email Address" class="page-footer__newsletter-email-field" type="email" name="weekly_digest_subscription_request[email]" id="weekly_digest_subscription_request_email"><button name="button" type="submit" class="page-footer__newsletter-submit">Subscribe</button></form><a class="page-footer__newsletter-privacy-policy-link page-footer__link" href="http://tutsplus.com/privacy-policy">Privacy Policy</a></div></div></div><div class="page-footer__right"><div class="page-footer__envato-product"><a href="http://studio.envato.com/?utm_source=tutsfooter&utm_medium=banner&utm_campaign=tutsfooter"><img alt="OPEN. New Services!" class="page-footer__envato-product-image page-footer__envato-product-image--studio" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/open-new-services-140x112-b60f3facb36aec4dd68b55e4df3e4237.png"></a><div class="page-footer__envato-product-description">Custom digital services like logo design, WordPress installation, video production and more. <a class="page-footer__link page-footer__envato-product-link" href="http://studio.envato.com/?utm_source=tutsfooter&utm_medium=banner&utm_campaign=tutsfooter">Check out Envato Studio</a></div></div><div class="page-footer__envato-product"><a href="http://codecanyon.net/popular_item/by_category?category=php-scripts&ref=tutshub&utm_source=tutsplus&utm_medium=footer&utm_campaign=tutscode"><img alt="Buy photos as you need them" class="page-footer__envato-product-image page-footer__envato-product-image--marketplaces" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/codecanyon--pre-coded-php-7285f878a39908939818664926bf47f2.jpg"></a><div class="page-footer__envato-product-description">Build anything from social networks to file upload systems.  Build faster with pre-coded PHP scripts. <a class="page-footer__link page-footer__envato-product-link" href="http://codecanyon.net/popular_item/by_category?category=php-scripts&ref=tutshub&utm_source=tutsplus&utm_medium=footer&utm_campaign=tutscode">Browse PHP on CodeCanyon</a></div></div></div></div><div class="page-footer__envato-bar"><div class="page-footer__envato-bar-content"><div class="page-footer__copyright">© 2015 Envato Pty Ltd. Trademarks and brands are the property of their respective owners.</div><div class="page-footer__envato-logo"><a class="page-footer__envato-logo-link" href="http://www.envato.com/"><img alt="envato" class="page-footer__envato-logo-image" src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/envato_logo-cd2ea38a6d4bfbefb4f8ccb1b0c99178.svg"></a></div></div></div></footer><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/body-055067e6fb18c3664fe8dd6526fe6ba9.js" async="async"></script><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/1342X589339.skimlinks.js" type="text/javascript"></script><div style="display: none;"><img src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/track_page_view" style="display:none" width="0" height="0"></div><script src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/E-v1.js"></script><iframe src="./Build a Dropbox-like File Sharing Site with Ruby on Rails - Envato Tuts+ Code Tutorial_files/container.html" style="visibility: hidden; display: none;"></iframe><iframe width="0" height="0" style="display: none;"></iframe><iframe width="0" height="0" style="display: none;"></iframe><iframe id="google_osd_static_frame_6461049197241" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;"></iframe></body></html>